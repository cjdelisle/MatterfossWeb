(self.webpackChunkmattermost_webapp=self.webpackChunkmattermost_webapp||[]).push([[228],{63470:(e,t,s)=>{"use strict";s.d(t,{QI:()=>n,sk:()=>r,lg:()=>o});var a=s(17214),i=s(27457);function n(e){return(t,s)=>{const n=(0,i.rc)(s());return t(a.zP(n,!0,e))}}function r(){return(e,t)=>{const s=(0,i.rc)(t());return e(a.zP(s,!1))}}function o(){return(e,t)=>{const s=(0,i.rc)(t());return e(a.lg(s))}}},68228:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>ns});var a=s(37703),i=s(27457),n=s(45697),r=s.n(n),o=s(67294),l=s(14890),c=s(87271),d=s(69797),u=s(24023),m=s(17214),p=s(78274),h=(s(33948),s(88674),s(44012)),g=s(34288),f=s(74935),E=s(82251),v=s(93733),S=s(24204),b=s(32579),y=s(70767),_=s(94131);function T(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class N extends o.PureComponent{constructor(e){super(e),T(this,"handleOnChange",(e=>{const t=e.currentTarget.value;this.setState({joinLeaveState:t})})),T(this,"handleUpdateSection",(e=>{e||this.setState({joinLeaveState:this.props.joinLeave}),this.props.onUpdateSection(e)})),T(this,"handleSubmit",(()=>{const{actions:e,currentUserId:t,onUpdateSection:s}=this.props,a={category:_.uP.CATEGORY_ADVANCED_SETTINGS,user_id:t,name:_.uP.ADVANCED_FILTER_JOIN_LEAVE,value:this.state.joinLeaveState};e.savePreferences(t,[a]),s()})),this.state={joinLeaveState:e.joinLeave}}render(){const{joinLeaveState:e}=this.state;return this.props.activeSection===p.ZE.JOIN_LEAVE?o.createElement(v.Z,{title:o.createElement(h.Z,{id:"user.settings.advance.joinLeaveTitle",defaultMessage:"Enable Join/Leave Messages"}),inputs:[o.createElement("fieldset",{key:"joinLeaveSetting"},o.createElement("legend",{className:"form-legend hidden-label"},o.createElement(h.Z,{id:"user.settings.advance.joinLeaveTitle",defaultMessage:"Enable Join/Leave Messages"})),o.createElement("div",{className:"radio"},o.createElement("label",null,o.createElement("input",{id:"joinLeaveOn",type:"radio",value:"true",name:p.ZE.JOIN_LEAVE,checked:"true"===e,onChange:this.handleOnChange}),o.createElement(h.Z,{id:"user.settings.advance.on",defaultMessage:"On"})),o.createElement("br",null)),o.createElement("div",{className:"radio"},o.createElement("label",null,o.createElement("input",{id:"joinLeaveOff",type:"radio",value:"false",name:p.ZE.JOIN_LEAVE,checked:"false"===e,onChange:this.handleOnChange}),o.createElement(h.Z,{id:"user.settings.advance.off",defaultMessage:"Off"})),o.createElement("br",null)),o.createElement("div",{className:"mt-5"},o.createElement(h.Z,{id:"user.settings.advance.joinLeaveDesc",defaultMessage:'When "On", System Messages saying a user has joined or left a channel will be visible. When "Off", the System Messages about joining or leaving a channel will be hidden. A message will still show up when you are added to a channel, so you can receive a notification.'})))],setting:p.ZE.JOIN_LEAVE,submit:this.handleSubmit,saving:this.state.isSaving,server_error:this.state.serverError,updateSection:this.handleUpdateSection}):o.createElement(S.Z,{title:o.createElement(h.Z,{id:"user.settings.advance.joinLeaveTitle",defaultMessage:"Enable Join/Leave Messages"}),describe:this.props.renderOnOffLabel(e),section:p.ZE.JOIN_LEAVE,updateSection:this.handleUpdateSection})}}T(N,"propTypes",{activeSection:r().string,currentUserId:r().string.isRequired,joinLeave:r().string,onUpdateSection:r().func.isRequired,renderOnOffLabel:r().func.isRequired,actions:r().shape({savePreferences:r().func.isRequired}).isRequired});const M=(0,a.connect)((function(e){const t=(0,d.U2)(e,_.uP.CATEGORY_ADVANCED_SETTINGS,_.uP.ADVANCED_FILTER_JOIN_LEAVE,"true");return{currentUserId:(0,i.rc)(e),joinLeave:t}}),(function(e){return{actions:(0,l.bindActionCreators)({savePreferences:u.$A},e)}}))(N);function C(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}const A=p.ZP.PRE_RELEASE_FEATURES;class k extends o.PureComponent{constructor(e){super(e),C(this,"getStateFromProps",(()=>{const e=this.props.advancedSettingsCategory,t={send_on_ctrl_enter:this.props.sendOnCtrlEnter,code_block_ctrl_enter:this.props.codeBlockOnCtrlEnter,formatting:this.props.formatting,join_leave:this.props.joinLeave},s=Object.keys(A);let a=0;for(const i of e)for(const e of s){const s=A[e];i.name===p.ZP.FeatureTogglePrefix+s.label&&(t[i.name]=i.value,"true"===i.value&&(a+=1))}const i=this.props.enablePreviewFeatures;return{preReleaseFeatures:A,settings:t,preReleaseFeaturesKeys:s,enabledFeatures:a,isSaving:!1,previewFeaturesEnabled:i,showDeactivateAccountModal:!1}})),C(this,"updateSetting",((e,t)=>{const s=this.state.settings;s[e]=t,this.setState(s)})),C(this,"toggleFeature",((e,t)=>{const s=this.state.settings;s[p.ZP.FeatureTogglePrefix+e]=String(t);let a=0;Object.keys(this.state.settings).forEach((e=>{0===e.lastIndexOf(p.ZP.FeatureTogglePrefix)&&"true"===this.state.settings[e]&&a++})),this.setState({settings:s,enabledFeatures:a})})),C(this,"saveEnabledFeatures",(()=>{const e=[];Object.keys(this.state.settings).forEach((t=>{0===t.lastIndexOf(p.ZP.FeatureTogglePrefix)&&e.push(t)})),this.handleSubmit(e)})),C(this,"handleSubmit",(async e=>{const t=[],{actions:s,currentUser:a}=this.props,i=a.id;(Array.isArray(e)?e:[e]).forEach((e=>{t.push({user_id:i,category:p.ZP.Preferences.CATEGORY_ADVANCED_SETTINGS,name:e,value:this.state.settings[e]})})),this.setState({isSaving:!0}),await s.savePreferences(i,t),this.handleUpdateSection("")})),C(this,"handleDeactivateAccountSubmit",(async()=>{const e=this.props.currentUser.id;this.setState({isSaving:!0}),this.props.actions.updateUserActive(e,!1).then((({error:e})=>{e&&this.setState({serverError:e.message})}));const{data:t,error:s}=await this.props.actions.revokeAllSessionsForUser(e);t?(0,g.gc)():s&&this.setState({serverError:s.message})})),C(this,"handleShowDeactivateAccountModal",(()=>{this.setState({showDeactivateAccountModal:!0})})),C(this,"handleHideDeactivateAccountModal",(()=>{this.setState({showDeactivateAccountModal:!1})})),C(this,"handleUpdateSection",(e=>{e||this.setState(this.getStateFromProps()),this.setState({isSaving:!1}),this.props.updateSection(e)})),C(this,"getCtrlSendText",(()=>{const e={default:{id:(0,E.t)("user.settings.advance.sendDesc"),defaultMessage:"When enabled, CTRL + ENTER will send the message and ENTER inserts a new line."},mac:{id:(0,E.t)("user.settings.advance.sendDesc.mac"),defaultMessage:"When enabled, ⌘ + ENTER will send the message and ENTER inserts a new line."}},t={default:{id:(0,E.t)("user.settings.advance.sendTitle"),defaultMessage:"Send Messages on CTRL+ENTER"},mac:{id:(0,E.t)("user.settings.advance.sendTitle.mac"),defaultMessage:"Send Messages on ⌘+ENTER"}};return f.V5()?{ctrlSendTitle:t.mac,ctrlSendDesc:e.mac}:{ctrlSendTitle:t.default,ctrlSendDesc:e.default}})),C(this,"renderFormattingSection",(()=>"formatting"===this.props.activeSection?o.createElement(v.Z,{title:o.createElement(h.Z,{id:"user.settings.advance.formattingTitle",defaultMessage:"Enable Post Formatting"}),inputs:[o.createElement("fieldset",{key:"formattingSetting"},o.createElement("legend",{className:"form-legend hidden-label"},o.createElement(h.Z,{id:"user.settings.advance.formattingTitle",defaultMessage:"Enable Post Formatting"})),o.createElement("div",{className:"radio"},o.createElement("label",null,o.createElement("input",{id:"postFormattingOn",type:"radio",name:"formatting",checked:"false"!==this.state.settings.formatting,onChange:this.updateSetting.bind(this,"formatting","true")}),o.createElement(h.Z,{id:"user.settings.advance.on",defaultMessage:"On"})),o.createElement("br",null)),o.createElement("div",{className:"radio"},o.createElement("label",null,o.createElement("input",{id:"postFormattingOff",type:"radio",name:"formatting",checked:"false"===this.state.settings.formatting,onChange:this.updateSetting.bind(this,"formatting","false")}),o.createElement(h.Z,{id:"user.settings.advance.off",defaultMessage:"Off"})),o.createElement("br",null)),o.createElement("div",{className:"mt-5"},o.createElement(h.Z,{id:"user.settings.advance.formattingDesc",defaultMessage:"If enabled, posts will be formatted to create links, show emoji, style the text, and add line breaks. By default, this setting is enabled."})))],setting:"formatting",submit:this.handleSubmit,saving:this.state.isSaving,server_error:this.state.serverError,updateSection:this.handleUpdateSection}):o.createElement(S.Z,{title:o.createElement(h.Z,{id:"user.settings.advance.formattingTitle",defaultMessage:"Enable Post Formatting"}),describe:this.renderOnOffLabel(this.state.settings.formatting),section:"formatting",updateSection:this.handleUpdateSection}))),this.state=this.getStateFromProps()}renderOnOffLabel(e){return"false"===e?o.createElement(h.Z,{id:"user.settings.advance.off",defaultMessage:"Off"}):o.createElement(h.Z,{id:"user.settings.advance.on",defaultMessage:"On"})}renderCtrlEnterLabel(){const e=this.state.settings.send_on_ctrl_enter,t=this.state.settings.code_block_ctrl_enter;return"false"===e&&"false"===t?o.createElement(h.Z,{id:"user.settings.advance.off",defaultMessage:"Off"}):"true"===e&&"true"===t?o.createElement(h.Z,{id:"user.settings.advance.onForAllMessages",defaultMessage:"On for all messages"}):o.createElement(h.Z,{id:"user.settings.advance.onForCode",defaultMessage:"On only for code blocks starting with ```"})}renderFeatureLabel(e){switch(e){case"MARKDOWN_PREVIEW":return o.createElement(h.Z,{id:"user.settings.advance.markdown_preview",defaultMessage:"Show markdown preview option in message input box"});default:return null}}render(){const e=this.state.serverError||null;let t;const{ctrlSendTitle:s,ctrlSendDesc:a}=this.getCtrlSendText();if("advancedCtrlSend"===this.props.activeSection){const i=["true"===this.state.settings.send_on_ctrl_enter,"false"===this.state.settings.send_on_ctrl_enter&&"true"===this.state.settings.code_block_ctrl_enter,"false"===this.state.settings.send_on_ctrl_enter&&"false"===this.state.settings.code_block_ctrl_enter],n=[o.createElement("fieldset",{key:"ctrlSendSetting"},o.createElement("legend",{className:"form-legend hidden-label"},o.createElement(h.Z,s)),o.createElement("div",{className:"radio"},o.createElement("label",null,o.createElement("input",{id:"ctrlSendOn",type:"radio",name:"sendOnCtrlEnter",checked:i[0],onChange:()=>{this.updateSetting("send_on_ctrl_enter","true"),this.updateSetting("code_block_ctrl_enter","true")}}),o.createElement(h.Z,{id:"user.settings.advance.onForAllMessages",defaultMessage:"On for all messages"})),o.createElement("br",null)),o.createElement("div",{className:"radio"},o.createElement("label",null,o.createElement("input",{id:"ctrlSendOnForCode",type:"radio",name:"sendOnCtrlEnter",checked:i[1],onChange:()=>{this.updateSetting("send_on_ctrl_enter","false"),this.updateSetting("code_block_ctrl_enter","true")}}),o.createElement(h.Z,{id:"user.settings.advance.onForCode",defaultMessage:"On only for code blocks starting with ```"})),o.createElement("br",null)),o.createElement("div",{className:"radio"},o.createElement("label",null,o.createElement("input",{id:"ctrlSendOff",type:"radio",name:"sendOnCtrlEnter",checked:i[2],onChange:()=>{this.updateSetting("send_on_ctrl_enter","false"),this.updateSetting("code_block_ctrl_enter","false")}}),o.createElement(h.Z,{id:"user.settings.advance.off",defaultMessage:"Off"})),o.createElement("br",null)),o.createElement("div",null,o.createElement("br",null),o.createElement(h.Z,a)))];t=o.createElement(v.Z,{title:o.createElement(h.Z,s),inputs:n,submit:this.handleSubmit.bind(this,["send_on_ctrl_enter","code_block_ctrl_enter"]),saving:this.state.isSaving,server_error:e,updateSection:this.handleUpdateSection})}else t=o.createElement(S.Z,{title:o.createElement(h.Z,s),describe:this.renderCtrlEnterLabel(),section:"advancedCtrlSend",updateSection:this.handleUpdateSection});const i=this.renderFormattingSection();let n,r,l=null;if(i&&(l=o.createElement("div",{className:"divider-light"})),this.state.previewFeaturesEnabled&&this.state.preReleaseFeaturesKeys.length>0)if(r=o.createElement("div",{className:"divider-light"}),"advancedPreviewFeatures"===this.props.activeSection){const t=[];this.state.preReleaseFeaturesKeys.forEach((e=>{const s=this.state.preReleaseFeatures[e];t.push(o.createElement("div",{key:"advancedPreviewFeatures_"+s.label},o.createElement("div",{className:"checkbox"},o.createElement("label",null,o.createElement("input",{id:"advancedPreviewFeatures"+s.label,type:"checkbox",checked:"true"===this.state.settings[p.ZP.FeatureTogglePrefix+s.label],onChange:e=>{this.toggleFeature(s.label,e.target.checked)}}),this.renderFeatureLabel(e)))))})),t.push(o.createElement("div",{key:"advancedPreviewFeatures_helptext"},o.createElement("br",null),o.createElement(h.Z,{id:"user.settings.advance.preReleaseDesc",defaultMessage:"Check any pre-released features you'd like to preview.  You may also need to refresh the page before the setting will take effect."}))),n=o.createElement(v.Z,{title:o.createElement(h.Z,{id:"user.settings.advance.preReleaseTitle",defaultMessage:"Preview Pre-release Features"}),inputs:t,submit:this.saveEnabledFeatures,saving:this.state.isSaving,server_error:e,updateSection:this.handleUpdateSection})}else n=o.createElement(S.Z,{title:f._u("user.settings.advance.preReleaseTitle","Preview Pre-release Features"),describe:o.createElement(h.Z,{id:"user.settings.advance.enabledFeatures",defaultMessage:"{count, number} {count, plural, one {Feature} other {Features}} Enabled",values:{count:this.state.enabledFeatures}}),section:"advancedPreviewFeatures",updateSection:this.handleUpdateSection});let c="",d="";if(""===this.props.currentUser.auth_service&&this.props.enableUserDeactivation){c="deactivateAccount"===this.props.activeSection?o.createElement(v.Z,{title:o.createElement(h.Z,{id:"user.settings.advance.deactivateAccountTitle",defaultMessage:"Deactivate Account"}),inputs:[o.createElement("div",{key:"formattingSetting"},o.createElement("div",null,o.createElement("br",null),o.createElement(h.Z,{id:"user.settings.advance.deactivateDesc",defaultMessage:"Deactivating your account removes your ability to log in to this server and disables all email and mobile notifications. To reactivate your account, contact your System Administrator."})))],saveButtonText:"Deactivate",setting:"deactivateAccount",submit:this.handleShowDeactivateAccountModal,saving:this.state.isSaving,server_error:this.state.serverError,updateSection:this.handleUpdateSection}):o.createElement(S.Z,{title:o.createElement(h.Z,{id:"user.settings.advance.deactivateAccountTitle",defaultMessage:"Deactivate Account"}),describe:o.createElement(h.Z,{id:"user.settings.advance.deactivateDescShort",defaultMessage:"Click 'Edit' to deactivate your account"}),section:"deactivateAccount",updateSection:this.handleUpdateSection});const e="btn btn-danger",t=o.createElement(h.Z,{id:"user.settings.advance.deactivate_member_modal.deactivateButton",defaultMessage:"Yes, deactivate my account"});d=o.createElement(b.Z,{show:this.state.showDeactivateAccountModal,title:o.createElement(h.Z,{id:"user.settings.advance.confirmDeactivateAccountTitle",defaultMessage:"Confirm Deactivation"}),message:o.createElement(h.Z,{id:"user.settings.advance.confirmDeactivateDesc",defaultMessage:"Are you sure you want to deactivate your account? This can only be reversed by your System Administrator."}),confirmButtonClass:e,confirmButtonText:t,onConfirm:this.handleDeactivateAccountSubmit,onCancel:this.handleHideDeactivateAccountModal})}return o.createElement("div",null,o.createElement("div",{className:"modal-header"},o.createElement("button",{id:"closeButton",type:"button",className:"close","data-dismiss":"modal","aria-label":"Close",onClick:this.props.closeModal},o.createElement("span",{"aria-hidden":"true"},"×")),o.createElement("h4",{className:"modal-title",ref:"title"},o.createElement("div",{className:"modal-back"},o.createElement("span",{onClick:this.props.collapseModal},o.createElement(y.Z,null))),o.createElement(h.Z,{id:"user.settings.advance.title",defaultMessage:"Advanced Settings"}))),o.createElement("div",{className:"user-settings"},o.createElement("h3",{className:"tab-header"},o.createElement(h.Z,{id:"user.settings.advance.title",defaultMessage:"Advanced Settings"})),o.createElement("div",{className:"divider-dark first"}),t,l,i,o.createElement("div",{className:"divider-light"}),o.createElement(M,{activeSection:this.props.activeSection,onUpdateSection:this.handleUpdateSection,renderOnOffLabel:this.renderOnOffLabel}),r,n,l,c,o.createElement("div",{className:"divider-dark"}),d))}}C(k,"propTypes",{currentUser:r().object.isRequired,advancedSettingsCategory:r().array.isRequired,sendOnCtrlEnter:r().string.isRequired,codeBlockOnCtrlEnter:r().bool,formatting:r().string.isRequired,joinLeave:r().string.isRequired,updateSection:r().func,activeSection:r().string,closeModal:r().func.isRequired,collapseModal:r().func.isRequired,enablePreviewFeatures:r().bool,enableUserDeactivation:r().bool,actions:r().shape({savePreferences:r().func.isRequired,updateUserActive:r().func.isRequired,revokeAllSessionsForUser:r().func.isRequired}).isRequired});const w=(0,a.connect)((function(){const e=(0,d.YX)();return t=>{const s=(0,c.iE)(t),a="true"===s.EnablePreviewFeatures,n="true"===s.EnableUserDeactivation;return{advancedSettingsCategory:e(t,p.uP.CATEGORY_ADVANCED_SETTINGS),sendOnCtrlEnter:(0,d.U2)(t,p.uP.CATEGORY_ADVANCED_SETTINGS,"send_on_ctrl_enter","false"),codeBlockOnCtrlEnter:(0,d.U2)(t,p.uP.CATEGORY_ADVANCED_SETTINGS,"code_block_ctrl_enter","true"),formatting:(0,d.U2)(t,p.uP.CATEGORY_ADVANCED_SETTINGS,"formatting","true"),joinLeave:(0,d.U2)(t,p.uP.CATEGORY_ADVANCED_SETTINGS,"join_leave","true"),currentUser:(0,i.ts)(t),enablePreviewFeatures:a,enableUserDeactivation:n}}}),(function(e){return{actions:(0,l.bindActionCreators)({savePreferences:u.$A,updateUserActive:m.q0,revokeAllSessionsForUser:m.tG},e)}}))(k);var P=s(17198),O=s(88329),R=s(83175),Z=s(37893),I=(s(41817),s(58367)),D=s(78265),L=s(26721),U=(s(19601),s(4002)),x=s.n(U),q=s(73935),F=s(37780),G=s(50049),j=s(45597),z=s(68492),B=s(15558),V=s(6429),H=s(13039);function Y(e){return o.createElement(o.Fragment,null,o.createElement("label",{className:"custom-label"},e.label),o.createElement(H.Z,{id:e.id,value:e.value,onChange:t=>{var s;null===(s=e.onChange)||void 0===s||s.call(e,e.id,t)}}))}function K(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,a)}return s}function W(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?K(Object(s),!0).forEach((function(t){J(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):K(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}function J(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}Y.propTypes={id:r().string.isRequired,label:r().node.isRequired,value:r().string.isRequired,onChange:r().func};const X=(0,G.vU)({sidebarBg:{id:(0,E.t)("user.settings.custom_theme.sidebarBg"),defaultMessage:"Sidebar BG"},sidebarText:{id:(0,E.t)("user.settings.custom_theme.sidebarText"),defaultMessage:"Sidebar Text"},sidebarHeaderBg:{id:(0,E.t)("user.settings.custom_theme.sidebarHeaderBg"),defaultMessage:"Sidebar Header BG"},sidebarTeamBarBg:{id:(0,E.t)("user.settings.custom_theme.sidebarTeamBarBg"),defaultMessage:"Team Sidebar BG"},sidebarHeaderTextColor:{id:(0,E.t)("user.settings.custom_theme.sidebarHeaderTextColor"),defaultMessage:"Sidebar Header Text"},sidebarUnreadText:{id:(0,E.t)("user.settings.custom_theme.sidebarUnreadText"),defaultMessage:"Sidebar Unread Text"},sidebarTextHoverBg:{id:(0,E.t)("user.settings.custom_theme.sidebarTextHoverBg"),defaultMessage:"Sidebar Text Hover BG"},sidebarTextActiveBorder:{id:(0,E.t)("user.settings.custom_theme.sidebarTextActiveBorder"),defaultMessage:"Sidebar Text Active Border"},sidebarTextActiveColor:{id:(0,E.t)("user.settings.custom_theme.sidebarTextActiveColor"),defaultMessage:"Sidebar Text Active Color"},onlineIndicator:{id:(0,E.t)("user.settings.custom_theme.onlineIndicator"),defaultMessage:"Online Indicator"},awayIndicator:{id:(0,E.t)("user.settings.custom_theme.awayIndicator"),defaultMessage:"Away Indicator"},dndIndicator:{id:(0,E.t)("user.settings.custom_theme.dndIndicator"),defaultMessage:"Do Not Disturb Indicator"},mentionBg:{id:(0,E.t)("user.settings.custom_theme.mentionBg"),defaultMessage:"Mention Jewel BG"},mentionColor:{id:(0,E.t)("user.settings.custom_theme.mentionColor"),defaultMessage:"Mention Jewel Text"},centerChannelBg:{id:(0,E.t)("user.settings.custom_theme.centerChannelBg"),defaultMessage:"Center Channel BG"},centerChannelColor:{id:(0,E.t)("user.settings.custom_theme.centerChannelColor"),defaultMessage:"Center Channel Text"},newMessageSeparator:{id:(0,E.t)("user.settings.custom_theme.newMessageSeparator"),defaultMessage:"New Message Separator"},linkColor:{id:(0,E.t)("user.settings.custom_theme.linkColor"),defaultMessage:"Link Color"},buttonBg:{id:(0,E.t)("user.settings.custom_theme.buttonBg"),defaultMessage:"Button BG"},buttonColor:{id:(0,E.t)("user.settings.custom_theme.buttonColor"),defaultMessage:"Button Text"},errorTextColor:{id:(0,E.t)("user.settings.custom_theme.errorTextColor"),defaultMessage:"Error Text Color"},mentionHighlightBg:{id:(0,E.t)("user.settings.custom_theme.mentionHighlightBg"),defaultMessage:"Mention Highlight BG"},mentionHighlightLink:{id:(0,E.t)("user.settings.custom_theme.mentionHighlightLink"),defaultMessage:"Mention Highlight Link"},codeTheme:{id:(0,E.t)("user.settings.custom_theme.codeTheme"),defaultMessage:"Code Theme"}});class $ extends o.PureComponent{constructor(e){super(e),J(this,"handleColorChange",((e,t)=>{const{updateTheme:s,theme:a}=this.props;if(a[e]!==t){const i=W(W({},a),{},{type:"custom",[e]:t});"mentionBg"===e&&(i.mentionBj=t),s(i);const n=this.setCopyTheme(i);this.setState({copyTheme:n})}})),J(this,"pasteBoxChange",(e=>{let t,s="";if(s=window.clipboardData&&window.clipboardData.getData?window.clipboardData.getData("Text"):e.clipboardData.getData("Text"),0!==s.length){try{t=JSON.parse(s)}catch(e){return}(0,j.Yn)(t),this.setState({copyTheme:JSON.stringify(t)}),t.type="custom",this.props.updateTheme(t)}})),J(this,"onChangeHandle",(e=>{e.stopPropagation()})),J(this,"selectTheme",(()=>{const e=this.refs.textarea;e.focus(),e.setSelectionRange(0,this.state.copyTheme.length)})),J(this,"toggleSidebarStyles",(e=>{e.preventDefault(),this.refs.sidebarStylesHeader.classList.toggle("open"),this.toggleSection(this.refs.sidebarStyles)})),J(this,"toggleCenterChannelStyles",(e=>{e.preventDefault(),this.refs.centerChannelStylesHeader.classList.toggle("open"),this.toggleSection(this.refs.centerChannelStyles)})),J(this,"toggleLinkAndButtonStyles",(e=>{e.preventDefault(),this.refs.linkAndButtonStylesHeader.classList.toggle("open"),this.toggleSection(this.refs.linkAndButtonStyles)})),J(this,"onCodeThemeChange",(e=>{const t=W(W({},this.props.theme),{},{type:"custom",codeTheme:e.target.value});this.props.updateTheme(t)})),J(this,"copyTheme",(()=>{this.selectTheme(),document.execCommand("copy"),this.showCopySuccess()})),J(this,"showCopySuccess",(()=>{const e=document.querySelector(".copy-theme-success");e.style.display="inline-block",setTimeout((()=>{e.style.display="none"}),3e3)}));const t=this.setCopyTheme(this.props.theme);this.state={copyTheme:t}}setCopyTheme(e){const t=Object.assign({},e);return delete t.type,delete t.image,JSON.stringify(t)}toggleSection(e){e.classList.toggle("open"),e.ontransitionend=()=>{e.classList.contains("open")?e.style.overflowY="inherit":e.style.overflowY="hidden"}}render(){const e=this.props.theme,t=[],s=[],a=[];p.ZP.THEME_ELEMENTS.forEach(((i,n)=>{if("codeTheme"===i.id){const t=[];let a="";i.themes.forEach(((s,n)=>{s.id===e[i.id]&&(a=s.iconURL),t.push(o.createElement("option",{key:"code-theme-key"+n,value:s.id},s.uiName))}));var r=o.createElement(V.Z,{popoverStyle:"info",id:"code-popover",className:"code-popover"},o.createElement("img",{width:"200",alt:"code theme image",src:a}));s.push(o.createElement("div",{className:"col-sm-6 form-group",key:"custom-theme-key"+n},o.createElement("label",{className:"custom-label"},o.createElement(h.Z,X[i.id])),o.createElement("div",{className:"input-group theme-group group--code dropdown",id:i.id},o.createElement("select",{id:"codeThemeSelect",className:"form-control",type:"text",defaultValue:e[i.id],onChange:this.onCodeThemeChange},t),o.createElement(B.Z,{placement:"top",overlay:r,ref:"headerOverlay"},o.createElement("span",{className:"input-group-addon"},o.createElement("img",{alt:"code theme image",src:a}))))))}else if("centerChannelElements"===i.group)s.push(o.createElement("div",{className:"col-sm-6 form-group element",key:"custom-theme-key"+n},o.createElement(Y,{id:i.id,label:o.createElement(h.Z,X[i.id]),value:e[i.id],onChange:this.handleColorChange})));else if("sidebarElements"===i.group){let s=e[i.id];s||"mentionBg"!==i.id||(s=e.mentionBj),t.push(o.createElement("div",{className:"col-sm-6 form-group element",key:"custom-theme-key"+n},o.createElement(Y,{id:i.id,label:o.createElement(h.Z,X[i.id]),value:s,onChange:this.handleColorChange})))}else a.push(o.createElement("div",{className:"col-sm-6 form-group element",key:"custom-theme-key"+n},o.createElement(Y,{id:i.id,label:o.createElement(h.Z,X[i.id]),value:e[i.id],onChange:this.handleColorChange})))}));const i=o.createElement("div",{className:"col-sm-12"},o.createElement("label",{className:"custom-label"},o.createElement(h.Z,{id:"user.settings.custom_theme.copyPaste",defaultMessage:"Copy to share or paste theme colors here:"})),o.createElement("textarea",{ref:"textarea",className:"form-control",id:"pasteBox",value:this.state.copyTheme,onCopy:this.showCopySuccess,onPaste:this.pasteBoxChange,onChange:this.onChangeHandle,onClick:this.selectTheme}),o.createElement("div",{className:"mt-3"},o.createElement("button",{className:"btn btn-link copy-theme-button",onClick:this.copyTheme},o.createElement(h.Z,{id:"user.settings.custom_theme.copyThemeColors",defaultMessage:"Copy Theme Colors"})),o.createElement("span",{className:"alert alert-success copy-theme-success",role:"alert",style:{display:"none"}},o.createElement(h.Z,{id:"user.settings.custom_theme.copied",defaultMessage:"✔ Copied"}))));return o.createElement("div",{className:"appearance-section pt-2"},o.createElement("div",{className:"theme-elements row"},o.createElement("div",{ref:"sidebarStylesHeader",id:"sidebarStyles",className:"theme-elements__header",onClick:this.toggleSidebarStyles},o.createElement(h.Z,{id:"user.settings.custom_theme.sidebarTitle",defaultMessage:"Sidebar Styles"}),o.createElement("div",{className:"header__icon"},o.createElement(z.Z,{className:"fa fa-plus",title:{id:(0,E.t)("generic_icons.expand"),defaultMessage:"Expand Icon"}}),o.createElement(z.Z,{className:"fa fa-minus",title:{id:(0,E.t)("generic_icons.collapse"),defaultMessage:"Collapse Icon"}}))),o.createElement("div",{ref:"sidebarStyles",className:"theme-elements__body"},t)),o.createElement("div",{className:"theme-elements row"},o.createElement("div",{ref:"centerChannelStylesHeader",id:"centerChannelStyles",className:"theme-elements__header",onClick:this.toggleCenterChannelStyles},o.createElement(h.Z,{id:"user.settings.custom_theme.centerChannelTitle",defaultMessage:"Center Channel Styles"}),o.createElement("div",{className:"header__icon"},o.createElement(z.Z,{className:"fa fa-plus",title:{id:(0,E.t)("generic_icons.expand"),defaultMessage:"Expand Icon"}}),o.createElement(z.Z,{className:"fa fa-minus",title:{id:(0,E.t)("generic_icons.collapse"),defaultMessage:"Collapse Icon"}}))),o.createElement("div",{ref:"centerChannelStyles",id:"centerChannelStyles",className:"theme-elements__body"},s)),o.createElement("div",{className:"theme-elements row"},o.createElement("div",{ref:"linkAndButtonStylesHeader",id:"linkAndButtonsStyles",className:"theme-elements__header",onClick:this.toggleLinkAndButtonStyles},o.createElement(h.Z,{id:"user.settings.custom_theme.linkButtonTitle",defaultMessage:"Link and Button Styles"}),o.createElement("div",{className:"header__icon"},o.createElement(z.Z,{className:"fa fa-plus",title:{id:(0,E.t)("generic_icons.expand"),defaultMessage:"Expand Icon"}}),o.createElement(z.Z,{className:"fa fa-minus",title:{id:(0,E.t)("generic_icons.collapse"),defaultMessage:"Collapse Icon"}}))),o.createElement("div",{ref:"linkAndButtonStyles",className:"theme-elements__body"},a)),o.createElement("div",{className:"row mt-3"},i))}}J($,"propTypes",{theme:r().object.isRequired,updateTheme:r().func.isRequired}),s(23123),s(73210),s(15306);class Q extends o.PureComponent{render(){const e=this.props.theme,t=[],s=this.props.allowedThemes,a=s.length>1||s[0]&&s[0].trim().length>0;for(const i in p.ZP.THEMES)if(p.ZP.THEMES.hasOwnProperty(i)){if(a&&s.indexOf(i)<0)continue;const n=Object.assign({},p.ZP.THEMES[i]);let r="";n.type===e.type&&(r="active"),t.push(o.createElement("div",{className:"col-xs-6 col-sm-3 premade-themes",key:"premade-theme-key"+i},o.createElement("div",{id:"premadeTheme".concat(n.type.replace(" ","")),className:r,onClick:()=>this.props.updateTheme(n)},o.createElement("label",null,o.createElement("img",{alt:"premade theme "+i,className:"img-responsive",src:n.image}),o.createElement("div",{className:"theme-label"},f.cv(n.type))))))}return o.createElement("div",{className:"row appearance-section"},o.createElement("div",{className:"clearfix"},t))}}Q.propTypes={theme:r().object.isRequired,updateTheme:r().func.isRequired,allowedThemes:r().arrayOf(r().string)},Q.defaultProps={allowedThemes:[]};const ee=(0,a.connect)((function(e){const t=(0,c.iE)(e);return{allowedThemes:t.AllowedThemes&&t.AllowedThemes.split(",")||[]}}))(Q);function te(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,a)}return s}function se(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?te(Object(s),!0).forEach((function(t){ae(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):te(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}function ae(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class ie extends o.PureComponent{constructor(e){super(e),ae(this,"submitTheme",(async()=>{const e=this.state.applyToAllTeams?"":this.props.currentTeamId;this.setState({isSaving:!0}),await this.props.actions.saveTheme(e,this.state.theme),this.state.applyToAllTeams&&await this.props.actions.deleteTeamSpecificThemes(),this.props.setRequireConfirm(!1),this.originalTheme=Object.assign({},this.state.theme),this.props.updateSection(""),this.setState({isSaving:!1})})),ae(this,"updateTheme",(e=>{let t=this.state.theme.length===e.length;if(!t)for(const s in e)if(e.hasOwnProperty(s)&&this.state.theme[s]!==e[s]){t=!0;break}this.props.setRequireConfirm(t),this.setState({theme:e}),f._v(e)})),ae(this,"resetFields",(()=>{const e=this.getStateFromProps();e.serverError=null,this.setState(e),f._v(e.theme),this.props.setRequireConfirm(!1)})),ae(this,"handleImportModal",(()=>{F.Z.handleViewAction({type:p.MF.TOGGLE_IMPORT_THEME_MODAL,value:!0,callback:this.updateTheme}),this.props.setEnforceFocus(!1)})),ae(this,"handleUpdateSection",(e=>{this.props.updateSection(e)})),this.state=se(se({},this.getStateFromProps(e)),{},{isSaving:!1}),this.originalTheme=Object.assign({},this.state.theme)}componentDidMount(){this.props.selected&&x()(q.findDOMNode(this.refs[this.state.theme])).addClass("active-border")}componentDidUpdate(e){e.selected&&!this.props.selected&&this.resetFields(),this.props.selected&&(x()(".color-btn").removeClass("active-border"),x()(q.findDOMNode(this.refs[this.state.theme])).addClass("active-border"))}componentWillUnmount(){this.props.selected&&f._v(this.props.theme)}getStateFromProps(e=this.props){const t=se({},e.theme);return t.codeTheme||(t.codeTheme=p.gT.DEFAULT_CODE_THEME),{theme:t,type:t.type||"premade",showAllTeamsCheckbox:e.showAllTeamsCheckbox,applyToAllTeams:e.applyToAllTeams}}updateType(e){this.setState({type:e})}render(){let e;this.state.serverError&&(e=this.state.serverError);const t="custom"===this.state.type;let s,a,i;if(t&&this.props.allowCustomThemes?s=o.createElement("div",{key:"customThemeChooser"},o.createElement($,{theme:this.state.theme,updateTheme:this.updateTheme})):a=o.createElement("div",{key:"premadeThemeChooser"},o.createElement("br",null),o.createElement(ee,{theme:this.state.theme,updateTheme:this.updateTheme})),this.props.selected){const n=[];this.props.allowCustomThemes&&n.push(o.createElement("div",{className:"radio",key:"premadeThemeColorLabel"},o.createElement("label",null,o.createElement("input",{id:"standardThemes",type:"radio",name:"theme",checked:!t,onChange:this.updateType.bind(this,"premade")}),o.createElement(h.Z,{id:"user.settings.display.theme.themeColors",defaultMessage:"Theme Colors"})),o.createElement("br",null))),n.push(a),this.props.allowCustomThemes&&(n.push(o.createElement("div",{className:"radio",key:"customThemeColorLabel"},o.createElement("label",null,o.createElement("input",{id:"customThemes",type:"radio",name:"theme",checked:t,onChange:this.updateType.bind(this,"custom")}),o.createElement(h.Z,{id:"user.settings.display.theme.customTheme",defaultMessage:"Custom Theme"})))),n.push(s),n.push(o.createElement("div",{key:"otherThemes"},o.createElement("br",null),o.createElement("a",{id:"otherThemes",href:"http://docs.matterfoss.com/help/settings/theme-colors.html#custom-theme-examples",target:"_blank",rel:"noopener noreferrer"},o.createElement(h.Z,{id:"user.settings.display.theme.otherThemes",defaultMessage:"See other themes"})))),n.push(o.createElement("div",{key:"importSlackThemeButton",className:"pt-2"},o.createElement("button",{id:"slackImportTheme",className:"theme style--none color--link",onClick:this.handleImportModal},o.createElement(h.Z,{id:"user.settings.display.theme.import",defaultMessage:"Import theme colors from Slack"})))));let r=null;this.state.showAllTeamsCheckbox&&(r=o.createElement("div",{className:"checkbox user-settings__submit-checkbox"},o.createElement("label",null,o.createElement("input",{id:"applyThemeToAllTeams",type:"checkbox",checked:this.state.applyToAllTeams,onChange:e=>this.setState({applyToAllTeams:e.target.checked})}),o.createElement(h.Z,{id:"user.settings.display.theme.applyToAllTeams",defaultMessage:"Apply new theme to all my teams"})))),i=o.createElement(v.Z,{inputs:n,submitExtra:r,submit:this.submitTheme,disableEnterSubmit:!0,saving:this.state.isSaving,server_error:e,width:"full",updateSection:this.handleUpdateSection})}else i=o.createElement(S.Z,{title:o.createElement(h.Z,{id:"user.settings.display.theme.title",defaultMessage:"Theme"}),describe:o.createElement(h.Z,{id:"user.settings.display.theme.describe",defaultMessage:"Open to manage your theme"}),section:"theme",updateSection:this.handleUpdateSection,focused:this.props.focused});return i}}ae(ie,"propTypes",{actions:r().shape({saveTheme:r().func.isRequired,deleteTeamSpecificThemes:r().func.isRequired}).isRequired,currentTeamId:r().string.isRequired,theme:r().object,selected:r().bool.isRequired,updateSection:r().func.isRequired,setRequireConfirm:r().func.isRequired,setEnforceFocus:r().func.isRequired,allowCustomThemes:r().bool,focused:r().bool.isRequired});const ne=(0,a.connect)((function(){const e=(0,d.YX)();return t=>({currentTeamId:(0,L.ev)(t),theme:(0,d.gh)(t),applyToAllTeams:e(t,p.uP.CATEGORY_THEME).length<=1,showAllTeamsCheckbox:(0,L.Ew)(t)>1})}),(function(e){return{actions:(0,l.bindActionCreators)({saveTheme:u.DV,deleteTeamSpecificThemes:u.w_},e)}}))(ie);s(39714);var re=s(14504);function oe(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,a)}return s}function le(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?oe(Object(s),!0).forEach((function(t){ce(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):oe(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}function ce(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class de extends o.PureComponent{constructor(e){super(e),ce(this,"onChange",(e=>{e&&"value"in e&&this.setState({manualTimezoneInput:e.value,manualTimezone:e.value,selectedOption:e})})),ce(this,"handleTimezoneSelected",(e=>{e&&this.setState({manualTimezone:e,manualTimezoneInput:e})})),ce(this,"timezoneNotChanged",(()=>{const{useAutomaticTimezone:e,automaticTimezone:t,manualTimezone:s}=this.state,{useAutomaticTimezone:a,automaticTimezone:i,manualTimezone:n}=this.props;return e===a&&t===i&&s===n})),ce(this,"changeTimezone",(()=>{this.timezoneNotChanged()?this.props.updateSection(""):this.submitUser()})),ce(this,"submitUser",(()=>{const{user:e,actions:t}=this.props,{useAutomaticTimezone:s,automaticTimezone:a,manualTimezone:i}=this.state,n={useAutomaticTimezone:s.toString(),automaticTimezone:a,manualTimezone:i},r=le(le({},e),{},{timezone:n});t.updateMe(r).then((e=>{if("data"in e)this.props.updateSection("");else if("error"in e){const{error:t}=e;let s;s=t instanceof Error?t.message:t,this.setState({serverError:s,isSaving:!1})}}))})),ce(this,"handleAutomaticTimezone",(e=>{const t=e.target.checked;let s="";t&&(s=(0,I.x_)()),this.setState({useAutomaticTimezone:t,automaticTimezone:s})})),ce(this,"handleManualTimezone",(e=>{this.setState({manualTimezone:e.target.value})})),this.state={useAutomaticTimezone:e.useAutomaticTimezone,automaticTimezone:e.automaticTimezone,manualTimezone:e.manualTimezone,manualTimezoneInput:e.manualTimezone,isSaving:!1,openMenu:!1,selectedOption:{label:e.manualTimezone,value:e.manualTimezone}}}render(){const e=this.props.timezones.map((e=>({value:e,label:e}))),{timezones:t}=this.props,{useAutomaticTimezone:s}=this.state;let a;this.state.serverError&&(a=o.createElement("label",{className:"has-error"},this.state.serverError));const i=[],n={menuPortal:e=>le(le({},e),{},{zIndex:9999})},r=0===t.length,l=o.createElement("div",{className:"checkbox"},o.createElement("label",null,o.createElement("input",{id:"automaticTimezoneInput",type:"checkbox",checked:s,onChange:this.handleAutomaticTimezone,disabled:r}),o.createElement(h.Z,{id:"user.settings.timezones.automatic",defaultMessage:"Automatic"}))),c=o.createElement("div",{className:"pt-2"},o.createElement(re.ZP,{className:"react-select react-select-top",classNamePrefix:"react-select",id:"displayTimezone",menuPortalTarget:document.body,styles:n,options:e,clearable:!1,onChange:this.onChange,value:s?{label:this.state.automaticTimezone,value:this.state.automaticTimezone}:this.state.selectedOption,"aria-labelledby":"changeInterfaceTimezoneLabel",isDisabled:s}),a);return i.push(l),i.push(c),i.push(o.createElement("div",null,o.createElement("br",null),o.createElement(h.Z,{id:"user.settings.timezones.promote",defaultMessage:"Select the time zone used for timestamps in the user interface and email notifications."}))),o.createElement(v.Z,{title:o.createElement(h.Z,{id:"user.settings.display.timezone",defaultMessage:"Timezone"}),containerStyle:"timezone-container",width:"medium",submit:this.changeTimezone,saving:this.state.isSaving,inputs:i,updateSection:this.props.updateSection})}}ce(de,"propTypes",{updateSection:r().func.isRequired,useAutomaticTimezone:r().bool.isRequired,automaticTimezone:r().string.isRequired,manualTimezone:r().string.isRequired,timezones:r().arrayOf(r().string).isRequired,actions:r().shape({updateMe:r().func.isRequired}).isRequired});const ue=(0,a.connect)((function(e){return{timezones:(0,c.LG)(e)}}),(function(e){return{actions:(0,l.bindActionCreators)({updateMe:m.DO},e)}}))(de);var me=s(45288);function pe(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,a)}return s}function he(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?pe(Object(s),!0).forEach((function(t){ge(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):pe(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}function ge(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class fe extends o.PureComponent{constructor(e){super(e),ge(this,"reactSelectContainer",void 0),ge(this,"handleContainerKeyDown",(e=>{const t=document.querySelector(".modal-body");(0,f.pD)(e,p.ZP.KeyCodes.ESCAPE)&&this.state.openMenu&&(null==t||t.classList.remove("no-scroll"),this.setState({openMenu:!1}),e.stopPropagation())})),ge(this,"handleKeyDown",(e=>{const t=document.querySelector(".modal-body");(0,f.pD)(e,p.ZP.KeyCodes.ENTER)&&(null==t||t.classList.add("no-scroll"),this.setState({openMenu:!0}))})),ge(this,"setLanguage",(e=>{e&&"value"in e&&this.setState({locale:e.value,selectedOption:e})})),ge(this,"changeLanguage",(()=>{this.props.user.locale===this.state.locale?this.props.updateSection(""):this.submitUser(he(he({},this.props.user),{},{locale:this.state.locale}))})),ge(this,"submitUser",(e=>{this.setState({isSaving:!0}),this.props.actions.updateMe(e).then((e=>{if("data"in e);else if("error"in e){let t;const{error:s}=e;t=s instanceof Error?s.message:s,this.setState({serverError:t,isSaving:!1})}}))})),ge(this,"handleMenuClose",(()=>{const e=document.querySelector(".modal-body");e&&e.classList.remove("no-scroll"),this.setState({openMenu:!1})})),ge(this,"handleMenuOpen",(()=>{const e=document.querySelector(".modal-body");e&&e.classList.add("no-scroll"),this.setState({openMenu:!0})}));const t=D.Vb(),s=e.locale,a={value:t[s].value,label:t[s].name};this.reactSelectContainer=o.createRef(),this.state={locale:e.locale,selectedOption:a,isSaving:!1,openMenu:!1}}componentDidMount(){const e=this.reactSelectContainer.current;e&&e.addEventListener("keydown",this.handleContainerKeyDown)}componentWillUnmount(){this.reactSelectContainer.current&&this.reactSelectContainer.current.removeEventListener("keydown",this.handleContainerKeyDown)}render(){let e;this.state.serverError&&(e=o.createElement("label",{className:"has-error"},this.state.serverError));const t=[],s=D.Vb();Object.keys(s).map((e=>({value:s[e].value,name:s[e].name,order:s[e].order}))).sort(((e,t)=>e.order-t.order)).forEach((e=>{t.push({value:e.value,label:e.name})}));const a={menuPortal:e=>he(he({},e),{},{zIndex:9999})},i=o.createElement("div",{key:"changeLanguage"},o.createElement("br",null),o.createElement("label",{className:"control-label",id:"changeInterfaceLanguageLabel"},o.createElement(h.Z,{id:"user.settings.languages.change",defaultMessage:"Change interface language"})),o.createElement("div",{ref:this.reactSelectContainer,className:"pt-2"},o.createElement(re.ZP,{className:"react-select react-select-top",classNamePrefix:"react-select",id:"displayLanguage",menuIsOpen:this.state.openMenu,menuPortalTarget:document.body,styles:a,options:t,clearable:!1,onChange:this.setLanguage,onKeyDown:this.handleKeyDown,value:this.state.selectedOption,onMenuClose:this.handleMenuClose,onMenuOpen:this.handleMenuOpen,"aria-labelledby":"changeInterfaceLanguageLabel"}),e),o.createElement("div",null,o.createElement("br",null),o.createElement(me.Z,{id:"user.settings.languages.promote",defaultMessage:"Select which language MatterFOSS displays in the user interface.\\n \\nWould you like to help with translations? Join the [Mattermost Translation Server](!http://translate.mattermost.com/) to contribute."})));return o.createElement(v.Z,{title:o.createElement(h.Z,{id:"user.settings.display.language",defaultMessage:"Language"}),width:"medium",submit:this.changeLanguage,saving:this.state.isSaving,inputs:[i],updateSection:this.props.updateSection})}}ge(fe,"propTypes",{locale:r().string.isRequired,updateSection:r().func.isRequired,actions:r().shape({updateMe:r().func.isRequired}).isRequired});const Ee=(0,a.connect)(null,(function(e){return{actions:(0,l.bindActionCreators)({updateMe:m.DO},e)}}))(fe);function ve(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,a)}return s}function Se(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?ve(Object(s),!0).forEach((function(t){be(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):ve(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}function be(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}const ye=p.ZP.Preferences;function _e(e){return{militaryTime:e.militaryTime,teammateNameDisplay:e.teammateNameDisplay,availabilityStatusOnPosts:e.availabilityStatusOnPosts,channelDisplayMode:e.channelDisplayMode,messageDisplay:e.messageDisplay,collapseDisplay:e.collapseDisplay,collapsedReplyThreads:e.collapsedReplyThreads,linkPreviewDisplay:e.linkPreviewDisplay}}class Te extends o.PureComponent{constructor(e){super(e),be(this,"prevSections",void 0),be(this,"handleSubmit",(async()=>{const e=this.props.user.id,t={user_id:e,category:ye.CATEGORY_DISPLAY_SETTINGS,name:ye.USE_MILITARY_TIME,value:this.state.militaryTime},s={user_id:e,category:ye.CATEGORY_DISPLAY_SETTINGS,name:ye.AVAILABILITY_STATUS_ON_POSTS,value:this.state.availabilityStatusOnPosts},a={user_id:e,category:ye.CATEGORY_DISPLAY_SETTINGS,name:ye.NAME_NAME_FORMAT,value:this.state.teammateNameDisplay},i={user_id:e,category:ye.CATEGORY_DISPLAY_SETTINGS,name:ye.CHANNEL_DISPLAY_MODE,value:this.state.channelDisplayMode},n={user_id:e,category:ye.CATEGORY_DISPLAY_SETTINGS,name:ye.MESSAGE_DISPLAY,value:this.state.messageDisplay},r={user_id:e,category:ye.CATEGORY_DISPLAY_SETTINGS,name:ye.COLLAPSE_DISPLAY,value:this.state.collapseDisplay},o={user_id:e,category:ye.CATEGORY_DISPLAY_SETTINGS,name:ye.COLLAPSED_REPLY_THREADS,value:this.state.collapsedReplyThreads},l={user_id:e,category:ye.CATEGORY_DISPLAY_SETTINGS,name:ye.LINK_PREVIEW_DISPLAY,value:this.state.linkPreviewDisplay};this.setState({isSaving:!0});const c=[t,i,n,o,r,l,a,s];await this.props.actions.savePreferences(e,c),this.updateSection("")})),be(this,"handleClockRadio",(e=>{this.setState({militaryTime:e})})),be(this,"handleTeammateNameDisplayRadio",(e=>{this.setState({teammateNameDisplay:e})})),be(this,"handleAvailabilityStatusRadio",(e=>{this.setState({availabilityStatusOnPosts:e})})),be(this,"updateSection",(e=>{this.updateState(),this.props.updateSection(e)})),be(this,"updateState",(()=>{const e=_e(this.props);f.JB(e,this.state)||this.setState(e),this.setState({isSaving:!1})})),this.state=Se(Se({},_e(e)),{},{isSaving:!1}),0===e.timezones.length&&e.actions.getSupportedTimezones(),this.prevSections={theme:"dummySectionName",clock:"theme",linkpreview:"clock",message_display:"linkpreview",channel_display_mode:"message_display",languages:"channel_display_mode"}}componentDidMount(){const{actions:e,enableTimezone:t,shouldAutoUpdateTimezone:s}=this.props;t&&s&&e.autoUpdateTimezone((0,I.x_)())}componentDidUpdate(e){this.props.teammateNameDisplay!==e.teammateNameDisplay&&this.updateState()}handleChannelDisplayModeRadio(e){this.setState({channelDisplayMode:e})}handlemessageDisplayRadio(e){this.setState({messageDisplay:e})}handleCollapseRadio(e){this.setState({collapseDisplay:e})}handleCollapseReplyThreadsRadio(e){this.setState({collapsedReplyThreads:e})}handleLinkPreviewRadio(e){this.setState({linkPreviewDisplay:e})}handleOnChange(e){this.setState(Se({},e))}createSection(e){const{section:t,display:s,value:a,title:i,firstOption:n,secondOption:r,thirdOption:l,description:c,disabled:d}=e;let u=null,m=this.handleSubmit;const p=o.createElement(h.Z,{id:n.radionButtonText.id,defaultMessage:n.radionButtonText.message});let g,f;n.radionButtonText.moreId&&(g=": ",f=o.createElement("span",{className:"font-weight--normal"},o.createElement(h.Z,{id:n.radionButtonText.moreId,defaultMessage:n.radionButtonText.moreMessage})));const E=o.createElement(h.Z,{id:r.radionButtonText.id,defaultMessage:r.radionButtonText.message});let b,y;r.radionButtonText.moreId&&(b=o.createElement("span",{className:"font-weight--normal"},o.createElement(h.Z,{id:r.radionButtonText.moreId,defaultMessage:r.radionButtonText.moreMessage}))),l&&(y=o.createElement(h.Z,{id:l.radionButtonText.id,defaultMessage:l.radionButtonText.message}));const _=o.createElement(h.Z,{id:i.id,defaultMessage:i.message}),T=o.createElement(h.Z,{id:c.id,defaultMessage:c.message});if(this.props.activeSection===t){const e=[!1,!1,!1];a===n.value?e[0]=!0:a===r.value?e[1]=!0:e[2]=!0;const i=t+"Format",c=t+"UserDisplay",S={[s]:n.value},N={[s]:r.value};let M;if(l&&y){const t={[s]:l.value};M=o.createElement("div",{className:"radio"},o.createElement("label",null,o.createElement("input",{id:i+"C",type:"radio",name:i,checked:e[2],onChange:()=>this.handleOnChange(t)}),y),o.createElement("br",null))}let C=[o.createElement("fieldset",{key:c},o.createElement("legend",{className:"form-legend hidden-label"},_),o.createElement("div",{className:"radio"},o.createElement("label",null,o.createElement("input",{id:i+"A",type:"radio",name:i,checked:e[0],onChange:()=>this.handleOnChange(S)}),p,g,f),o.createElement("br",null)),o.createElement("div",{className:"radio"},o.createElement("label",null,o.createElement("input",{id:i+"B",type:"radio",name:i,checked:e[1],onChange:()=>this.handleOnChange(N)}),E,g,b),o.createElement("br",null)),M,o.createElement("div",null,o.createElement("br",null),T))];return"teammateNameDisplay"===s&&d&&(u=o.createElement("span",null,o.createElement(h.Z,{id:"user.settings.display.teammateNameDisplay",defaultMessage:"This field is handled through your System Administrator. If you want to change it, you need to do so through your System Administrator."})),m=null,C=[]),o.createElement("div",null,o.createElement(v.Z,{title:_,inputs:C,submit:m,saving:this.state.isSaving,server_error:this.state.serverError,updateSection:this.updateSection,extraInfo:u}),o.createElement("div",{className:"divider-dark"}))}let N;return N=a===n.value?p:a===r.value?E:y,o.createElement("div",null,o.createElement(S.Z,{title:_,describe:N,section:t,updateSection:this.updateSection}),o.createElement("div",{className:"divider-dark"}))}render(){const e=this.createSection({section:"collapse",display:"collapseDisplay",value:this.state.collapseDisplay,defaultDisplay:"false",title:{id:(0,E.t)("user.settings.display.collapseDisplay"),message:"Default Appearance of Image Previews"},firstOption:{value:"false",radionButtonText:{id:(0,E.t)("user.settings.display.collapseOn"),message:"On"}},secondOption:{value:"true",radionButtonText:{id:(0,E.t)("user.settings.display.collapseOff"),message:"Off"}},description:{id:(0,E.t)("user.settings.display.collapseDesc"),message:"Set whether previews of image links and image attachment thumbnails show as expanded or collapsed by default. This setting can also be controlled using the slash commands /expand and /collapse."}});let t=null;this.props.enableLinkPreviews?(t=this.createSection({section:"linkpreview",display:"linkPreviewDisplay",value:this.state.linkPreviewDisplay,defaultDisplay:"true",title:{id:(0,E.t)("user.settings.display.linkPreviewDisplay"),message:"Website Link Previews"},firstOption:{value:"true",radionButtonText:{id:(0,E.t)("user.settings.display.linkPreviewOn"),message:"On"}},secondOption:{value:"false",radionButtonText:{id:(0,E.t)("user.settings.display.linkPreviewOff"),message:"Off"}},description:{id:(0,E.t)("user.settings.display.linkPreviewDesc"),message:"When available, the first web link in a message will show a preview of the website content below the message."}}),this.prevSections.message_display="linkpreview"):this.prevSections.message_display=this.prevSections.linkpreview;const s=this.createSection({section:"clock",display:"militaryTime",value:this.state.militaryTime,defaultDisplay:"false",title:{id:(0,E.t)("user.settings.display.clockDisplay"),message:"Clock Display"},firstOption:{value:"false",radionButtonText:{id:(0,E.t)("user.settings.display.normalClock"),message:"12-hour clock (example: 4:00 PM)"}},secondOption:{value:"true",radionButtonText:{id:(0,E.t)("user.settings.display.militaryClock"),message:"24-hour clock (example: 16:00)"}},description:{id:(0,E.t)("user.settings.display.preferTime"),message:"Select how you prefer time displayed."}}),a=this.createSection({section:ye.NAME_NAME_FORMAT,display:"teammateNameDisplay",value:this.props.lockTeammateNameDisplay?this.props.configTeammateNameDisplay:this.state.teammateNameDisplay,defaultDisplay:this.props.configTeammateNameDisplay,title:{id:(0,E.t)("user.settings.display.teammateNameDisplayTitle"),message:"Teammate Name Display"},firstOption:{value:p.ZP.TEAMMATE_NAME_DISPLAY.SHOW_USERNAME,radionButtonText:{id:(0,E.t)("user.settings.display.teammateNameDisplayUsername"),message:"Show username"}},secondOption:{value:p.ZP.TEAMMATE_NAME_DISPLAY.SHOW_NICKNAME_FULLNAME,radionButtonText:{id:(0,E.t)("user.settings.display.teammateNameDisplayNicknameFullname"),message:"Show nickname if one exists, otherwise show first and last name"}},thirdOption:{value:p.ZP.TEAMMATE_NAME_DISPLAY.SHOW_FULLNAME,radionButtonText:{id:(0,E.t)("user.settings.display.teammateNameDisplayFullname"),message:"Show first and last name"}},description:{id:(0,E.t)("user.settings.display.teammateNameDisplayDescription"),message:"Set how to display other user's names in posts and the Direct Messages list."},disabled:this.props.lockTeammateNameDisplay}),i=this.createSection({section:"availabilityStatus",display:"availabilityStatusOnPosts",value:this.state.availabilityStatusOnPosts,defaultDisplay:"true",title:{id:(0,E.t)("user.settings.display.availabilityStatusOnPostsTitle"),message:"Show user availability on posts"},firstOption:{value:"true",radionButtonText:{id:(0,E.t)("user.settings.sidebar.on"),message:"On"}},secondOption:{value:"false",radionButtonText:{id:(0,E.t)("user.settings.sidebar.off"),message:"Off"}},description:{id:(0,E.t)("user.settings.display.availabilityStatusOnPostsDescription"),message:"When enabled, online availability is displayed on profile images in the message list."}});let n;if(this.props.enableTimezone&&!this.props.shouldAutoUpdateTimezone){const e=this.props.userTimezone;n="timezone"===this.props.activeSection?o.createElement("div",null,o.createElement(ue,{user:this.props.user,useAutomaticTimezone:Boolean(e.useAutomaticTimezone),automaticTimezone:e.automaticTimezone,manualTimezone:e.manualTimezone,updateSection:this.updateSection}),o.createElement("div",{className:"divider-dark"})):o.createElement("div",null,o.createElement(S.Z,{title:o.createElement(h.Z,{id:"user.settings.display.timezone",defaultMessage:"Timezone"}),describe:(0,Z.S)(this.props.currentUserTimezone),section:"timezone",updateSection:this.updateSection}),o.createElement("div",{className:"divider-dark"}))}const r=this.createSection({section:ye.MESSAGE_DISPLAY,display:"messageDisplay",value:this.state.messageDisplay,defaultDisplay:ye.MESSAGE_DISPLAY_CLEAN,title:{id:(0,E.t)("user.settings.display.messageDisplayTitle"),message:"Message Display"},firstOption:{value:ye.MESSAGE_DISPLAY_CLEAN,radionButtonText:{id:(0,E.t)("user.settings.display.messageDisplayClean"),message:"Standard",moreId:(0,E.t)("user.settings.display.messageDisplayCleanDes"),moreMessage:"Easy to scan and read."}},secondOption:{value:ye.MESSAGE_DISPLAY_COMPACT,radionButtonText:{id:(0,E.t)("user.settings.display.messageDisplayCompact"),message:"Compact",moreId:(0,E.t)("user.settings.display.messageDisplayCompactDes"),moreMessage:"Fit as many messages on the screen as we can."}},description:{id:(0,E.t)("user.settings.display.messageDisplayDescription"),message:"Select how messages in a channel should be displayed."}});let l;this.props.collapsedReplyThreadsAllowUserPreference&&(l=this.createSection({section:ye.COLLAPSED_REPLY_THREADS,display:"collapsedReplyThreads",value:this.state.collapsedReplyThreads,defaultDisplay:ye.COLLAPSED_REPLY_THREADS_FALLBACK_DEFAULT,title:{id:(0,E.t)("user.settings.display.collapsedReplyThreadsTitle"),message:"Collapsed Reply Threads (Beta)"},firstOption:{value:ye.COLLAPSED_REPLY_THREADS_ON,radionButtonText:{id:(0,E.t)("user.settings.display.collapsedReplyThreadsOn"),message:"On"}},secondOption:{value:ye.COLLAPSED_REPLY_THREADS_OFF,radionButtonText:{id:(0,E.t)("user.settings.display.collapsedReplyThreadsOff"),message:"Off"}},description:{id:(0,E.t)("user.settings.display.collapsedReplyThreadsDescription"),message:"When enabled, reply messages are not shown in the channel view. You can still read and reply to threads in the right-hand sidebar. You'll be notified about threads you're following in a new \"Threads\" item in the channel sidebar."}}));const c=this.createSection({section:ye.CHANNEL_DISPLAY_MODE,display:"channelDisplayMode",value:this.state.channelDisplayMode,defaultDisplay:ye.CHANNEL_DISPLAY_MODE_FULL_SCREEN,title:{id:(0,E.t)("user.settings.display.channelDisplayTitle"),message:"Channel Display"},firstOption:{value:ye.CHANNEL_DISPLAY_MODE_FULL_SCREEN,radionButtonText:{id:(0,E.t)("user.settings.display.fullScreen"),message:"Full width"}},secondOption:{value:ye.CHANNEL_DISPLAY_MODE_CENTERED,radionButtonText:{id:(0,E.t)("user.settings.display.fixedWidthCentered"),message:"Fixed width, centered"}},description:{id:(0,E.t)("user.settings.display.channeldisplaymode"),message:"Select the width of the center channel."}});let d,u,m=this.props.user.locale;if("languages"===this.props.activeSection)D.cY(m)||(m=this.props.defaultClientLocale),d=o.createElement("div",null,o.createElement(Ee,{user:this.props.user,locale:m,updateSection:this.updateSection}),o.createElement("div",{className:"divider-dark"}));else{let e;e=D.cY(m)?D.fK(m).name:D.fK(this.props.defaultClientLocale).name,d=o.createElement("div",null,o.createElement(S.Z,{title:o.createElement(h.Z,{id:"user.settings.display.language",defaultMessage:"Language"}),describe:e,section:"languages",updateSection:this.updateSection}),o.createElement("div",{className:"divider-dark"}))}return 1===Object.keys(D.Vb()).length&&(d=null),this.props.enableThemeSelection&&(u=o.createElement("div",null,o.createElement(ne,{selected:"theme"===this.props.activeSection,updateSection:this.updateSection,setRequireConfirm:this.props.setRequireConfirm,setEnforceFocus:this.props.setEnforceFocus,allowCustomThemes:this.props.allowCustomThemes}),o.createElement("div",{className:"divider-dark"}))),o.createElement("div",{id:"displaySettings"},o.createElement("div",{className:"modal-header"},o.createElement("button",{id:"closeButton",type:"button",className:"close","data-dismiss":"modal","aria-label":"Close",onClick:this.props.closeModal},o.createElement("span",{"aria-hidden":"true"},"×")),o.createElement("h4",{className:"modal-title",ref:"title"},o.createElement("div",{className:"modal-back"},o.createElement("span",{onClick:this.props.collapseModal},o.createElement(y.Z,null))),o.createElement(h.Z,{id:"user.settings.display.title",defaultMessage:"Display Settings"}))),o.createElement("div",{className:"user-settings"},o.createElement("h3",{id:"displaySettingsTitle",className:"tab-header"},o.createElement(h.Z,{id:"user.settings.display.title",defaultMessage:"Display Settings"})),o.createElement("div",{className:"divider-dark first"}),u,s,a,i,n,t,e,r,l,c,d))}}be(Te,"propTypes",{updateSection:r().func.isRequired,activeSection:r().string,closeModal:r().func,collapseModal:r().func,setRequireConfirm:r().func,setEnforceFocus:r().func,timezones:r().arrayOf(r().string).isRequired,allowCustomThemes:r().bool.isRequired,enableLinkPreviews:r().bool.isRequired,defaultClientLocale:r().string.isRequired,enableThemeSelection:r().bool.isRequired,configTeammateNameDisplay:r().string.isRequired,currentUserTimezone:r().string.isRequired,enableTimezone:r().bool.isRequired,shouldAutoUpdateTimezone:r().bool.isRequired,lockTeammateNameDisplay:r().bool.isRequired,militaryTime:r().string.isRequired,teammateNameDisplay:r().string.isRequired,availabilityStatusOnPosts:r().string.isRequired,channelDisplayMode:r().string.isRequired,messageDisplay:r().string.isRequired,collapseDisplay:r().string.isRequired,collapsedReplyThreads:r().string.isRequired,collapsedReplyThreadsAllowUserPreference:r().bool.isRequired,linkPreviewDisplay:r().string.isRequired});const Ne=(0,a.connect)((function(e){const t=(0,c.iE)(e),s=(0,c.LG)(e),a=(0,i.rc)(e),n=(0,R.S)(e,a),r=n&&n.useAutomaticTimezone&&!n.automaticTimezone,o=!n||r,l="true"===t.AllowCustomThemes,u="true"===t.EnableLinkPreviews,m=t.DefaultClientLocale,h="true"===t.EnableThemeSelection,g="true"===t.ExperimentalTimezone,f="true"===(0,c.lJ)(e).LockTeammateNameDisplay&&"true"===t.LockTeammateNameDisplay,E=t.TeammateNameDisplay;return{lockTeammateNameDisplay:f,allowCustomThemes:l,configTeammateNameDisplay:E,enableLinkPreviews:u,defaultClientLocale:m,enableThemeSelection:h,enableTimezone:g,timezones:s,userTimezone:n,shouldAutoUpdateTimezone:o,currentUserTimezone:(0,Z.G)(n),availabilityStatusOnPosts:(0,d.U2)(e,p.uP.CATEGORY_DISPLAY_SETTINGS,p.uP.AVAILABILITY_STATUS_ON_POSTS,p.uP.AVAILABILITY_STATUS_ON_POSTS_DEFAULT),militaryTime:(0,d.U2)(e,p.uP.CATEGORY_DISPLAY_SETTINGS,p.uP.USE_MILITARY_TIME,p.uP.USE_MILITARY_TIME_DEFAULT),teammateNameDisplay:(0,d.U2)(e,p.uP.CATEGORY_DISPLAY_SETTINGS,p.uP.NAME_NAME_FORMAT,E),channelDisplayMode:(0,d.U2)(e,p.uP.CATEGORY_DISPLAY_SETTINGS,p.uP.CHANNEL_DISPLAY_MODE,p.uP.CHANNEL_DISPLAY_MODE_DEFAULT),messageDisplay:(0,d.U2)(e,p.uP.CATEGORY_DISPLAY_SETTINGS,p.uP.MESSAGE_DISPLAY,p.uP.MESSAGE_DISPLAY_DEFAULT),collapseDisplay:(0,d.U2)(e,p.uP.CATEGORY_DISPLAY_SETTINGS,p.uP.COLLAPSE_DISPLAY,p.uP.COLLAPSE_DISPLAY_DEFAULT),collapsedReplyThreadsAllowUserPreference:(0,d.OU)(e)&&"always_on"!==(0,c.iE)(e).CollapsedThreads,collapsedReplyThreads:(0,d.b$)(e),linkPreviewDisplay:(0,d.U2)(e,p.uP.CATEGORY_DISPLAY_SETTINGS,p.uP.LINK_PREVIEW_DISPLAY,p.uP.LINK_PREVIEW_DISPLAY_DEFAULT)}}),(function(e){return{actions:(0,l.bindActionCreators)({getSupportedTimezones:P.LG,autoUpdateTimezone:O.g,savePreferences:u.$A},e)}}))(Te);var Me=s(53687),Ce=(s(32023),s(74806)),Ae=s(17310),ke=s(59925),we=s(68538),Pe=s(21843);function Oe(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}const Re=(0,G.vU)({usernameReserved:{id:(0,E.t)("user.settings.general.usernameReserved"),defaultMessage:"This username is reserved, please choose a new one."},usernameRestrictions:{id:(0,E.t)("user.settings.general.usernameRestrictions"),defaultMessage:"Username must begin with a letter, and contain between {min} to {max} lowercase characters made up of numbers, letters, and the symbols '.', '-', and '_'."},validEmail:{id:(0,E.t)("user.settings.general.validEmail"),defaultMessage:"Please enter a valid email address."},emailMatch:{id:(0,E.t)("user.settings.general.emailMatch"),defaultMessage:"The new emails you entered do not match."},incorrectPassword:{id:(0,E.t)("user.settings.general.incorrectPassword"),defaultMessage:"Your password is incorrect."},emptyPassword:{id:(0,E.t)("user.settings.general.emptyPassword"),defaultMessage:"Please enter your current password."},validImage:{id:(0,E.t)("user.settings.general.validImage"),defaultMessage:"Only BMP, JPG or PNG images may be used for profile pictures"},imageTooLarge:{id:(0,E.t)("user.settings.general.imageTooLarge"),defaultMessage:"Unable to upload profile image. File is too large."},uploadImage:{id:(0,E.t)("user.settings.general.uploadImage"),defaultMessage:"Click 'Edit' to upload an image."},uploadImageMobile:{id:(0,E.t)("user.settings.general.mobile.uploadImage"),defaultMessage:"Click to upload an image"},fullName:{id:(0,E.t)("user.settings.general.fullName"),defaultMessage:"Full Name"},nickname:{id:(0,E.t)("user.settings.general.nickname"),defaultMessage:"Nickname"},username:{id:(0,E.t)("user.settings.general.username"),defaultMessage:"Username"},profilePicture:{id:(0,E.t)("user.settings.general.profilePicture"),defaultMessage:"Profile Picture"},close:{id:(0,E.t)("user.settings.general.close"),defaultMessage:"Close"},position:{id:(0,E.t)("user.settings.general.position"),defaultMessage:"Position"}});class Ze extends o.Component{constructor(e){super(e),Oe(this,"submitActive",!1),Oe(this,"handleEmailResend",(e=>{this.setState({resendStatus:"sending",showSpinner:!0}),this.props.actions.sendVerificationEmail(e).then((({data:e,error:t})=>{e?this.setState({resendStatus:"success"}):t&&this.setState({resendStatus:"failure"})}))})),Oe(this,"createEmailResendLink",(e=>o.createElement("span",{className:"resend-verification-wrapper"},o.createElement(Pe.Z,{loading:this.state.showSpinner,text:f._u("user.settings.general.sending","Sending")},o.createElement("a",{onClick:()=>{this.handleEmailResend(e),setTimeout((()=>{this.setState({showSpinner:!1})}),500)}},o.createElement(h.Z,{id:"user.settings.general.sendAgain",defaultMessage:"Send again"})))))),Oe(this,"submitUsername",(()=>{const e=Object.assign({},this.props.user),t=this.state.username.trim().toLowerCase(),{formatMessage:s}=this.props.intl,a=f.rh(t);if(a){let e;return e=a.id===p.qf.RESERVED_NAME?{clientError:s(Re.usernameReserved),serverError:""}:{clientError:s(Re.usernameRestrictions,{min:p.gT.MIN_USERNAME_LENGTH,max:p.gT.MAX_USERNAME_LENGTH}),serverError:""},void this.setState(e)}e.username!==t?(e.username=t,(0,ke.L9)("settings","user_settings_update",{field:"username"}),this.submitUser(e,!1)):this.updateSection("")})),Oe(this,"submitNickname",(()=>{const e=Object.assign({},this.props.user),t=this.state.nickname.trim();e.nickname!==t?(e.nickname=t,(0,ke.L9)("settings","user_settings_update",{field:"nickname"}),this.submitUser(e,!1)):this.updateSection("")})),Oe(this,"submitName",(()=>{const e=Object.assign({},this.props.user),t=this.state.firstName.trim(),s=this.state.lastName.trim();e.first_name!==t||e.last_name!==s?(e.first_name=t,e.last_name=s,(0,ke.L9)("settings","user_settings_update",{field:"fullname"}),this.submitUser(e,!1)):this.updateSection("")})),Oe(this,"submitEmail",(()=>{const e=Object.assign({},this.props.user),t=this.state.email.trim().toLowerCase(),s=this.state.confirmEmail.trim().toLowerCase(),a=this.state.currentPassword,{formatMessage:i}=this.props.intl;t!==e.email||""!==s&&s!==e.email?""!==t&&(0,Ae.Jh)(t)?t===s?""!==a?(e.email=t,e.password=a,(0,ke.L9)("settings","user_settings_update",{field:"email"}),this.submitUser(e,!0)):this.setState({emailError:i(Re.emptyPassword),clientError:"",serverError:""}):this.setState({emailError:i(Re.emailMatch),clientError:"",serverError:""}):this.setState({emailError:i(Re.validEmail),clientError:"",serverError:""}):this.updateSection("")})),Oe(this,"submitUser",((e,t)=>{const{formatMessage:s}=this.props.intl;this.setState({sectionIsSaving:!0}),this.props.actions.updateMe(e).then((({data:e,error:a})=>{if(e)this.updateSection(""),this.props.actions.getMe(),this.props.requireEmailVerification&&t&&(this.props.actions.clearErrors(),this.props.actions.logError({message:p.MN.EMAIL_VERIFICATION_REQUIRED,type:p.Mw.SUCCESS},!0));else if(a){let e;e=a.server_error_id&&"api.user.check_user_password.invalid.app_error"===a.server_error_id?s(Re.incorrectPassword):a.message?a.message:a,this.setState({serverError:e,emailError:"",clientError:"",sectionIsSaving:!1})}}))})),Oe(this,"setDefaultProfilePicture",(async()=>{try{await this.props.actions.setDefaultProfileImage(this.props.user.id),this.updateSection(""),this.submitActive=!1}catch(e){let t;t=e.message?e.message:e,this.setState({serverError:t,emailError:"",clientError:"",sectionIsSaving:!1})}})),Oe(this,"submitPicture",(()=>{if(!this.state.pictureFile)return;if(!this.submitActive)return;(0,ke.L9)("settings","user_settings_update",{field:"picture"});const{formatMessage:e}=this.props.intl,t=this.state.pictureFile;p.Ec.includes(t.type)?t.size>this.props.maxFileSize?this.setState({clientError:e(Re.imageTooLarge),serverError:""}):(this.setState({loadingPicture:!0}),this.props.actions.uploadProfileImage(this.props.user.id,t).then((({data:e,error:t})=>{if(e)this.updateSection(""),this.submitActive=!1;else if(t){const e=this.setupInitialState(this.props);e.serverError=t.message,this.setState(e)}}))):this.setState({clientError:e(Re.validImage),serverError:""})})),Oe(this,"submitPosition",(()=>{const e=Object.assign({},this.props.user),t=this.state.position.trim();e.position!==t?(e.position=t,(0,ke.L9)("settings","user_settings_update",{field:"position"}),this.submitUser(e,!1)):this.updateSection("")})),Oe(this,"updateUsername",(e=>{this.setState({username:e.target.value})})),Oe(this,"updateFirstName",(e=>{this.setState({firstName:e.target.value})})),Oe(this,"updateLastName",(e=>{this.setState({lastName:e.target.value})})),Oe(this,"updateNickname",(e=>{this.setState({nickname:e.target.value})})),Oe(this,"updatePosition",(e=>{this.setState({position:e.target.value})})),Oe(this,"updateEmail",(e=>{this.setState({email:e.target.value})})),Oe(this,"updateConfirmEmail",(e=>{this.setState({confirmEmail:e.target.value})})),Oe(this,"updateCurrentPassword",(e=>{this.setState({currentPassword:e.target.value})})),Oe(this,"updatePicture",(e=>{e.target.files&&e.target.files[0]?(this.setState({pictureFile:e.target.files[0]}),this.submitActive=!0,this.setState({clientError:null})):this.setState({pictureFile:null})})),Oe(this,"updateSection",(e=>{this.setState(Object.assign({},this.setupInitialState(this.props),{clientError:"",serverError:"",emailError:"",sectionIsSaving:!1})),this.submitActive=!1,this.props.updateSection(e)})),this.state=this.setupInitialState(e)}setupInitialState(e){const t=e.user;return{username:t.username,firstName:t.first_name,lastName:t.last_name,nickname:t.nickname,position:t.position,originalEmail:t.email,email:"",confirmEmail:"",currentPassword:"",pictureFile:null,loadingPicture:!1,sectionIsSaving:!1,showSpinner:!1,serverError:""}}createEmailSection(){const{formatMessage:e}=this.props.intl;let t;if("email"===this.props.activeSection){const s=this.props.requireEmailVerification,a=[];let i=o.createElement(h.Z,{id:"user.settings.general.emailHelp1",defaultMessage:"Email is used for sign-in, notifications, and password reset. Email requires verification if changed."});s||(i=o.createElement(h.Z,{id:"user.settings.general.emailHelp3",defaultMessage:"Email is used for sign-in, notifications, and password reset."}));let n=null;""===this.props.user.auth_service?(a.push(o.createElement("div",{key:"currentEmailSetting"},o.createElement("div",{className:"form-group"},o.createElement("label",{className:"col-sm-5 control-label"},o.createElement(h.Z,{id:"user.settings.general.currentEmail",defaultMessage:"Current Email"})),o.createElement("div",{className:"col-sm-7"},o.createElement("label",{className:"control-label word-break--all text-left"},this.state.originalEmail))))),a.push(o.createElement("div",{key:"emailSetting"},o.createElement("div",{className:"form-group"},o.createElement("label",{className:"col-sm-5 control-label"},o.createElement(h.Z,{id:"user.settings.general.newEmail",defaultMessage:"New Email"})),o.createElement("div",{className:"col-sm-7"},o.createElement("input",{autoFocus:!0,id:"primaryEmail",className:"form-control",type:"email",onChange:this.updateEmail,maxLength:p.gT.MAX_EMAIL_LENGTH,value:this.state.email,"aria-label":e({id:"user.settings.general.newEmail",defaultMessage:"New Email"})}))))),a.push(o.createElement("div",{key:"confirmEmailSetting"},o.createElement("div",{className:"form-group"},o.createElement("label",{className:"col-sm-5 control-label"},o.createElement(h.Z,{id:"user.settings.general.confirmEmail",defaultMessage:"Confirm Email"})),o.createElement("div",{className:"col-sm-7"},o.createElement("input",{id:"confirmEmail",className:"form-control",type:"email",onChange:this.updateConfirmEmail,maxLength:p.gT.MAX_EMAIL_LENGTH,value:this.state.confirmEmail,"aria-label":e({id:"user.settings.general.confirmEmail",defaultMessage:"Confirm Email"})}))))),a.push(o.createElement("div",{key:"currentPassword"},o.createElement("div",{className:"form-group"},o.createElement("label",{className:"col-sm-5 control-label"},o.createElement(h.Z,{id:"user.settings.general.currentPassword",defaultMessage:"Current Password"})),o.createElement("div",{className:"col-sm-7"},o.createElement("input",{id:"currentPassword",className:"form-control",type:"password",onChange:this.updateCurrentPassword,value:this.state.currentPassword,"aria-label":e({id:"user.settings.general.currentPassword",defaultMessage:"Current Password"})}))),i)),n=this.submitEmail):this.props.user.auth_service===p.gT.GITLAB_SERVICE?a.push(o.createElement("div",{key:"oauthEmailInfo",className:"form-group"},o.createElement("div",{className:"setting-list__hint pb-3"},o.createElement(h.Z,{id:"user.settings.general.emailGitlabCantUpdate",defaultMessage:"Login occurs through GitLab. Email cannot be updated. Email address used for notifications is {email}.",values:{email:this.state.originalEmail}})),i)):this.props.user.auth_service===p.gT.GOOGLE_SERVICE?a.push(o.createElement("div",{key:"oauthEmailInfo",className:"form-group"},o.createElement("div",{className:"setting-list__hint pb-3"},o.createElement(h.Z,{id:"user.settings.general.emailGoogleCantUpdate",defaultMessage:"Login occurs through Google Apps. Email cannot be updated. Email address used for notifications is {email}.",values:{email:this.state.originalEmail}})),i)):this.props.user.auth_service===p.gT.OFFICE365_SERVICE?a.push(o.createElement("div",{key:"oauthEmailInfo",className:"form-group"},o.createElement("div",{className:"setting-list__hint pb-3"},o.createElement(h.Z,{id:"user.settings.general.emailOffice365CantUpdate",defaultMessage:"Login occurs through Office 365. Email cannot be updated. Email address used for notifications is {email}.",values:{email:this.state.originalEmail}})),i)):this.props.user.auth_service===p.gT.OPENID_SERVICE?a.push(o.createElement("div",{key:"oauthEmailInfo",className:"form-group"},o.createElement("div",{className:"setting-list__hint pb-3"},o.createElement(h.Z,{id:"user.settings.general.emailOpenIdCantUpdate",defaultMessage:"Login occurs through OpenID Connect. Email cannot be updated. Email address used for notifications is {email}.",values:{email:this.state.originalEmail}})),i)):this.props.user.auth_service===p.gT.LDAP_SERVICE?a.push(o.createElement("div",{key:"oauthEmailInfo",className:"pb-2"},o.createElement("div",{className:"setting-list__hint pb-3"},o.createElement(h.Z,{id:"user.settings.general.emailLdapCantUpdate",defaultMessage:"Login occurs through AD/LDAP. Email cannot be updated. Email address used for notifications is {email}.",values:{email:this.state.originalEmail}})))):this.props.user.auth_service===p.gT.SAML_SERVICE&&a.push(o.createElement("div",{key:"oauthEmailInfo",className:"pb-2"},o.createElement("div",{className:"setting-list__hint pb-3"},o.createElement(h.Z,{id:"user.settings.general.emailSamlCantUpdate",defaultMessage:"Login occurs through SAML. Email cannot be updated. Email address used for notifications is {email}.",values:{email:this.state.originalEmail}})),i)),t=o.createElement(v.Z,{title:o.createElement(h.Z,{id:"user.settings.general.email",defaultMessage:"Email"}),inputs:a,submit:n,saving:this.state.sectionIsSaving,serverError:this.state.serverError,clientError:this.state.emailError,updateSection:this.updateSection})}else{let e="";""===this.props.user.auth_service?e=this.props.user.email:this.props.user.auth_service===p.gT.GITLAB_SERVICE?e=o.createElement(h.Z,{id:"user.settings.general.loginGitlab",defaultMessage:"Login done through GitLab ({email})",values:{email:this.state.originalEmail}}):this.props.user.auth_service===p.gT.GOOGLE_SERVICE?e=o.createElement(h.Z,{id:"user.settings.general.loginGoogle",defaultMessage:"Login done through Google Apps ({email})",values:{email:this.state.originalEmail}}):this.props.user.auth_service===p.gT.OFFICE365_SERVICE?e=o.createElement(h.Z,{id:"user.settings.general.loginOffice365",defaultMessage:"Login done through Office 365 ({email})",values:{email:this.state.originalEmail}}):this.props.user.auth_service===p.gT.LDAP_SERVICE?e=o.createElement(h.Z,{id:"user.settings.general.loginLdap",defaultMessage:"Login done through AD/LDAP ({email})",values:{email:this.state.originalEmail}}):this.props.user.auth_service===p.gT.SAML_SERVICE&&(e=o.createElement(h.Z,{id:"user.settings.general.loginSaml",defaultMessage:"Login done through SAML ({email})",values:{email:this.state.originalEmail}})),t=o.createElement(S.Z,{title:o.createElement(h.Z,{id:"user.settings.general.email",defaultMessage:"Email"}),describe:e,section:"email",updateSection:this.updateSection})}return t}render(){const e=this.props.user,{formatMessage:t}=this.props.intl;let s=null;this.state.clientError&&(s=this.state.clientError);let a,i=null;this.state.serverError&&(i=this.state.serverError);const n=[];if("name"===this.props.activeSection){let e,r=null;if(this.props.user.auth_service===p.gT.LDAP_SERVICE&&(this.props.ldapFirstNameAttributeSet||this.props.ldapLastNameAttributeSet)||this.props.user.auth_service===p.gT.SAML_SERVICE&&(this.props.samlFirstNameAttributeSet||this.props.samlLastNameAttributeSet)||p.gT.OAUTH_SERVICES.includes(this.props.user.auth_service))e=o.createElement("span",null,o.createElement(h.Z,{id:"user.settings.general.field_handled_externally",defaultMessage:"This field is handled through your login provider. If you want to change it, you need to do so through your login provider."}));else{n.push(o.createElement("div",{key:"firstNameSetting",className:"form-group"},o.createElement("label",{className:"col-sm-5 control-label"},o.createElement(h.Z,{id:"user.settings.general.firstName",defaultMessage:"First Name"})),o.createElement("div",{className:"col-sm-7"},o.createElement("input",{id:"firstName",autoFocus:!0,className:"form-control",type:"text",onChange:this.updateFirstName,maxLength:p.gT.MAX_FIRSTNAME_LENGTH,value:this.state.firstName,onFocus:f.h$,"aria-label":t({id:"user.settings.general.firstName",defaultMessage:"First Name"})})))),n.push(o.createElement("div",{key:"lastNameSetting",className:"form-group"},o.createElement("label",{className:"col-sm-5 control-label"},o.createElement(h.Z,{id:"user.settings.general.lastName",defaultMessage:"Last Name"})),o.createElement("div",{className:"col-sm-7"},o.createElement("input",{id:"lastName",className:"form-control",type:"text",onChange:this.updateLastName,maxLength:p.gT.MAX_LASTNAME_LENGTH,value:this.state.lastName,"aria-label":t({id:"user.settings.general.lastName",defaultMessage:"Last Name"})}))));const s=e=>{e.preventDefault(),this.updateSection(""),this.props.updateTab("notifications")},a=o.createElement("a",{href:"#",onClick:s.bind(this)},o.createElement(h.Z,{id:"user.settings.general.notificationsLink",defaultMessage:"Notifications"}));e=o.createElement("span",null,o.createElement(h.Z,{id:"user.settings.general.notificationsExtra",defaultMessage:"By default, you will receive mention notifications when someone types your first name. Go to {notify} settings to change this default.",values:{notify:a}})),r=this.submitName}a=o.createElement(v.Z,{title:t(Re.fullName),inputs:n,submit:r,saving:this.state.sectionIsSaving,serverError:i,clientError:s,updateSection:this.updateSection,extraInfo:e})}else{let s="";e.first_name&&e.last_name?s=e.first_name+" "+e.last_name:e.first_name?s=e.first_name:e.last_name?s=e.last_name:(s=o.createElement(h.Z,{id:"user.settings.general.emptyName",defaultMessage:"Click 'Edit' to add your full name"}),f.tq()&&(s=o.createElement(h.Z,{id:"user.settings.general.mobile.emptyName",defaultMessage:"Click to add your full name"}))),a=o.createElement(S.Z,{title:t(Re.fullName),describe:s,section:"name",updateSection:this.updateSection})}let r,l,c;if("nickname"===this.props.activeSection){let e,a=null;if("ldap"===this.props.user.auth_service&&this.props.ldapNicknameAttributeSet||this.props.user.auth_service===p.gT.SAML_SERVICE&&this.props.samlNicknameAttributeSet)e=o.createElement("span",null,o.createElement(h.Z,{id:"user.settings.general.field_handled_externally",defaultMessage:"This field is handled through your login provider. If you want to change it, you need to do so through your login provider."}));else{let s=o.createElement(h.Z,{id:"user.settings.general.nickname",defaultMessage:"Nickname"});f.tq()&&(s=""),n.push(o.createElement("div",{key:"nicknameSetting",className:"form-group"},o.createElement("label",{className:"col-sm-5 control-label"},s),o.createElement("div",{className:"col-sm-7"},o.createElement("input",{id:"nickname",autoFocus:!0,className:"form-control",type:"text",onChange:this.updateNickname,value:this.state.nickname,maxLength:p.gT.MAX_NICKNAME_LENGTH,autoCapitalize:"off","aria-label":t({id:"user.settings.general.nickname",defaultMessage:"Nickname"})})))),e=o.createElement("span",null,o.createElement(h.Z,{id:"user.settings.general.nicknameExtra",defaultMessage:"Use Nickname for a name you might be called that is different from your first name and username. This is most often used when two or more people have similar sounding names and usernames."})),a=this.submitNickname}r=o.createElement(v.Z,{title:t(Re.nickname),inputs:n,submit:a,saving:this.state.sectionIsSaving,serverError:i,clientError:s,updateSection:this.updateSection,extraInfo:e})}else{let s="";e.nickname?s=e.nickname:(s=o.createElement(h.Z,{id:"user.settings.general.emptyNickname",defaultMessage:"Click 'Edit' to add a nickname"}),f.tq()&&(s=o.createElement(h.Z,{id:"user.settings.general.mobile.emptyNickname",defaultMessage:"Click to add a nickname"}))),r=o.createElement(S.Z,{title:t(Re.nickname),describe:s,section:"nickname",updateSection:this.updateSection})}if("username"===this.props.activeSection){let e,a=null;if(""===this.props.user.auth_service){let s=o.createElement(h.Z,{id:"user.settings.general.username",defaultMessage:"Username"});f.tq()&&(s=""),n.push(o.createElement("div",{key:"usernameSetting",className:"form-group"},o.createElement("label",{className:"col-sm-5 control-label"},s),o.createElement("div",{className:"col-sm-7"},o.createElement("input",{id:"username",autoFocus:!0,maxLength:p.gT.MAX_USERNAME_LENGTH,className:"form-control",type:"text",onChange:this.updateUsername,value:this.state.username,autoCapitalize:"off",onFocus:f.h$,"aria-label":t({id:"user.settings.general.username",defaultMessage:"Username"})})))),e=o.createElement("span",null,o.createElement(h.Z,{id:"user.settings.general.usernameInfo",defaultMessage:"Pick something easy for teammates to recognize and recall."})),a=this.submitUsername}else e=o.createElement("span",null,o.createElement(h.Z,{id:"user.settings.general.field_handled_externally",defaultMessage:"This field is handled through your login provider. If you want to change it, you need to do so through your login provider."}));l=o.createElement(v.Z,{title:t(Re.username),inputs:n,submit:a,saving:this.state.sectionIsSaving,serverError:i,clientError:s,updateSection:this.updateSection,extraInfo:e})}else l=o.createElement(S.Z,{title:t(Re.username),describe:this.props.user.username,section:"username",updateSection:this.updateSection});if("position"===this.props.activeSection){let e,a=null;if(this.props.user.auth_service===p.gT.LDAP_SERVICE&&this.props.ldapPositionAttributeSet||this.props.user.auth_service===p.gT.SAML_SERVICE&&this.props.samlPositionAttributeSet)e=o.createElement("span",null,o.createElement(h.Z,{id:"user.settings.general.field_handled_externally",defaultMessage:"This field is handled through your login provider. If you want to change it, you need to do so through your login provider."}));else{let s=o.createElement(h.Z,{id:"user.settings.general.position",defaultMessage:"Position"});f.tq()&&(s=""),n.push(o.createElement("div",{key:"positionSetting",className:"form-group"},o.createElement("label",{className:"col-sm-5 control-label"},s),o.createElement("div",{className:"col-sm-7"},o.createElement("input",{id:"position",autoFocus:!0,className:"form-control",type:"text",onChange:this.updatePosition,value:this.state.position,maxLength:p.gT.MAX_POSITION_LENGTH,autoCapitalize:"off",onFocus:f.h$,"aria-label":t({id:"user.settings.general.position",defaultMessage:"Position"})})))),e=o.createElement("span",null,o.createElement(h.Z,{id:"user.settings.general.positionExtra",defaultMessage:"Use Position for your role or job title. This will be shown in your profile popover."})),a=this.submitPosition}c=o.createElement(v.Z,{title:t(Re.position),inputs:n,submit:a,saving:this.state.sectionIsSaving,serverError:i,clientError:s,updateSection:this.updateSection,extraInfo:e})}else{let s="";e.position?s=e.position:(s=o.createElement(h.Z,{id:"user.settings.general.emptyPosition",defaultMessage:"Click 'Edit' to add your job title / position"}),f.tq()&&(s=o.createElement(h.Z,{id:"user.settings.general.mobile.emptyPosition",defaultMessage:"Click to add your job title / position"}))),c=o.createElement(S.Z,{title:t(Re.position),describe:s,section:"position",updateSection:this.updateSection})}const d=this.createEmailSection();let u;if("picture"===this.props.activeSection){let a=null,n=null,r=null,l=null;this.props.user.auth_service!==p.gT.LDAP_SERVICE&&this.props.user.auth_service!==p.gT.SAML_SERVICE||!this.props.ldapPictureAttributeSet?(a=this.submitPicture,n=e.last_picture_update>0?this.setDefaultProfilePicture:null,l=f.bb(e.id,e.last_picture_update),r=o.createElement(h.Z,{id:"setting_picture.help.profile",defaultMessage:"Upload a picture in BMP, JPG or PNG format. Maximum file size: {max}",values:{max:f.eA(this.props.maxFileSize)}})):r=o.createElement("span",null,o.createElement(h.Z,{id:"user.settings.general.field_handled_externally",defaultMessage:"This field is handled through your login provider. If you want to change it, you need to do so through your login provider."})),u=o.createElement(we.Z,{title:t(Re.profilePicture),onSubmit:a,onSetDefault:n,src:l,defaultImageSrc:f.Vl(e.id),serverError:i,clientError:s,updateSection:e=>{this.updateSection(""),e.preventDefault()},file:this.state.pictureFile,onFileChange:this.updatePicture,submitActive:this.submitActive,loadingPicture:this.state.loadingPicture,maxFileSize:this.props.maxFileSize,helpText:r})}else{let s=t(Re.uploadImage);f.tq()&&(s=t(Re.uploadImageMobile)),e.last_picture_update&&(s=o.createElement(h.Z,{id:"user.settings.general.imageUpdated",defaultMessage:"Image last updated {date}",values:{date:o.createElement(G.Ji,{value:new Date(e.last_picture_update),day:"2-digit",month:"short",year:"numeric"})}})),u=o.createElement(S.Z,{title:t(Re.profilePicture),describe:s,section:"picture",updateSection:this.updateSection})}return o.createElement("div",{id:"generalSettings"},o.createElement("div",{className:"modal-header"},o.createElement("button",{id:"closeUserSettings",type:"button",className:"close","data-dismiss":"modal","aria-label":t(Re.close),onClick:this.props.closeModal},o.createElement("span",{"aria-hidden":"true"},"×")),o.createElement("h4",{className:"modal-title",ref:"title"},o.createElement("div",{className:"modal-back"},o.createElement(h.Z,{id:"generic_icons.collapse",defaultMessage:"Collapse Icon"},(e=>o.createElement("i",{className:"fa fa-angle-left",title:e,onClick:this.props.collapseModal})))),o.createElement(h.Z,{id:"user.settings.general.title",defaultMessage:"General Settings"}))),o.createElement("div",{className:"user-settings"},o.createElement("h3",{id:"generalSettingsTitle",className:"tab-header"},o.createElement(h.Z,{id:"user.settings.general.title",defaultMessage:"General Settings"})),o.createElement("div",{className:"divider-dark first"}),a,o.createElement("div",{className:"divider-light"}),l,o.createElement("div",{className:"divider-light"}),r,o.createElement("div",{className:"divider-light"}),c,o.createElement("div",{className:"divider-light"}),d,o.createElement("div",{className:"divider-light"}),u,o.createElement("div",{className:"divider-dark"})))}}Oe(Ze,"propTypes",{updateSection:r().func.isRequired,updateTab:r().func.isRequired,activeSection:r().string,closeModal:r().func.isRequired,collapseModal:r().func.isRequired,maxFileSize:r().number.isRequired,actions:r().shape({logError:r().func.isRequired,clearErrors:r().func.isRequired,getMe:r().func.isRequired,updateMe:r().func.isRequired,sendVerificationEmail:r().func.isRequired,setDefaultProfileImage:r().func.isRequired,uploadProfileImage:r().func.isRequired}).isRequired,requireEmailVerification:r().bool,ldapFirstNameAttributeSet:r().bool,ldapLastNameAttributeSet:r().bool,samlFirstNameAttributeSet:r().bool,samlLastNameAttributeSet:r().bool,ldapNicknameAttributeSet:r().bool,samlNicknameAttributeSet:r().bool,ldapPositionAttributeSet:r().bool,samlPositionAttributeSet:r().bool,ldapPictureAttributeSet:r().bool});const Ie=(0,Ce.ZP)(Ze),De=(0,a.connect)((function(e){const t=(0,c.iE)(e);return{requireEmailVerification:"true"===t.RequireEmailVerification,maxFileSize:parseInt(t.MaxFileSize,10),ldapFirstNameAttributeSet:"true"===t.LdapFirstNameAttributeSet,ldapLastNameAttributeSet:"true"===t.LdapLastNameAttributeSet,samlFirstNameAttributeSet:"true"===t.SamlFirstNameAttributeSet,samlLastNameAttributeSet:"true"===t.SamlLastNameAttributeSet,ldapNicknameAttributeSet:"true"===t.LdapNicknameAttributeSet,samlNicknameAttributeSet:"true"===t.SamlNicknameAttributeSet,samlPositionAttributeSet:"true"===t.SamlPositionAttributeSet,ldapPositionAttributeSet:"true"===t.LdapPositionAttributeSet,ldapPictureAttributeSet:"true"===t.LdapPictureAttributeSet}}),(function(e){return{actions:(0,l.bindActionCreators)({logError:Me.H,clearErrors:Me.b9,getMe:m.jo,updateMe:m.DO,sendVerificationEmail:m.zk,setDefaultProfileImage:m.QJ,uploadProfileImage:m._p},e)}}))(Ie);var Le=s(81249),Ue=s.n(Le),xe=s(47470);function qe(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class Fe extends o.PureComponent{constructor(e){super(e),qe(this,"handleMinUpdateSection",(e=>{this.props.updateSection(e),this.props.cancel()})),qe(this,"handleMaxUpdateSection",(e=>{this.props.updateSection(e)})),qe(this,"handleOnChange",(e=>{const t=e.currentTarget.getAttribute("data-key"),s=e.currentTarget.getAttribute("data-value");this.props.setParentState(t,s)})),qe(this,"setDesktopNotificationSound",(e=>{this.props.setParentState("desktopNotificationSound",e.value),this.setState({selectedOption:e}),f.zn(e.value)})),qe(this,"buildMaximizedSetting",(()=>{const e=[],t=[!1,!1,!1];let s,a;if(this.props.activity===p.XH.MENTION?t[1]=!0:this.props.activity===p.XH.NONE?t[2]=!0:t[0]=!0,this.props.activity!==p.XH.NONE){const e=[!1,!1];if("false"===this.props.sound?e[1]=!0:e[0]=!0,"true"===this.props.sound){const e=Array.from(f.ux.keys()).map((e=>({value:e,label:e})));(!(0,xe.P)()||window.desktop&&Ue().gte(window.desktop.version,"4.6.0"))&&(a=o.createElement("div",{className:"pt-2"},o.createElement(re.ZP,{className:"react-select notification-sound-dropdown",classNamePrefix:"react-select",id:"displaySoundNotification",options:e,clearable:!1,onChange:this.setDesktopNotificationSound,value:this.state.selectedOption,isSearchable:!1,ref:this.dropdownSoundRef})))}s=f.Vo()?o.createElement("fieldset",null,o.createElement("legend",{className:"form-legend"},o.createElement(h.Z,{id:"user.settings.notifications.desktop.sound",defaultMessage:"Notification sound"})),o.createElement("div",{className:"radio"},o.createElement("label",null,o.createElement("input",{id:"soundOn",type:"radio",name:"notificationSounds",checked:e[0],"data-key":"desktopSound","data-value":"true",onChange:this.handleOnChange}),o.createElement(h.Z,{id:"user.settings.notifications.on",defaultMessage:"On"})),o.createElement("br",null)),o.createElement("div",{className:"radio"},o.createElement("label",null,o.createElement("input",{id:"soundOff",type:"radio",name:"notificationSounds",checked:e[1],"data-key":"desktopSound","data-value":"false",onChange:this.handleOnChange}),o.createElement(h.Z,{id:"user.settings.notifications.off",defaultMessage:"Off"})),o.createElement("br",null)),a,o.createElement("div",{className:"mt-5"},o.createElement(h.Z,{id:"user.settings.notifications.sounds_info",defaultMessage:"Notification sounds are available on Firefox, Edge, Safari, Chrome and MatterFOSS Desktop Apps."}))):o.createElement("fieldset",null,o.createElement("legend",{className:"form-legend"},o.createElement(h.Z,{id:"user.settings.notifications.desktop.sound",defaultMessage:"Notification sound"})),o.createElement("br",null),o.createElement(h.Z,{id:"user.settings.notifications.soundConfig",defaultMessage:"Please configure notification sounds in your browser settings"}))}return e.push(o.createElement("div",{key:"userNotificationLevelOption"},o.createElement("fieldset",null,o.createElement("legend",{className:"form-legend"},o.createElement(h.Z,{id:"user.settings.notifications.desktop",defaultMessage:"Send desktop notifications"})),o.createElement("div",{className:"radio"},o.createElement("label",null,o.createElement("input",{id:"desktopNotificationAllActivity",type:"radio",name:"desktopNotificationLevel",checked:t[0],"data-key":"desktopActivity","data-value":p.XH.ALL,onChange:this.handleOnChange}),o.createElement(h.Z,{id:"user.settings.notifications.allActivity",defaultMessage:"For all activity"})),o.createElement("br",null)),o.createElement("div",{className:"radio"},o.createElement("label",null,o.createElement("input",{id:"desktopNotificationMentions",type:"radio",name:"desktopNotificationLevel",checked:t[1],"data-key":"desktopActivity","data-value":p.XH.MENTION,onChange:this.handleOnChange}),o.createElement(h.Z,{id:"user.settings.notifications.onlyMentions",defaultMessage:"Only for mentions and direct messages"})),o.createElement("br",null)),o.createElement("div",{className:"radio"},o.createElement("label",null,o.createElement("input",{id:"desktopNotificationNever",type:"radio",name:"desktopNotificationLevel",checked:t[2],"data-key":"desktopActivity","data-value":p.XH.NONE,onChange:this.handleOnChange}),o.createElement(h.Z,{id:"user.settings.notifications.never",defaultMessage:"Never"}))),o.createElement("div",{className:"mt-5"},o.createElement(h.Z,{id:"user.settings.notifications.info",defaultMessage:"Desktop notifications are available on Edge, Firefox, Safari, Chrome and MatterFOSS Desktop Apps."}))),o.createElement("hr",null),s)),o.createElement(v.Z,{title:f._u("user.settings.notifications.desktop.title","Desktop Notifications"),inputs:e,submit:this.props.submit,saving:this.props.saving,server_error:this.props.error,updateSection:this.handleMaxUpdateSection})})),qe(this,"buildMinimizedSetting",(()=>{let e;const t=f.Vo();return e=this.props.activity===p.XH.MENTION?t&&"false"!==this.props.sound?{id:(0,E.t)("user.settings.notifications.desktop.mentionsSound"),defaultMessage:"For mentions and direct messages, with sound"}:t&&"false"===this.props.sound?{id:(0,E.t)("user.settings.notifications.desktop.mentionsNoSound"),defaultMessage:"For mentions and direct messages, without sound"}:{id:(0,E.t)("user.settings.notifications.desktop.mentionsSoundHidden"),defaultMessage:"For mentions and direct messages"}:this.props.activity===p.XH.NONE?{id:(0,E.t)("user.settings.notifications.off"),defaultMessage:"Off"}:t&&"false"!==this.props.sound?{id:(0,E.t)("user.settings.notifications.desktop.allSound"),defaultMessage:"For all activity, with sound"}:t&&"false"===this.props.sound?{id:(0,E.t)("user.settings.notifications.desktop.allNoSound"),defaultMessage:"For all activity, without sound"}:{id:(0,E.t)("user.settings.notifications.desktop.allSoundHidden"),defaultMessage:"For all activity"},o.createElement(S.Z,{title:f._u("user.settings.notifications.desktop.title","Desktop Notifications"),describe:o.createElement(h.Z,e),focused:this.props.focused,section:"desktop",updateSection:this.handleMinUpdateSection})}));const t={value:e.selectedSound,label:e.selectedSound};this.state={selectedOption:t,blurDropdown:!1},this.dropdownSoundRef=o.createRef()}blurDropdown(){this.state.blurDropdown||(this.setState({blurDropdown:!0}),this.dropdownSoundRef.current&&this.dropdownSoundRef.current.blur())}componentDidUpdate(){this.blurDropdown()}render(){return this.props.active?this.buildMaximizedSetting():this.buildMinimizedSetting()}}Fe.propTypes={activity:r().string.isRequired,sound:r().string.isRequired,updateSection:r().func,setParentState:r().func,submit:r().func,cancel:r().func,error:r().string,active:r().bool,saving:r().bool,focused:r().bool,selectedSound:r().string};var Ge=s(58371);function je(e,t,s){const{INTERVAL_NEVER:a,INTERVAL_IMMEDIATE:i,INTERVAL_FIFTEEN_MINUTES:n,INTERVAL_HOUR:r}=_.uP,o=[i,a];return e?t&&-1===[i,a,n,r].indexOf(s)?n:t||-1!==o.indexOf(s)?e&&s===a?i:s:i:a}function ze(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class Be extends o.PureComponent{constructor(e){super(e),ze(this,"handleChange",(e=>{const t=e.currentTarget.getAttribute("data-enable-email"),s=parseInt(e.currentTarget.getAttribute("data-email-interval"),10);this.setState({enableEmail:t,newInterval:s}),this.props.onChange(t)})),ze(this,"handleSubmit",(async()=>{const{newInterval:e}=this.state;if(this.props.emailInterval===e&&this.props.enableEmail===this.state.enableEmail)this.props.updateSection("");else{const{currentUserId:t,actions:s}=this.props,a={user_id:t,category:p.uP.CATEGORY_NOTIFICATIONS,name:p.uP.EMAIL_INTERVAL,value:e.toString()};await s.savePreferences(t,[a]),this.props.onSubmit()}})),ze(this,"handleUpdateSection",(e=>{e?this.props.updateSection(e):(this.props.updateSection(""),this.setState({enableEmail:this.props.enableEmail,newInterval:this.props.emailInterval}),this.props.onCancel())})),ze(this,"renderMinSettingView",(()=>{const{enableEmail:e,sendEmailNotifications:t}=this.props,{newInterval:s}=this.state;let a;if(t)if(e)switch(s){case p.uP.INTERVAL_IMMEDIATE:a=o.createElement(h.Z,{id:"user.settings.notifications.email.immediately",defaultMessage:"Immediately"});break;case p.uP.INTERVAL_HOUR:a=o.createElement(h.Z,{id:"user.settings.notifications.email.everyHour",defaultMessage:"Every hour"});break;case p.uP.INTERVAL_FIFTEEN_MINUTES:a=o.createElement(h.Z,{id:"user.settings.notifications.email.everyXMinutes",defaultMessage:"Every {count, plural, one {minute} other {{count, number} minutes}}",values:{count:s/60}});break;default:a=o.createElement(h.Z,{id:"user.settings.notifications.email.never",defaultMessage:"Never"})}else a=o.createElement(h.Z,{id:"user.settings.notifications.email.never",defaultMessage:"Never"});else a=o.createElement(h.Z,{id:"user.settings.notifications.email.disabled",defaultMessage:"Email notifications are not enabled"});return o.createElement(S.Z,{title:(0,f._u)("user.settings.notifications.emailNotifications","Email Notifications"),describe:a,section:"email",updateSection:this.handleUpdateSection})})),ze(this,"renderMaxSettingView",(()=>{if(!this.props.sendEmailNotifications)return o.createElement(v.Z,{title:(0,f._u)("user.settings.notifications.emailNotifications","Email Notifications"),inputs:[o.createElement("div",{key:"oauthEmailInfo",className:"pt-2"},o.createElement(h.Z,{id:"user.settings.notifications.email.disabled_long",defaultMessage:"Email notifications have not been enabled by your System Administrator."}))],server_error:this.props.serverError,section:"email",updateSection:this.handleUpdateSection});const{newInterval:e}=this.state;let t=null,s=null;return this.props.enableEmailBatching&&(t=o.createElement("fieldset",null,o.createElement("div",{className:"radio"},o.createElement("label",null,o.createElement("input",{id:"emailNotificationMinutes",type:"radio",name:"emailNotifications",checked:e===p.uP.INTERVAL_FIFTEEN_MINUTES,"data-enable-email":"true","data-email-interval":p.uP.INTERVAL_FIFTEEN_MINUTES,onChange:this.handleChange}),o.createElement(h.Z,{id:"user.settings.notifications.email.everyXMinutes",defaultMessage:"Every {count} minutes",values:{count:p.uP.INTERVAL_FIFTEEN_MINUTES/60}}))),o.createElement("div",{className:"radio"},o.createElement("label",null,o.createElement("input",{id:"emailNotificationHour",type:"radio",name:"emailNotifications",checked:e===p.uP.INTERVAL_HOUR,"data-enable-email":"true","data-email-interval":p.uP.INTERVAL_HOUR,onChange:this.handleChange}),o.createElement(h.Z,{id:"user.settings.notifications.email.everyHour",defaultMessage:"Every hour"})))),s=o.createElement(h.Z,{id:"user.settings.notifications.emailBatchingInfo",defaultMessage:"Notifications received over the time period selected are combined and sent in a single email."})),o.createElement(v.Z,{title:(0,f._u)("user.settings.notifications.emailNotifications","Email Notifications"),inputs:[o.createElement("fieldset",{key:"userNotificationEmailOptions"},o.createElement("legend",{className:"form-legend"},o.createElement(h.Z,{id:"user.settings.notifications.email.send",defaultMessage:"Send email notifications"})),o.createElement("div",{className:"radio"},o.createElement("label",null,o.createElement("input",{id:"emailNotificationImmediately",type:"radio",name:"emailNotifications",checked:e===p.uP.INTERVAL_IMMEDIATE,"data-enable-email":"true","data-email-interval":p.uP.INTERVAL_IMMEDIATE,onChange:this.handleChange}),o.createElement(h.Z,{id:"user.settings.notifications.email.immediately",defaultMessage:"Immediately"}))),t,o.createElement("div",{className:"radio"},o.createElement("label",null,o.createElement("input",{id:"emailNotificationNever",type:"radio",name:"emailNotifications",checked:e===p.uP.INTERVAL_NEVER,"data-enable-email":"false","data-email-interval":p.uP.INTERVAL_NEVER,onChange:this.handleChange}),o.createElement(h.Z,{id:"user.settings.notifications.email.never",defaultMessage:"Never"}))),o.createElement("div",{className:"mt-3"},o.createElement(h.Z,{id:"user.settings.notifications.emailInfo",defaultMessage:"Email notifications are sent for mentions and direct messages when you are offline or away for more than 5 minutes."})," ",s))],submit:this.handleSubmit,saving:this.props.saving,server_error:this.props.serverError,updateSection:this.handleUpdateSection})}));const{emailInterval:t,enableEmail:s,enableEmailBatching:a,sendEmailNotifications:i,activeSection:n}=e;this.state={activeSection:n,emailInterval:t,enableEmail:s,enableEmailBatching:a,sendEmailNotifications:i,newInterval:je(JSON.parse(s)&&i,a,t)}}static getDerivedStateFromProps(e,t){const{emailInterval:s,enableEmail:a,enableEmailBatching:i,sendEmailNotifications:n,activeSection:r}=e;return"email"===r&&"email"!==t.activeSection||n!==t.sendEmailNotifications||i!==t.enableEmailBatching||s!==t.emailInterval||r!==t.activeSection?{activeSection:r,emailInterval:s,enableEmail:a,enableEmailBatching:i,sendEmailNotifications:n,newInterval:je(JSON.parse(a)&&n,i,s)}:null}render(){return"email"!==this.props.activeSection?this.renderMinSettingView():this.renderMaxSettingView()}}ze(Be,"propTypes",{currentUserId:r().string.isRequired,activeSection:r().string.isRequired,updateSection:r().func.isRequired,enableEmail:r().string.isRequired,emailInterval:r().number.isRequired,onSubmit:r().func.isRequired,onCancel:r().func.isRequired,onChange:r().func.isRequired,serverError:r().string,saving:r().bool,sendEmailNotifications:r().bool.isRequired,enableEmailBatching:r().bool.isRequired,actions:r().shape({savePreferences:r().func.isRequired}).isRequired});const Ve=(0,a.connect)((function(e){const t=(0,c.iE)(e),s=parseInt((0,d.U2)(e,_.uP.CATEGORY_NOTIFICATIONS,_.uP.EMAIL_INTERVAL,_.uP.INTERVAL_NOT_SET.toString()),10);return{currentUserId:(0,Ge.rc)(e),emailInterval:s,enableEmailBatching:"true"===t.EnableEmailBatching,sendEmailNotifications:"true"===t.SendEmailNotifications}}),(function(e){return{actions:(0,l.bindActionCreators)({savePreferences:u.$A},e)}}))(Be);var He=s(97550);function Ye(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class Ke extends o.PureComponent{constructor(...e){super(...e),Ye(this,"handleAutoResponderChecked",(e=>{this.props.setParentState("autoResponderActive",e.target.checked)})),Ye(this,"onMessageChanged",(e=>{this.props.setParentState("autoResponderMessage",e.target.value)}))}render(){const{autoResponderActive:e,autoResponderMessage:t}=this.props;let s;this.props.error&&(s=o.createElement("label",{className:"has-error"},this.props.error));const a=[],i=o.createElement("div",{id:"autoResponderCheckbox",key:"autoResponderCheckbox",className:"checkbox"},o.createElement("label",null,o.createElement("input",{id:"autoResponderActive",type:"checkbox",checked:e,onChange:this.handleAutoResponderChecked}),o.createElement(h.Z,{id:"user.settings.notifications.autoResponderEnabled",defaultMessage:"Enabled"}))),n=o.createElement("div",{id:"autoResponderMessage",key:"autoResponderMessage"},o.createElement("div",{className:"pt-2"},o.createElement(He.Z,{style:{resize:"none"},id:"autoResponderMessageInput",className:"form-control",rows:"5",placeholder:(0,f._u)("user.settings.notifications.autoResponderPlaceholder","Message"),value:t,maxLength:200,onChange:this.onMessageChanged}),s));return a.push(i),e&&a.push(n),a.push(o.createElement("div",{key:"autoResponderHint",className:"mt-5"},o.createElement(h.Z,{id:"user.settings.notifications.autoResponderHint",defaultMessage:"Set a custom message that will be automatically sent in response to Direct Messages. Mentions in Public and Private Channels will not trigger the automated reply. Enabling Automatic Replies sets your status to Out of Office and disables email and push notifications."}))),o.createElement(v.Z,{title:o.createElement(h.Z,{id:"user.settings.notifications.autoResponder",defaultMessage:"Automatic Direct Message Replies"}),width:"medium",shiftEnter:!0,submit:this.props.submit,saving:this.props.saving,inputs:a,updateSection:this.props.updateSection})}}function We(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function Je(e){const t=e.user;let s=p.XH.MENTION,a="true",i="Bing",n="never",r="true",o=p.XH.MENTION,l=p.ZP.UserStatuses.AWAY,c=!1,d=f._u("user.settings.notifications.autoResponderDefault","Hello, I am out of office and unable to respond to messages.");t.notify_props&&(t.notify_props.desktop&&(s=t.notify_props.desktop),t.notify_props.desktop_sound&&(a=t.notify_props.desktop_sound),t.notify_props.desktop_notification_sound&&(i=t.notify_props.desktop_notification_sound),t.notify_props.comments&&(n=t.notify_props.comments),t.notify_props.email&&(r=t.notify_props.email),t.notify_props.push&&(o=t.notify_props.push),t.notify_props.push_status&&(l=t.notify_props.push_status),t.notify_props.auto_responder_active&&(c="true"===t.notify_props.auto_responder_active),t.notify_props.auto_responder_message&&(d=t.notify_props.auto_responder_message));let u=!1,m="",h=!1,g=!1;if(t.notify_props){if(t.notify_props.mention_keys){const e=t.notify_props.mention_keys.split(",");-1===e.indexOf(t.username)?u=!1:(u=!0,e.splice(e.indexOf(t.username),1),-1!==e.indexOf("@".concat(t.username))&&e.splice(e.indexOf("@".concat(t.username)),1)),m=e.join(",")}t.notify_props.first_name&&(h="true"===t.notify_props.first_name),t.notify_props.channel&&(g="true"===t.notify_props.channel)}return{desktopActivity:s,enableEmail:r,pushActivity:o,pushStatus:l,desktopSound:a,desktopNotificationSound:i,usernameKey:u,customKeys:m,customKeysChecked:m.length>0,firstNameKey:h,channelKey:g,autoResponderActive:c,autoResponderMessage:d,notifyCommentsLevel:n,isSaving:!1}}Ye(Ke,"propTypes",{autoResponderActive:r().bool.isRequired,autoResponderMessage:r().string.isRequired,updateSection:r().func.isRequired,setParentState:r().func.isRequired,submit:r().func.isRequired,saving:r().bool.isRequired,error:r().string});class Xe extends o.PureComponent{constructor(e){super(e),We(this,"handleSubmit",(()=>{const e={};e.email=this.state.enableEmail,e.desktop_sound=this.state.desktopSound,(!(0,xe.P)()||window.desktop&&Ue().gte(window.desktop.version,"4.6.0"))&&(e.desktop_notification_sound=this.state.desktopNotificationSound),e.desktop=this.state.desktopActivity,e.push=this.state.pushActivity,e.push_status=this.state.pushStatus,e.comments=this.state.notifyCommentsLevel,e.auto_responder_active=this.state.autoResponderActive.toString(),e.auto_responder_message=this.state.autoResponderMessage,e.auto_responder_message&&""!==e.auto_responder_message||(e.auto_responder_message=f._u("user.settings.notifications.autoResponderDefault","Hello, I am out of office and unable to respond to messages."));const t=[];this.state.usernameKey&&t.push(this.props.user.username);let s=t.join(",");this.state.customKeys.length>0&&this.state.customKeysChecked&&(s+=","+this.state.customKeys),e.mention_keys=s,e.first_name=this.state.firstNameKey.toString(),e.channel=this.state.channelKey.toString(),this.setState({isSaving:!0}),this.props.actions.updateMe({notify_props:e}).then((({data:e,error:t})=>{e?(this.handleUpdateSection(""),this.setState(Je(this.props))):t&&this.setState({serverError:t.message,isSaving:!1})}))})),We(this,"handleCancel",(e=>{e&&e.preventDefault(),this.setState(Je(this.props))})),We(this,"handleUpdateSection",(e=>{e?this.props.updateSection(e):this.props.updateSection(""),this.setState({isSaving:!1}),this.handleCancel()})),We(this,"setStateValue",((e,t)=>{const s={};s[e]=t,this.setState(s)})),We(this,"handleEmailRadio",(e=>{this.setState({enableEmail:e})})),We(this,"updateUsernameKey",(e=>{this.setState({usernameKey:e})})),We(this,"updateFirstNameKey",(e=>{this.setState({firstNameKey:e})})),We(this,"updateChannelKey",(e=>{this.setState({channelKey:e})})),We(this,"updateCustomMentionKeys",(()=>{if(this.customCheckRef.current.checked){const e=this.customMentionsRef.current.value;this.setState({customKeys:e.replace(/ /g,""),customKeysChecked:!0})}else this.setState({customKeys:"",customKeysChecked:!1})})),We(this,"onCustomChange",(()=>{this.customCheckRef.current.checked=!0,this.updateCustomMentionKeys()})),We(this,"createPushNotificationSection",(()=>{if("push"===this.props.activeSection){const e=[];let t=null,s=null;if(this.props.sendPushNotifications){const a=[!1,!1,!1];this.state.pushActivity===p.XH.ALL?a[0]=!0:this.state.pushActivity===p.XH.NONE?a[2]=!0:a[1]=!0;const i=[!1,!1,!1];let n;this.state.pushStatus===p.ZP.UserStatuses.ONLINE?i[0]=!0:this.state.pushStatus===p.ZP.UserStatuses.AWAY?i[1]=!0:i[2]=!0,this.state.pushActivity!==p.XH.NONE&&(n=o.createElement("fieldset",null,o.createElement("legend",{className:"form-legend"},o.createElement(h.Z,{id:"user.settings.notifications.push_notification.status",defaultMessage:"Trigger push notifications when"})),o.createElement("div",{className:"radio"},o.createElement("label",null,o.createElement("input",{id:"pushNotificationOnline",type:"radio",name:"pushNotificationStatus",checked:i[0],onChange:this.handlePushStatusRadio.bind(this,p.ZP.UserStatuses.ONLINE)}),o.createElement(h.Z,{id:"user.settings.push_notification.online",defaultMessage:"Online, away or offline"}))),o.createElement("div",{className:"radio"},o.createElement("label",null,o.createElement("input",{id:"pushNotificationAway",type:"radio",name:"pushNotificationStatus",checked:i[1],onChange:this.handlePushStatusRadio.bind(this,p.ZP.UserStatuses.AWAY)}),o.createElement(h.Z,{id:"user.settings.push_notification.away",defaultMessage:"Away or offline"}))),o.createElement("div",{className:"radio"},o.createElement("label",null,o.createElement("input",{id:"pushNotificationOffline",type:"radio",name:"pushNotificationStatus",checked:i[2],onChange:this.handlePushStatusRadio.bind(this,p.ZP.UserStatuses.OFFLINE)}),o.createElement(h.Z,{id:"user.settings.push_notification.offline",defaultMessage:"Offline"})))),t=o.createElement("span",null,o.createElement(h.Z,{id:"user.settings.push_notification.status_info",defaultMessage:"Notification alerts are only pushed to your mobile device when your availability matches the selection above."}))),e.push(o.createElement("div",null,o.createElement("fieldset",{key:"userNotificationLevelOption"},o.createElement("legend",{className:"form-legend"},o.createElement(h.Z,{id:"user.settings.push_notification.send",defaultMessage:"Send mobile push notifications"})),o.createElement("div",{className:"radio"},o.createElement("label",null,o.createElement("input",{id:"pushNotificationAllActivity",type:"radio",name:"pushNotificationLevel",checked:a[0],onChange:this.handlePushRadio.bind(this,p.XH.ALL)}),o.createElement(h.Z,{id:"user.settings.push_notification.allActivity",defaultMessage:"For all activity"}))),o.createElement("div",{className:"radio"},o.createElement("label",null,o.createElement("input",{id:"pushNotificationMentions",type:"radio",name:"pushNotificationLevel",checked:a[1],onChange:this.handlePushRadio.bind(this,p.XH.MENTION)}),o.createElement(h.Z,{id:"user.settings.push_notification.onlyMentions",defaultMessage:"For mentions and direct messages"}))),o.createElement("div",{className:"radio"},o.createElement("label",null,o.createElement("input",{id:"pushNotificationNever",type:"radio",name:"pushNotificationLevel",checked:a[2],onChange:this.handlePushRadio.bind(this,p.XH.NONE)}),o.createElement(h.Z,{id:"user.settings.notifications.never",defaultMessage:"Never"}))),o.createElement("div",{className:"mt-5"},o.createElement(h.Z,{id:"user.settings.push_notification.info",defaultMessage:"Notification alerts are pushed to your mobile device when there is activity in MatterFOSS."}))),o.createElement("hr",null),n)),s=this.handleSubmit}else e.push(o.createElement("div",{key:"oauthEmailInfo",className:"pt-2"},o.createElement(h.Z,{id:"user.settings.push_notification.disabled_long",defaultMessage:"Push notifications have not been enabled by your System Administrator."})));return o.createElement(v.Z,{title:f._u("user.settings.notifications.push","Mobile Push Notifications"),extraInfo:t,inputs:e,submit:s,server_error:this.state.serverError,updateSection:this.handleUpdateSection})}let e="";return e=this.state.pushActivity===p.XH.ALL?this.state.pushStatus===p.ZP.UserStatuses.AWAY?o.createElement(h.Z,{id:"user.settings.push_notification.allActivityAway",defaultMessage:"For all activity when away or offline"}):this.state.pushStatus===p.ZP.UserStatuses.OFFLINE?o.createElement(h.Z,{id:"user.settings.push_notification.allActivityOffline",defaultMessage:"For all activity when offline"}):o.createElement(h.Z,{id:"user.settings.push_notification.allActivityOnline",defaultMessage:"For all activity when online, away or offline"}):this.state.pushActivity===p.XH.NONE?o.createElement(h.Z,{id:"user.settings.notifications.never",defaultMessage:"Never"}):this.props.sendPushNotifications?this.state.pushStatus===p.ZP.UserStatuses.AWAY?o.createElement(h.Z,{id:"user.settings.push_notification.onlyMentionsAway",defaultMessage:"For mentions and direct messages when away or offline"}):this.state.pushStatus===p.ZP.UserStatuses.OFFLINE?o.createElement(h.Z,{id:"user.settings.push_notification.onlyMentionsOffline",defaultMessage:"For mentions and direct messages when offline"}):o.createElement(h.Z,{id:"user.settings.push_notification.onlyMentionsOnline",defaultMessage:"For mentions and direct messages when online, away or offline"}):o.createElement(h.Z,{id:"user.settings.push_notification.disabled",defaultMessage:"Push notifications are not enabled"}),o.createElement(S.Z,{title:f._u("user.settings.notifications.push","Mobile Push Notifications"),describe:e,section:"push",updateSection:this.handleUpdateSection})})),this.state=Je(e),this.customCheckRef=o.createRef(),this.customMentionsRef=o.createRef(),this.drawerRef=o.createRef(),this.wrapperRef=o.createRef()}handleNotifyCommentsRadio(e){this.setState({notifyCommentsLevel:e})}handlePushRadio(e){this.setState({pushActivity:e})}handlePushStatusRadio(e){this.setState({pushStatus:e})}render(){const e=this.state.serverError,t=this.props.user;let s,a,i;if("keys"===this.props.activeSection){const a=[];if(t.first_name){const e=e=>{this.updateFirstNameKey(e.target.checked)};a.push(o.createElement("div",{key:"userNotificationFirstNameOption"},o.createElement("div",{className:"checkbox"},o.createElement("label",null,o.createElement("input",{id:"notificationTriggerFirst",type:"checkbox",checked:this.state.firstNameKey,onChange:e}),o.createElement(h.Z,{id:"user.settings.notifications.sensitiveName",defaultMessage:'Your case sensitive first name "{first_name}"',values:{first_name:t.first_name}})))))}const i=e=>{this.updateUsernameKey(e.target.checked)};a.push(o.createElement("div",{key:"userNotificationUsernameOption"},o.createElement("div",{className:"checkbox"},o.createElement("label",null,o.createElement("input",{id:"notificationTriggerUsername",type:"checkbox",checked:this.state.usernameKey,onChange:i}),o.createElement(h.Z,{id:"user.settings.notifications.sensitiveUsername",defaultMessage:'Your non case-sensitive username "{username}"',values:{username:t.username}})))));const n=e=>{this.updateChannelKey(e.target.checked)};a.push(o.createElement("div",{key:"userNotificationChannelOption"},o.createElement("div",{className:"checkbox"},o.createElement("label",null,o.createElement("input",{id:"notificationTriggerShouts",type:"checkbox",checked:this.state.channelKey,onChange:n}),o.createElement(h.Z,{id:"user.settings.notifications.channelWide",defaultMessage:'Channel-wide mentions "@channel", "@all", "@here"'}))))),a.push(o.createElement("div",{key:"userNotificationCustomOption"},o.createElement("div",{className:"checkbox"},o.createElement("label",null,o.createElement("input",{id:"notificationTriggerCustom",ref:this.customCheckRef,type:"checkbox",checked:this.state.customKeysChecked,onChange:this.updateCustomMentionKeys}),o.createElement(h.Z,{id:"user.settings.notifications.sensitiveWords",defaultMessage:"Other non-case sensitive words, separated by commas:"}))),o.createElement("input",{id:"notificationTriggerCustomText",autoFocus:this.state.customKeysChecked,ref:this.customMentionsRef,className:"form-control mentions-input",type:"text",defaultValue:this.state.customKeys,onChange:this.onCustomChange,onFocus:f.h$,"aria-labelledby":"notificationTriggerCustom"})));const r=o.createElement("span",null,o.createElement(h.Z,{id:"user.settings.notifications.mentionsInfo",defaultMessage:"Mentions trigger when someone sends a message that includes your username (@{username}) or any of the options selected above.",values:{username:t.username}}));s=o.createElement(v.Z,{title:f._u("user.settings.notifications.wordsTrigger","Words That Trigger Mentions"),inputs:a,submit:this.handleSubmit,saving:this.state.isSaving,server_error:e,updateSection:this.handleUpdateSection,extraInfo:r})}else{let e=["@"+t.username];this.state.firstNameKey&&e.push(t.first_name),this.state.usernameKey&&e.push(t.username),this.state.channelKey&&(e.push("@channel"),e.push("@all"),e.push("@here")),this.state.customKeys.length>0&&(e=e.concat(this.state.customKeys.split(",")));let a="";for(let t=0;t<e.length;t++)""!==e[t]&&(a+='"'+e[t]+'", ');a=a.length>0?a.substring(0,a.length-2):o.createElement(h.Z,{id:"user.settings.notifications.noWords",defaultMessage:"No words configured"}),s=o.createElement(S.Z,{title:f._u("user.settings.notifications.wordsTrigger","Words That Trigger Mentions"),describe:a,section:"keys",updateSection:this.handleUpdateSection})}if("comments"===this.props.activeSection){const t=[!1,!1,!1];"never"===this.state.notifyCommentsLevel?t[2]=!0:"root"===this.state.notifyCommentsLevel?t[1]=!0:t[0]=!0;const s=[];s.push(o.createElement("fieldset",{key:"userNotificationLevelOption"},o.createElement("legend",{className:"form-legend hidden-label"},f._u("user.settings.notifications.comments","Reply notifications")),o.createElement("div",{className:"radio"},o.createElement("label",null,o.createElement("input",{id:"notificationCommentsAny",type:"radio",name:"commentsNotificationLevel",checked:t[0],onChange:this.handleNotifyCommentsRadio.bind(this,"any")}),o.createElement(h.Z,{id:"user.settings.notifications.commentsAny",defaultMessage:"Trigger notifications on messages in reply threads that I start or participate in"})),o.createElement("br",null)),o.createElement("div",{className:"radio"},o.createElement("label",null,o.createElement("input",{id:"notificationCommentsRoot",type:"radio",name:"commentsNotificationLevel",checked:t[1],onChange:this.handleNotifyCommentsRadio.bind(this,"root")}),o.createElement(h.Z,{id:"user.settings.notifications.commentsRoot",defaultMessage:"Trigger notifications on messages in threads that I start"})),o.createElement("br",null)),o.createElement("div",{className:"radio"},o.createElement("label",null,o.createElement("input",{id:"notificationCommentsNever",type:"radio",name:"commentsNotificationLevel",checked:t[2],onChange:this.handleNotifyCommentsRadio.bind(this,"never")}),o.createElement(h.Z,{id:"user.settings.notifications.commentsNever",defaultMessage:"Do not trigger notifications on messages in reply threads unless I'm mentioned"})))));const i=o.createElement("span",null,o.createElement(h.Z,{id:"user.settings.notifications.commentsInfo",defaultMessage:"In addition to notifications for when you're mentioned, select if you would like to receive notifications on reply threads."}));a=o.createElement(v.Z,{title:f._u("user.settings.notifications.comments","Reply notifications"),extraInfo:i,inputs:s,submit:this.handleSubmit,saving:this.state.isSaving,server_error:e,updateSection:this.handleUpdateSection})}else{let e="";e="never"===this.state.notifyCommentsLevel?o.createElement(h.Z,{id:"user.settings.notifications.commentsNever",defaultMessage:"Do not trigger notifications on messages in reply threads unless I'm mentioned"}):"root"===this.state.notifyCommentsLevel?o.createElement(h.Z,{id:"user.settings.notifications.commentsRoot",defaultMessage:"Trigger notifications on messages in threads that I start"}):o.createElement(h.Z,{id:"user.settings.notifications.commentsAny",defaultMessage:"Trigger notifications on messages in reply threads that I start or participate in"}),a=o.createElement(S.Z,{title:f._u("user.settings.notifications.comments","Reply notifications"),describe:e,section:"comments",updateSection:this.handleUpdateSection})}if(this.props.enableAutoResponder)if("auto-responder"===this.props.activeSection)i=o.createElement("div",null,o.createElement(Ke,{autoResponderActive:this.state.autoResponderActive,autoResponderMessage:this.state.autoResponderMessage,updateSection:this.handleUpdateSection,setParentState:this.setStateValue,submit:this.handleSubmit,error:this.state.serverError,saving:this.state.isSaving}),o.createElement("div",{className:"divider-dark"}));else{const e=this.state.autoResponderActive?o.createElement(h.Z,{id:"user.settings.notifications.autoResponderEnabled",defaultMessage:"Enabled"}):o.createElement(h.Z,{id:"user.settings.notifications.autoResponderDisabled",defaultMessage:"Disabled"});i=o.createElement(S.Z,{title:o.createElement(h.Z,{id:"user.settings.notifications.autoResponder",defaultMessage:"Automatic Direct Message Replies"}),width:"medium",describe:e,section:"auto-responder",updateSection:this.handleUpdateSection})}const n=this.createPushNotificationSection();return o.createElement("div",{id:"notificationSettings"},o.createElement("div",{className:"modal-header"},o.createElement("button",{id:"closeButton",type:"button",className:"close","data-dismiss":"modal",onClick:this.props.closeModal},o.createElement("span",{"aria-hidden":"true"},"×")),o.createElement("h4",{className:"modal-title",ref:this.drawerRef},o.createElement("div",{className:"modal-back"},o.createElement(h.Z,{id:"generic_icons.collapse",defaultMessage:"Collapse Icon"},(e=>o.createElement("i",{className:"fa fa-angle-left",title:e,onClick:this.props.collapseModal})))),o.createElement(h.Z,{id:"user.settings.notifications.title",defaultMessage:"Notification Settings"}))),o.createElement("div",{ref:this.wrapperRef,className:"user-settings"},o.createElement("h3",{id:"notificationSettingsTitle",className:"tab-header"},o.createElement(h.Z,{id:"user.settings.notifications.header",defaultMessage:"Notifications"})),o.createElement("div",{className:"divider-dark first"}),o.createElement(Fe,{activity:this.state.desktopActivity,sound:this.state.desktopSound,updateSection:this.handleUpdateSection,setParentState:this.setStateValue,submit:this.handleSubmit,saving:this.state.isSaving,cancel:this.handleCancel,error:this.state.serverError,active:"desktop"===this.props.activeSection,selectedSound:this.state.desktopNotificationSound}),o.createElement("div",{className:"divider-light"}),o.createElement(Ve,{activeSection:this.props.activeSection,updateSection:this.handleUpdateSection,enableEmail:"true"===this.state.enableEmail,onSubmit:this.handleSubmit,onCancel:this.handleCancel,onChange:this.handleEmailRadio,saving:this.state.isSaving,serverError:this.state.serverError}),o.createElement("div",{className:"divider-light"}),n,o.createElement("div",{className:"divider-light"}),s,o.createElement("div",{className:"divider-light"}),a,o.createElement("div",{className:"divider-light"}),i,o.createElement("div",{className:"divider-dark"})))}}We(Xe,"propTypes",{user:r().object,updateSection:r().func,activeSection:r().string,closeModal:r().func.isRequired,collapseModal:r().func.isRequired,sendPushNotifications:r().bool,enableAutoResponder:r().bool,actions:r().shape({updateMe:r().func.isRequired}).isRequired}),We(Xe,"defaultProps",{user:null,activeSection:"",activeTab:""});const $e=(0,a.connect)((function(e){const t=(0,c.iE)(e);return{sendPushNotifications:"true"===t.SendPushNotifications,enableAutoResponder:"true"===t.ExperimentalEnableAutomaticReplies}}),(function(e){return{actions:(0,l.bindActionCreators)({updateMe:m.DO},e)}}))(Xe);var Qe=s(48829),et=s(27730),tt=s(73727),st=s(16429),at=s(43253),it=s(64652),nt=s(19476);function rt(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class ot extends o.PureComponent{constructor(e){super(e),rt(this,"onShow",(()=>{this.props.actions.getUserAudits(this.props.currentUserId,0,200)})),rt(this,"onHide",(()=>{this.setState({show:!1})})),this.state={show:!0}}componentDidMount(){this.onShow()}render(){let e;return e=0===this.props.userAudits.length?o.createElement(nt.Z,null):o.createElement(it.Z,{audits:this.props.userAudits,showIp:!0,showSession:!0}),o.createElement(at.Z,{dialogClassName:"a11y__modal modal--scroll",show:this.state.show,onHide:this.onHide,onExited:this.props.onHide,bsSize:"large",role:"dialog","aria-labelledby":"accessHistoryModalLabel"},o.createElement(at.Z.Header,{closeButton:!0},o.createElement(at.Z.Title,{componentClass:"h1",id:"accessHistoryModalLabel"},o.createElement(h.Z,{id:"access_history.title",defaultMessage:"Access History"}))),o.createElement(at.Z.Body,null,e),o.createElement(at.Z.Footer,{className:"modal-footer--invisible"},o.createElement("button",{id:"closeModalButton",type:"button",className:"btn btn-link"},o.createElement(h.Z,{id:"general_button.close",defaultMessage:"Close"}))))}}rt(ot,"propTypes",{onHide:r().func.isRequired,actions:r().shape({getUserAudits:r().func.isRequired}).isRequired,userAudits:r().arrayOf(r().any).isRequired,currentUserId:r().string.isRequired});const lt=(0,a.connect)((function(e){return{currentUserId:(0,i.rc)(e),userAudits:(0,i.Oc)(e)||[]}}),(function(e){return{actions:(0,l.bindActionCreators)({getUserAudits:m.Oc},e)}}))(ot);var ct=s(6602);function dt(e){const{locale:t,currentSession:s,handleMoreInfo:a,moreInfo:i}=e;if(i){const e=new Date(s.create_at);return o.createElement("div",null,o.createElement("div",null,o.createElement(h.Z,{id:"activity_log.firstTime",defaultMessage:"First time active: {date}, {time}",values:{date:o.createElement(G.Ji,{value:e,day:"2-digit",month:(0,E.u)(t),year:"numeric"}),time:o.createElement(G.qN,{value:e,hour:"2-digit",minute:"2-digit"})}})),o.createElement("div",null,o.createElement(h.Z,{id:"activity_log.os",defaultMessage:"OS: {os}",values:{os:s.props.os}})),o.createElement("div",null,o.createElement(h.Z,{id:"activity_log.browser",defaultMessage:"Browser: {browser}",values:{browser:s.props.browser}})),o.createElement("div",null,o.createElement(h.Z,{id:"activity_log.sessionId",defaultMessage:"Session ID: {id}",values:{id:s.id}})))}return o.createElement("a",{className:"theme",href:"#",onClick:a},o.createElement(h.Z,{id:"activity_log.moreInfo",defaultMessage:"More info"}))}function ut(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}s(85827),dt.propTypes={locale:r().string.isRequired,handleMoreInfo:r().func.isRequired,moreInfo:r().bool.isRequired};class mt extends o.PureComponent{constructor(e){super(e),ut(this,"handleMoreInfo",(()=>{this.setState({moreInfo:!0})})),ut(this,"submitRevoke",(e=>{this.props.submitRevoke(this.props.currentSession.id,e)})),ut(this,"isMobileSession",(e=>Boolean(e.device_id&&(e.device_id.includes("apple")||e.device_id.includes("android"))))),ut(this,"mobileSessionInfo",(e=>{let t,s,a,i;return e.device_id.includes("apple")?(a="fa fa-apple",i=(0,f._u)("device_icons.apple","Apple Icon"),t=(0,E.t)("activity_log_modal.iphoneNativeClassicApp"),s="iPhone Native Classic App",e.device_id.includes(_.LQ.PUSH_NOTIFY_APPLE_REACT_NATIVE)&&(t=(0,E.t)("activity_log_modal.iphoneNativeApp"),s="iPhone Native App")):e.device_id.includes("android")&&(a="fa fa-android",i=(0,f._u)("device_icons.android","Android Icon"),t=(0,E.t)("activity_log_modal.androidNativeClassicApp"),s="Android Native Classic App",e.device_id.includes(_.LQ.PUSH_NOTIFY_ANDROID_REACT_NATIVE)&&(t=(0,E.t)("activity_log_modal.androidNativeApp"),s="Android Native App")),{devicePicture:a,deviceTitle:i,devicePlatform:o.createElement(h.Z,{id:t,defaultMessage:s})}})),this.state={moreInfo:!1}}render(){const{index:e,locale:t,currentSession:s}=this.props,a=new Date(s.last_activity_at);let i=s.props.platform,n="",r="";if("Windows"===s.props.platform)n="fa fa-windows",r=(0,f._u)("device_icons.windows","Windows Icon");else if(this.isMobileSession(s)){const e=this.mobileSessionInfo(s);n=e.devicePicture,i=e.devicePlatform}else"Macintosh"===s.props.platform||"iPhone"===s.props.platform?(n="fa fa-apple",r=(0,f._u)("device_icons.apple","Apple Icon")):"Linux"===s.props.platform?s.props.os.indexOf("Android")>=0?(i=o.createElement(h.Z,{id:"activity_log_modal.android",defaultMessage:"Android"}),n="fa fa-android",r=(0,f._u)("device_icons.android","Android Icon")):(n="fa fa-linux",r=(0,f._u)("device_icons.linux","Linux Icon")):-1!==s.props.os.indexOf("Linux")&&(n="fa fa-linux",r=(0,f._u)("device_icons.linux","Linux Icon"));return-1!==s.props.browser.indexOf("Desktop App")&&(i=o.createElement(h.Z,{id:"activity_log_modal.desktop",defaultMessage:"Native Desktop App"})),o.createElement("div",{key:"activityLogEntryKey"+e,className:"activity-log__table"},o.createElement("div",{className:"activity-log__report"},o.createElement("div",{className:"report__platform"},o.createElement("i",{className:n,title:r}),i),o.createElement("div",{className:"report__info"},o.createElement("div",null,o.createElement(h.Z,{id:"activity_log.lastActivity",defaultMessage:"Last activity: {date}, {time}",values:{date:o.createElement(G.Ji,{value:a,day:"2-digit",month:(0,E.u)(t),year:"numeric"}),time:o.createElement(G.qN,{value:a,hour:"2-digit",minute:"2-digit"})}})),o.createElement(dt,{locale:t,currentSession:s,moreInfo:this.state.moreInfo,handleMoreInfo:this.handleMoreInfo}))),o.createElement("div",{className:"activity-log__action"},o.createElement("button",{onClick:this.submitRevoke,className:"btn btn-primary"},o.createElement(h.Z,{id:"activity_log.logout",defaultMessage:"Log Out"}))))}}function pt(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}ut(mt,"propTypes",{index:r().number.isRequired,locale:r().string.isRequired,submitRevoke:r().func.isRequired});class ht extends o.PureComponent{constructor(e){super(e),pt(this,"submitRevoke",((e,t)=>{t.preventDefault();var s=x()(t.target).closest(".modal-content");s.addClass("animation--highlight"),setTimeout((()=>{s.removeClass("animation--highlight")}),1500),this.props.actions.revokeSession(this.props.currentUserId,e).then((()=>{this.props.actions.getSessions(this.props.currentUserId)}))})),pt(this,"onShow",(()=>{this.props.actions.getSessions(this.props.currentUserId)})),pt(this,"onHide",(()=>{this.setState({show:!1})})),this.state={show:!0}}componentDidMount(){this.onShow()}render(){let e;if(this.props.sessions.loading)e=o.createElement(nt.Z,null);else{const t=this.props.sessions.reduce(((e,t,s)=>("UserAccessToken"===t.props.type||e.push(o.createElement(mt,{key:t.id,index:s,locale:this.props.locale,currentSession:t,submitRevoke:this.submitRevoke})),e)),[]);e=o.createElement("form",{role:"form"},t)}return o.createElement(at.Z,{dialogClassName:"a11y__modal modal--scroll",show:this.state.show,onHide:this.onHide,onExited:this.props.onHide,bsSize:"large",role:"dialog","aria-labelledby":"activityLogModalLabel"},o.createElement(at.Z.Header,{closeButton:!0},o.createElement(at.Z.Title,{componentClass:"h1",id:"activityLogModalLabel"},o.createElement(h.Z,{id:"activity_log.activeSessions",defaultMessage:"Active Sessions"}))),o.createElement(at.Z.Body,null,o.createElement("p",{className:"session-help-text"},o.createElement(h.Z,{id:"activity_log.sessionsDescription",defaultMessage:"Sessions are created when you log in through a new browser on a device. Sessions let you use MatterFOSS without having to log in again for a time period specified by the system administrator. To end the session sooner, use the 'Log Out' button."})),e),o.createElement(at.Z.Footer,{className:"modal-footer--invisible"},o.createElement("button",{id:"closeModalButton",type:"button",className:"btn btn-link"},o.createElement(h.Z,{id:"general_button.close",defaultMessage:"Close"}))))}}pt(ht,"propTypes",{currentUserId:r().string.isRequired,sessions:r().oneOfType([r().array,r().object]).isRequired,locale:r().string.isRequired,onHide:r().func.isRequired,actions:r().shape({getSessions:r().func.isRequired,revokeSession:r().func.isRequired}).isRequired});const gt=(0,a.connect)((function(e){return{currentUserId:(0,i.rc)(e),sessions:(0,i.c7)(e),locale:(0,ct.B)(e)}}),(function(e){return{actions:(0,l.bindActionCreators)({getSessions:m.Rx,revokeSession:m._1},e)}}))(ht);var ft=s(61032),Et=s(63470),vt=s(89262);function St(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class bt extends o.PureComponent{constructor(e){super(e),St(this,"setupMfa",(e=>{e.preventDefault(),vt.m.push("/mfa/setup")})),St(this,"removeMfa",(async e=>{e.preventDefault();const{error:t}=await this.props.actions.deactivateMfa();t?this.setState({serverError:t.message}):this.props.mfaEnforced?vt.m.push("/mfa/setup"):(this.props.updateSection(""),this.setState({serverError:null}))})),St(this,"renderTitle",(()=>o.createElement(h.Z,{id:"user.settings.mfa.title",defaultMessage:"Multi-factor Authentication"}))),St(this,"renderDescription",(()=>this.props.mfaActive?o.createElement(h.Z,{id:"user.settings.security.active",defaultMessage:"Active"}):o.createElement(h.Z,{id:"user.settings.security.inactive",defaultMessage:"Inactive"}))),St(this,"renderContent",(()=>{let e;if(this.props.mfaActive){let t;t=this.props.mfaEnforced?o.createElement(h.Z,{id:"user.settings.mfa.reset",defaultMessage:"Reset MFA on Account"}):o.createElement(h.Z,{id:"user.settings.mfa.remove",defaultMessage:"Remove MFA from Account"}),e=o.createElement("a",{className:"btn btn-primary",href:"#",onClick:this.removeMfa},t)}else e=o.createElement("a",{className:"btn btn-primary",href:"#",onClick:this.setupMfa},o.createElement(h.Z,{id:"user.settings.mfa.add",defaultMessage:"Add MFA to Account"}));return o.createElement("div",{className:"pt-2"},e,o.createElement("br",null))})),St(this,"renderHelpText",(()=>this.props.mfaActive?this.props.mfaEnforced?o.createElement(h.Z,{id:"user.settings.mfa.requiredHelp",defaultMessage:"Multi-factor authentication is required on this server. Resetting is only recommended when you need to switch code generation to a new mobile device. You will be required to set it up again immediately."}):o.createElement(h.Z,{id:"user.settings.mfa.removeHelp",defaultMessage:"Removing multi-factor authentication means you will no longer require a phone-based passcode to sign-in to your account."}):o.createElement(h.Z,{id:"user.settings.mfa.addHelp",defaultMessage:"Adding multi-factor authentication will make your account more secure by requiring a code from your mobile phone each time you sign in."}))),this.state={serverError:null}}render(){const e=this.renderTitle();return this.props.mfaAvailable?this.props.active?o.createElement(v.Z,{title:e,inputs:this.renderContent(),extraInfo:this.renderHelpText(),serverError:this.state.serverError,updateSection:this.props.updateSection,width:"medium"}):o.createElement(S.Z,{title:e,describe:this.renderDescription(),section:"mfa",updateSection:this.props.updateSection}):null}}St(bt,"propTypes",{active:r().bool.isRequired,mfaActive:r().bool.isRequired,mfaAvailable:r().bool.isRequired,mfaEnforced:r().bool.isRequired,updateSection:r().func.isRequired,actions:r().shape({deactivateMfa:r().func.isRequired}).isRequired});const yt=(0,a.connect)((function(e){const t=(0,c.lJ)(e),s=(0,c.iE)(e),a=t&&"true"===t.IsLicensed&&"true"===t.MFA,n="true"===s.EnableMultifactorAuthentication,r=a&&"true"===s.EnforceMultifactorAuthentication,o=(0,i.ts)(e);let l=!1,d=!1;return o&&(l=o.mfa_active,d=n&&(""===o.auth_service||o.auth_service===p.ZP.LDAP_SERVICE)),{mfaActive:l,mfaAvailable:d,mfaEnforced:r}}),(function(e){return{actions:(0,l.bindActionCreators)({deactivateMfa:Et.sk},e)}}))(bt);var _t=s(58657),Tt=s(37668);function Nt(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}const Mt="creating",Ct="created",At="not_creating";class kt extends o.PureComponent{constructor(e){super(e),Nt(this,"newtokendescriptionRef",void 0),Nt(this,"startCreatingToken",(()=>{this.setState({tokenCreationState:Mt})})),Nt(this,"stopCreatingToken",(()=>{this.setState({tokenCreationState:At,saving:!1})})),Nt(this,"handleCreateToken",(async()=>{this.handleCancelConfirm();const e=this.newtokendescriptionRef?this.newtokendescriptionRef.current.value:"";if(""===e)return void this.setState({tokenError:f._u("user.settings.tokens.nameRequired","Please enter a description.")});this.setState({tokenError:"",saving:!0}),this.props.setRequireConfirm(!0,this.confirmCopyToken);const t=this.props.user?this.props.user.id:"",{data:s,error:a}=await this.props.actions.createUserAccessToken(t,e);s&&this.state.tokenCreationState===Mt?this.setState({tokenCreationState:Ct,newToken:s,saving:!1}):a&&this.setState({serverError:a.message,saving:!1})})),Nt(this,"confirmCopyToken",(e=>{this.setState({showConfirmModal:!0,confirmTitle:o.createElement(h.Z,{id:"user.settings.tokens.confirmCopyTitle",defaultMessage:"Copied Your Token?"}),confirmMessage:e=>o.createElement("div",null,o.createElement(h.Z,{id:"user.settings.tokens.confirmCopyMessage",defaultMessage:"Make sure you have copied and saved the access token below. You won't be able to see it again!"}),o.createElement("br",null),o.createElement("br",null),e.tokenCreationState===Mt?o.createElement("div",null,o.createElement("strong",{className:"word-break--all"},o.createElement(h.Z,{id:"user.settings.tokens.token",defaultMessage:"Access Token: "})),o.createElement(h.Z,{id:"user.settings.tokens.tokenLoading",defaultMessage:"Loading..."})):o.createElement("strong",{className:"word-break--all"},o.createElement(h.Z,{id:"user.settings.tokens.token",defaultMessage:"Access Token: "}),e.newToken.token)),confirmButton:o.createElement(h.Z,{id:"user.settings.tokens.confirmCopyButton",defaultMessage:"Yes, I have copied the token"}),confirmComplete:()=>{this.handleCancelConfirm(),e()},confirmHideCancel:!0})})),Nt(this,"handleCancelConfirm",(()=>{this.setState({showConfirmModal:!1,confirmTitle:null,confirmMessage:null,confirmButton:null,confirmComplete:null,confirmHideCancel:!1})})),Nt(this,"confirmCreateToken",(()=>{et.$O(this.props.user.roles)?this.setState({showConfirmModal:!0,confirmTitle:o.createElement(h.Z,{id:"user.settings.tokens.confirmCreateTitle",defaultMessage:"Create System Admin Personal Access Token"}),confirmMessage:()=>o.createElement("div",{className:"alert alert-danger"},o.createElement(h.Z,{id:"user.settings.tokens.confirmCreateMessage",defaultMessage:"You are generating a personal access token with System Admin permissions. Are you sure want to create this token?"})),confirmButton:o.createElement(h.Z,{id:"user.settings.tokens.confirmCreateButton",defaultMessage:"Yes, Create"}),confirmComplete:()=>{this.handleCreateToken(),(0,ke.L9)("settings","system_admin_create_user_access_token")}}):this.handleCreateToken()})),Nt(this,"saveTokenKeyPress",(e=>{f.pD(e,p.ZP.KeyCodes.ENTER)&&this.confirmCreateToken()})),Nt(this,"confirmRevokeToken",(e=>{const t=this.props.userAccessTokens[e];this.setState({showConfirmModal:!0,confirmTitle:o.createElement(h.Z,{id:"user.settings.tokens.confirmDeleteTitle",defaultMessage:"Delete Token?"}),confirmMessage:()=>o.createElement("div",{className:"alert alert-danger"},o.createElement(me.Z,{id:"user.settings.tokens.confirmDeleteMessage",defaultMessage:"Any integrations using this token will no longer be able to access the MatterFOSS API. You cannot undo this action. \\n \\nAre you sure want to delete the **{description}** token?",values:{description:t.description}})),confirmButton:o.createElement(h.Z,{id:"user.settings.tokens.confirmDeleteButton",defaultMessage:"Yes, Delete"}),confirmComplete:()=>{this.revokeToken(e),(0,ke.L9)("settings","revoke_user_access_token")}})})),Nt(this,"revokeToken",(async e=>{const{error:t}=await this.props.actions.revokeUserAccessToken(e);t&&this.setState({serverError:t.message}),this.handleCancelConfirm()})),Nt(this,"activateToken",(async e=>{const{error:t}=await this.props.actions.enableUserAccessToken(e);t?this.setState({serverError:t.message}):(0,ke.L9)("settings","activate_user_access_token")})),Nt(this,"deactivateToken",(async e=>{const{error:t}=await this.props.actions.disableUserAccessToken(e);t?this.setState({serverError:t.message}):(0,ke.L9)("settings","deactivate_user_access_token")})),this.state={active:this.props.active,showConfirmModal:!1,newToken:null,tokenCreationState:At,tokenError:"",serverError:null,saving:!1},this.newtokendescriptionRef=o.createRef()}componentDidMount(){this.props.actions.clearUserAccessTokens();const e=this.props.user?this.props.user.id:"";this.props.actions.getUserAccessTokensForUser(e,0,200)}static getDerivedStateFromProps(e,t){return!e.active&&t.active?{active:e.active,showConfirmModal:!1,newToken:null,tokenCreationState:At,tokenError:"",serverError:null,saving:!1}:{active:e.active}}render(){let e="";if(!this.props.active){const e=f._u("user.settings.tokens.clickToEdit","Click 'Edit' to manage your personal access tokens");return o.createElement(S.Z,{title:f._u("user.settings.tokens.title","Personal Access Tokens"),describe:e,section:"tokens",updateSection:this.props.updateSection})}const t=[];let s,a,i;Object.values(this.props.userAccessTokens).forEach((e=>{if(this.state.newToken&&this.state.newToken.id===e.id)return;let s,a;e.is_active?s=o.createElement("a",{id:e.id+"_deactivate",href:"#",onClick:t=>{t.preventDefault(),this.deactivateToken(e.id)}},o.createElement(h.Z,{id:"user.settings.tokens.deactivate",defaultMessage:"Disable"})):(a=o.createElement("span",{className:"has-error setting-box__inline-error"},o.createElement(h.Z,{id:"user.settings.tokens.deactivatedWarning",defaultMessage:"(Disabled)"})),s=o.createElement("a",{id:e.id+"_activate",href:"#",onClick:t=>{t.preventDefault(),this.activateToken(e.id)}},o.createElement(h.Z,{id:"user.settings.tokens.activate",defaultMessage:"Enable"}))),t.push(o.createElement("div",{key:e.id,className:"setting-box__item"},o.createElement("div",{className:"whitespace--nowrap overflow--ellipsis"},o.createElement(h.Z,{id:"user.settings.tokens.tokenDesc",defaultMessage:"Token Description: "}),e.description,a),o.createElement("div",{className:"setting-box__token-id whitespace--nowrap overflow--ellipsis"},o.createElement(h.Z,{id:"user.settings.tokens.tokenId",defaultMessage:"Token ID: "}),e.id),o.createElement("div",null,s," - ",o.createElement("a",{id:e.id+"_delete",href:"#",onClick:t=>{t.preventDefault(),this.confirmRevokeToken(e.id)}},o.createElement(h.Z,{id:"user.settings.tokens.delete",defaultMessage:"Delete"}))),o.createElement("hr",{className:"mb-3 mt-3"})))})),0===t.length&&(s=o.createElement(h.Z,{key:"notokens",id:"user.settings.tokens.userAccessTokensNone",defaultMessage:"No personal access tokens."})),a=(0,xe.tq)()?o.createElement("span",null,o.createElement(me.Z,{id:"user.settings.tokens.description_mobile",defaultMessage:"[Personal access tokens](!https://about.mattermost.com/default-user-access-tokens) function similarly to session tokens and can be used by integrations to [authenticate against the REST API](!https://about.mattermost.com/default-api-authentication). Create new tokens on your desktop."})):o.createElement("span",null,o.createElement(me.Z,{id:"user.settings.tokens.description",defaultMessage:"[Personal access tokens](!https://about.mattermost.com/default-user-access-tokens) function similarly to session tokens and can be used by integrations to [authenticate against the REST API](!https://about.mattermost.com/default-api-authentication)."})),this.state.tokenCreationState===Mt?i=o.createElement("div",{className:"pl-3"},o.createElement("div",{className:"row"},o.createElement("label",{className:"col-sm-auto control-label pr-3"},o.createElement(h.Z,{id:"user.settings.tokens.name",defaultMessage:"Token Description: "})),o.createElement("div",{className:"col-sm-5"},o.createElement("input",{autoFocus:!0,ref:this.newtokendescriptionRef,className:"form-control",type:"text",maxLength:64,onKeyPress:this.saveTokenKeyPress}))),o.createElement("div",null,o.createElement("div",{className:"pt-3"},o.createElement(h.Z,{id:"user.settings.tokens.nameHelp",defaultMessage:"Enter a description for your token to remember what it does."})),o.createElement("div",null,o.createElement("label",{id:"clientError",className:"has-error mt-2 mb-2"},this.state.tokenError)),o.createElement(_t.Z,{btnClass:"btn-primary",savingMessage:o.createElement(h.Z,{id:"user.settings.tokens.save",defaultMessage:"Save"}),saving:this.state.saving,onClick:this.confirmCreateToken}),o.createElement("button",{className:"btn btn-link",onClick:this.stopCreatingToken},o.createElement(h.Z,{id:"user.settings.tokens.cancel",defaultMessage:"Cancel"})))):this.state.tokenCreationState===Ct?(0===t.length&&(e=" hidden"),i=o.createElement("div",{className:"alert alert-warning"},o.createElement(Tt.Z,{additionalClassName:"mr-2"}),o.createElement(h.Z,{id:"user.settings.tokens.copy",defaultMessage:"Please copy the access token below. You won't be able to see it again!"}),o.createElement("br",null),o.createElement("br",null),o.createElement("div",{className:"whitespace--nowrap overflow--ellipsis"},o.createElement(h.Z,{id:"user.settings.tokens.name",defaultMessage:"Token Description: "}),this.state.newToken.description),o.createElement("div",{className:"whitespace--nowrap overflow--ellipsis"},o.createElement(h.Z,{id:"user.settings.tokens.id",defaultMessage:"Token ID: "}),this.state.newToken.id),o.createElement("strong",{className:"word-break--all"},o.createElement(h.Z,{id:"user.settings.tokens.token",defaultMessage:"Access Token: "}),this.state.newToken.token))):i=o.createElement("a",{className:"btn btn-primary",href:"#",onClick:this.startCreatingToken},o.createElement(h.Z,{id:"user.settings.tokens.create",defaultMessage:"Create Token"}));const n=[];return n.push(o.createElement("div",{key:"tokensSetting",className:"pt-2"},o.createElement("div",{key:"tokenList"},o.createElement("div",{className:"alert alert-transparent"+e},t,s),i))),o.createElement("div",null,o.createElement(v.Z,{title:f._u("user.settings.tokens.title","Personal Access Tokens"),inputs:n,extraInfo:a,infoPosition:"top",serverError:this.state.serverError,updateSection:this.props.updateSection,width:"full",saving:this.state.saving,cancelButtonText:o.createElement(h.Z,{id:"user.settings.security.close",defaultMessage:"Close"})}),o.createElement(b.Z,{title:this.state.confirmTitle,message:this.state.confirmMessage?this.state.confirmMessage(this.state):null,confirmButtonText:this.state.confirmButton,show:this.state.showConfirmModal,onConfirm:this.state.confirmComplete||(()=>null),onCancel:this.handleCancelConfirm,hideCancel:this.state.confirmHideCancel}))}}Nt(kt,"propTypes",{active:r().bool,updateSection:r().func.isRequired,userAccessTokens:r().objectOf(r().shape({description:r().string.isRequired,id:r().string.isRequired,is_active:r().bool.isRequired})).isRequired,setRequireConfirm:r().func.isRequired,actions:r().shape({getUserAccessTokensForUser:r().func.isRequired,createUserAccessToken:r().func.isRequired,revokeUserAccessToken:r().func.isRequired,enableUserAccessToken:r().func.isRequired,disableUserAccessToken:r().func.isRequired,clearUserAccessTokens:r().func.isRequired}).isRequired});const wt=(0,a.connect)((function(e){return{userAccessTokens:e.entities.users.myUserAccessTokens}}),(function(e){return{actions:(0,l.bindActionCreators)({getUserAccessTokensForUser:m.fh,createUserAccessToken:m.CR,revokeUserAccessToken:m.ei,enableUserAccessToken:m.q9,disableUserAccessToken:m.Wv,clearUserAccessTokens:m.RZ},e)}}))(kt);function Pt(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}const Ot="password",Rt="signin",Zt="apps",It="tokens";class Dt extends o.PureComponent{constructor(e){super(e),Pt(this,"loadAuthorizedOAuthApps",(async()=>{const e=await this.props.actions.getAuthorizedOAuthApps();if("data"in e){const{data:t}=e;this.setState({authorizedApps:t,serverError:null})}else if("error"in e){const{error:t}=e;this.setState({serverError:t.message})}})),Pt(this,"submitPassword",(async()=>{const e=this.props.user,t=this.state.currentPassword,s=this.state.newPassword,a=this.state.confirmPassword;if(""===t)return void this.setState({passwordError:f._u("user.settings.security.currentPasswordError","Please enter your current password."),serverError:""});const{valid:i,error:n}=f.eW(s,this.props.passwordConfig);if(!i&&n)return void this.setState({passwordError:n,serverError:""});if(s!==a){const e=Object.assign(this.getDefaultState(),{passwordError:f._u("user.settings.security.passwordMatchError","The new passwords you entered do not match."),serverError:""});return void this.setState(e)}this.setState({savingPassword:!0});const r=await this.props.actions.updateUserPassword(e.id,t,s);if("data"in r)this.props.updateSection(""),this.props.actions.getMe(),this.setState(this.getDefaultState());else if("error"in r){const{error:e}=r,t=this.getDefaultState();e.message?t.serverError=e.message:t.serverError=e,t.passwordError="",this.setState(t)}})),Pt(this,"updateCurrentPassword",(e=>{this.setState({currentPassword:e.target.value})})),Pt(this,"updateNewPassword",(e=>{this.setState({newPassword:e.target.value})})),Pt(this,"updateConfirmPassword",(e=>{this.setState({confirmPassword:e.target.value})})),Pt(this,"deauthorizeApp",(async e=>{e.preventDefault();const t=e.currentTarget.getAttribute("data-app"),s=await this.props.actions.deauthorizeOAuthApp(t);if("data"in s){const e=this.state.authorizedApps.filter((e=>e.id!==t));this.setState({authorizedApps:e,serverError:null})}else if("error"in s){const{error:e}=s;this.setState({serverError:e.message})}})),Pt(this,"handleUpdateSection",(e=>{if(e)this.props.updateSection(e);else{switch(this.props.activeSection){case"mfa":case Rt:case It:case Zt:this.setState({serverError:null});break;case Ot:this.setState({currentPassword:"",newPassword:"",confirmPassword:"",serverError:null,passwordError:null})}this.props.updateSection("")}})),Pt(this,"createPasswordSection",(()=>{if(this.props.activeSection===Ot){const e=[];let t;return""===this.props.user.auth_service?(t=this.submitPassword,e.push(o.createElement("div",{key:"currentPasswordUpdateForm",className:"form-group"},o.createElement("label",{className:"col-sm-5 control-label"},o.createElement(h.Z,{id:"user.settings.security.currentPassword",defaultMessage:"Current Password"})),o.createElement("div",{className:"col-sm-7"},o.createElement("input",{id:"currentPassword",autoFocus:!0,className:"form-control",type:"password",onChange:this.updateCurrentPassword,value:this.state.currentPassword,"aria-label":f._u("user.settings.security.currentPassword","Current Password")})))),e.push(o.createElement("div",{key:"newPasswordUpdateForm",className:"form-group"},o.createElement("label",{className:"col-sm-5 control-label"},o.createElement(h.Z,{id:"user.settings.security.newPassword",defaultMessage:"New Password"})),o.createElement("div",{className:"col-sm-7"},o.createElement("input",{id:"newPassword",className:"form-control",type:"password",onChange:this.updateNewPassword,value:this.state.newPassword,"aria-label":f._u("user.settings.security.newPassword","New Password")})))),e.push(o.createElement("div",{key:"retypeNewPasswordUpdateForm",className:"form-group"},o.createElement("label",{className:"col-sm-5 control-label"},o.createElement(h.Z,{id:"user.settings.security.retypePassword",defaultMessage:"Retype New Password"})),o.createElement("div",{className:"col-sm-7"},o.createElement("input",{id:"confirmPassword",className:"form-control",type:"password",onChange:this.updateConfirmPassword,value:this.state.confirmPassword,"aria-label":f._u("user.settings.security.retypePassword","Retype New Password")}))))):this.props.user.auth_service===p.ZP.GITLAB_SERVICE?e.push(o.createElement("div",{key:"oauthEmailInfo",className:"form-group"},o.createElement("div",{className:"pb-3"},o.createElement(h.Z,{id:"user.settings.security.passwordGitlabCantUpdate",defaultMessage:"Login occurs through GitLab. Password cannot be updated."})))):this.props.user.auth_service===p.ZP.LDAP_SERVICE?e.push(o.createElement("div",{key:"oauthEmailInfo",className:"form-group"},o.createElement("div",{className:"pb-3"},o.createElement(h.Z,{id:"user.settings.security.passwordLdapCantUpdate",defaultMessage:"Login occurs through AD/LDAP. Password cannot be updated."})))):this.props.user.auth_service===p.ZP.SAML_SERVICE?e.push(o.createElement("div",{key:"oauthEmailInfo",className:"form-group"},o.createElement("div",{className:"pb-3"},o.createElement(h.Z,{id:"user.settings.security.passwordSamlCantUpdate",defaultMessage:"This field is handled through your login provider. If you want to change it, you need to do so through your login provider."})))):this.props.user.auth_service===p.ZP.GOOGLE_SERVICE?e.push(o.createElement("div",{key:"oauthEmailInfo",className:"form-group"},o.createElement("div",{className:"pb-3"},o.createElement(h.Z,{id:"user.settings.security.passwordGoogleCantUpdate",defaultMessage:"Login occurs through Google Apps. Password cannot be updated."})))):this.props.user.auth_service===p.ZP.OFFICE365_SERVICE&&e.push(o.createElement("div",{key:"oauthEmailInfo",className:"form-group"},o.createElement("div",{className:"pb-3"},o.createElement(h.Z,{id:"user.settings.security.passwordOffice365CantUpdate",defaultMessage:"Login occurs through Office 365. Password cannot be updated."})))),o.createElement(v.Z,{title:o.createElement(h.Z,{id:"user.settings.security.password",defaultMessage:"Password"}),inputs:e,submit:t,saving:this.state.savingPassword,serverError:this.state.serverError,clientError:this.state.passwordError,updateSection:this.handleUpdateSection})}let e;if(""===this.props.user.auth_service){const t=new Date(this.props.user.last_password_update);e=o.createElement(h.Z,{id:"user.settings.security.lastUpdated",defaultMessage:"Last updated {date} at {time}",values:{date:o.createElement(G.Ji,{value:t,day:"2-digit",month:"short",year:"numeric"}),time:o.createElement(G.qN,{value:t,hour12:!this.props.militaryTime,hour:"2-digit",minute:"2-digit"})}})}else this.props.user.auth_service===p.ZP.GITLAB_SERVICE?e=o.createElement(h.Z,{id:"user.settings.security.loginGitlab",defaultMessage:"Login done through GitLab"}):this.props.user.auth_service===p.ZP.LDAP_SERVICE?e=o.createElement(h.Z,{id:"user.settings.security.loginLdap",defaultMessage:"Login done through AD/LDAP"}):this.props.user.auth_service===p.ZP.SAML_SERVICE?e=o.createElement(h.Z,{id:"user.settings.security.loginSaml",defaultMessage:"Login done through SAML"}):this.props.user.auth_service===p.ZP.GOOGLE_SERVICE?e=o.createElement(h.Z,{id:"user.settings.security.loginGoogle",defaultMessage:"Login done through Google Apps"}):this.props.user.auth_service===p.ZP.OFFICE365_SERVICE&&(e=o.createElement(h.Z,{id:"user.settings.security.loginOffice365",defaultMessage:"Login done through Office 365"}));return o.createElement(S.Z,{title:o.createElement(h.Z,{id:"user.settings.security.password",defaultMessage:"Password"}),describe:e,section:Ot,updateSection:this.handleUpdateSection})})),Pt(this,"createSignInSection",(()=>{const e=this.props.user;if(this.props.activeSection===Rt){let t,s,a,i,n,r,l;if(""===e.auth_service)this.props.enableSignUpWithGitLab&&(s=o.createElement("div",{className:"pb-3"},o.createElement(tt.Link,{className:"btn btn-primary",to:"/claim/email_to_oauth?email="+encodeURIComponent(e.email)+"&old_type="+e.auth_service+"&new_type="+p.ZP.GITLAB_SERVICE},o.createElement(h.Z,{id:"user.settings.security.switchGitlab",defaultMessage:"Switch to Using GitLab SSO"})),o.createElement("br",null))),this.props.enableSignUpWithGoogle&&(a=o.createElement("div",{className:"pb-3"},o.createElement(tt.Link,{className:"btn btn-primary",to:"/claim/email_to_oauth?email="+encodeURIComponent(e.email)+"&old_type="+e.auth_service+"&new_type="+p.ZP.GOOGLE_SERVICE},o.createElement(h.Z,{id:"user.settings.security.switchGoogle",defaultMessage:"Switch to Using Google SSO"})),o.createElement("br",null))),this.props.enableSignUpWithOffice365&&(i=o.createElement("div",{className:"pb-3"},o.createElement(tt.Link,{className:"btn btn-primary",to:"/claim/email_to_oauth?email="+encodeURIComponent(e.email)+"&old_type="+e.auth_service+"&new_type="+p.ZP.OFFICE365_SERVICE},o.createElement(h.Z,{id:"user.settings.security.switchOffice365",defaultMessage:"Switch to Using Office 365 SSO"})),o.createElement("br",null))),this.props.enableSignUpWithOpenId&&(n=o.createElement("div",{className:"pb-3"},o.createElement(tt.Link,{className:"btn btn-primary",to:"/claim/email_to_oauth?email="+encodeURIComponent(e.email)+"&old_type="+e.auth_service+"&new_type="+p.ZP.OPENID_SERVICE},o.createElement(h.Z,{id:"user.settings.security.switchOpenId",defaultMessage:"Switch to Using OpenID SSO"})),o.createElement("br",null))),this.props.enableLdap&&(r=o.createElement("div",{className:"pb-3"},o.createElement(tt.Link,{className:"btn btn-primary",to:"/claim/email_to_ldap?email="+encodeURIComponent(e.email)},o.createElement(h.Z,{id:"user.settings.security.switchLdap",defaultMessage:"Switch to Using AD/LDAP"})),o.createElement("br",null))),this.props.enableSaml&&(l=o.createElement("div",{className:"pb-3"},o.createElement(tt.Link,{className:"btn btn-primary",to:"/claim/email_to_oauth?email="+encodeURIComponent(e.email)+"&old_type="+e.auth_service+"&new_type="+p.ZP.SAML_SERVICE},o.createElement(h.Z,{id:"user.settings.security.switchSaml",defaultMessage:"Switch to Using SAML SSO"})),o.createElement("br",null)));else if(this.props.enableSignUpWithEmail){let s;s=e.auth_service===p.ZP.LDAP_SERVICE?"/claim/ldap_to_email?email="+encodeURIComponent(e.email):"/claim/oauth_to_email?email="+encodeURIComponent(e.email)+"&old_type="+e.auth_service,t=o.createElement("div",{className:"pb-3"},o.createElement(tt.Link,{className:"btn btn-primary",to:s},o.createElement(h.Z,{id:"user.settings.security.switchEmail",defaultMessage:"Switch to Using Email and Password"})),o.createElement("br",null))}const c=[];c.push(o.createElement("div",{key:"userSignInOption"},t,s,a,i,n,r,l));const d=o.createElement("span",null,o.createElement(h.Z,{id:"user.settings.security.oneSignin",defaultMessage:"You may only have one sign-in method at a time. Switching sign-in method will send an email notifying you if the change was successful."}));return o.createElement(v.Z,{title:f._u("user.settings.security.method","Sign-in Method"),extraInfo:d,inputs:c,serverError:this.state.serverError,updateSection:this.handleUpdateSection})}let t=o.createElement(h.Z,{id:"user.settings.security.emailPwd",defaultMessage:"Email and Password"});return this.props.user.auth_service===p.ZP.GITLAB_SERVICE?t=o.createElement(h.Z,{id:"user.settings.security.gitlab",defaultMessage:"GitLab"}):this.props.user.auth_service===p.ZP.GOOGLE_SERVICE?t=o.createElement(h.Z,{id:"user.settings.security.google",defaultMessage:"Google"}):this.props.user.auth_service===p.ZP.OFFICE365_SERVICE?t=o.createElement(h.Z,{id:"user.settings.security.office365",defaultMessage:"Office 365"}):this.props.user.auth_service===p.ZP.OPENID_SERVICE?t=o.createElement(h.Z,{id:"user.settings.security.openid",defaultMessage:"OpenID"}):this.props.user.auth_service===p.ZP.LDAP_SERVICE?t=o.createElement(h.Z,{id:"user.settings.security.ldap",defaultMessage:"AD/LDAP"}):this.props.user.auth_service===p.ZP.SAML_SERVICE&&(t=o.createElement(h.Z,{id:"user.settings.security.saml",defaultMessage:"SAML"})),o.createElement(S.Z,{title:f._u("user.settings.security.method","Sign-in Method"),describe:t,section:Rt,updateSection:this.handleUpdateSection})})),Pt(this,"createOAuthAppsSection",(()=>{if(this.props.activeSection===Zt){let e;e=this.state.authorizedApps&&this.state.authorizedApps.length>0?this.state.authorizedApps.map((e=>{const t=o.createElement("a",{href:e.homepage,target:"_blank",rel:"noopener noreferrer"},e.homepage);return o.createElement("div",{key:e.id,className:"pb-3 authorized-app"},o.createElement("div",{className:"col-sm-10"},o.createElement("div",{className:"authorized-app__name"},e.name,o.createElement("span",{className:"authorized-app__url"}," -"," ",t)),o.createElement("div",{className:"authorized-app__description"},e.description),o.createElement("div",{className:"authorized-app__deauthorize"},o.createElement("a",{href:"#","data-app":e.id,onClick:this.deauthorizeApp},o.createElement(h.Z,{id:"user.settings.security.deauthorize",defaultMessage:"Deauthorize"})))),o.createElement("div",{className:"col-sm-2 pull-right"},o.createElement("img",{alt:e.name,src:e.icon_url||st.Z})),o.createElement("br",null))})):o.createElement("div",{className:"pb-3 authorized-app"},o.createElement("div",{className:"setting-list__hint"},o.createElement(h.Z,{id:"user.settings.security.noApps",defaultMessage:"No OAuth 2.0 Applications are authorized."})));const t=[];let s,a;Array.isArray(e)&&(s="authorized-apps__wrapper",a=o.createElement("div",{className:"authorized-apps__help"},o.createElement(h.Z,{id:"user.settings.security.oauthAppsHelp",defaultMessage:"Applications act on your behalf to access your data based on the permissions you grant them."}))),t.push(o.createElement("div",{className:s,key:"authorizedApps"},e));const i=o.createElement("div",null,o.createElement(h.Z,{id:"user.settings.security.oauthApps",defaultMessage:"OAuth 2.0 Applications"}),a);return o.createElement(v.Z,{title:i,inputs:t,serverError:this.state.serverError,updateSection:this.handleUpdateSection,width:"full",cancelButtonText:o.createElement(h.Z,{id:"user.settings.security.close",defaultMessage:"Close"})})}return o.createElement(S.Z,{title:f._u("user.settings.security.oauthApps","OAuth 2.0 Applications"),describe:o.createElement(h.Z,{id:"user.settings.security.oauthAppsDescription",defaultMessage:"Click 'Edit' to manage your OAuth 2.0 Applications"}),section:Zt,updateSection:this.handleUpdateSection})})),this.state=this.getDefaultState()}getDefaultState(){return{currentPassword:"",newPassword:"",confirmPassword:"",passwordError:"",serverError:"",tokenError:"",authService:this.props.user.auth_service,savingPassword:!1,authorizedApps:[]}}componentDidMount(){this.props.enableOAuthServiceProvider&&this.loadAuthorizedOAuthApps()}render(){const e=this.props.user,t=this.createPasswordSection();let s,a,i,n=0;return n=this.props.enableSignUpWithGitLab?n+1:n,n=this.props.enableSignUpWithGoogle?n+1:n,n=this.props.enableSignUpWithOffice365?n+1:n,n=this.props.enableSignUpWithOpenId?n+1:n,n=this.props.enableLdap?n+1:n,n=this.props.enableSaml?n+1:n,(this.props.enableSignUpWithEmail||""===e.auth_service)&&n>0&&this.props.experimentalEnableAuthenticationTransfer&&(s=this.createSignInSection()),this.props.enableOAuthServiceProvider&&(a=this.createOAuthAppsSection()),this.props.canUseAccessTokens&&(i=o.createElement(wt,{user:this.props.user,active:this.props.activeSection===It,updateSection:this.handleUpdateSection,setRequireConfirm:this.props.setRequireConfirm})),o.createElement("div",null,o.createElement("div",{className:"modal-header"},o.createElement(h.Z,{id:"user.settings.security.close",defaultMessage:"Close"},(e=>o.createElement("button",{type:"button",className:"close","data-dismiss":"modal","aria-label":e,onClick:this.props.closeModal},o.createElement("span",{"aria-hidden":"true"},"×")))),o.createElement("h4",{className:"modal-title",ref:"title"},o.createElement("div",{className:"modal-back"},o.createElement(h.Z,{id:"generic_icons.collapse",defaultMessage:"Collapse Icon"},(e=>o.createElement("i",{className:"fa fa-angle-left",title:e,onClick:this.props.collapseModal})))),o.createElement(h.Z,{id:"user.settings.security.title",defaultMessage:"Security Settings"}))),o.createElement("div",{className:"user-settings"},o.createElement("h3",{className:"tab-header"},o.createElement(h.Z,{id:"user.settings.security.title",defaultMessage:"Security Settings"})),o.createElement("div",{className:"divider-dark first"}),t,o.createElement("div",{className:"divider-light"}),o.createElement(yt,{active:"mfa"===this.props.activeSection,updateSection:this.handleUpdateSection}),o.createElement("div",{className:"divider-light"}),a,o.createElement("div",{className:"divider-light"}),i,o.createElement("div",{className:"divider-light"}),s,o.createElement("div",{className:"divider-dark"}),o.createElement("br",null),o.createElement(ft.Z,{className:"security-links color--link",dialogType:lt,id:"viewAccessHistory"},o.createElement(h.Z,{id:"user.settings.security.viewHistory.icon",defaultMessage:"Access History Icon"},(e=>o.createElement("i",{className:"fa fa-clock-o",title:e}))),o.createElement(h.Z,{id:"user.settings.security.viewHistory",defaultMessage:"View Access History"})),o.createElement(ft.Z,{className:"security-links color--link mt-2",dialogType:gt,id:"viewAndLogOutOfActiveSessions"},o.createElement(h.Z,{id:"user.settings.security.logoutActiveSessions.icon",defaultMessage:"Active Sessions Icon"},(e=>o.createElement("i",{className:"fa fa-clock-o",title:e}))),o.createElement(h.Z,{id:"user.settings.security.logoutActiveSessions",defaultMessage:"View and Log Out of Active Sessions"}))))}}Pt(Dt,"propTypes",{activeSection:r().string,updateSection:r().func.isRequired,closeModal:r().func.isRequired,collapseModal:r().func.isRequired,setRequireConfirm:r().func.isRequired,canUseAccessTokens:r().bool.isRequired,enableOAuthServiceProvider:r().bool.isRequired,enableSignUpWithEmail:r().bool.isRequired,enableSignUpWithGitLab:r().bool.isRequired,enableSignUpWithGoogle:r().bool.isRequired,enableSignUpWithOpenId:r().bool.isRequired,enableLdap:r().bool.isRequired,enableSaml:r().bool.isRequired,enableSignUpWithOffice365:r().bool.isRequired,experimentalEnableAuthenticationTransfer:r().bool.isRequired,militaryTime:r().bool.isRequired,actions:r().shape({getMe:r().func.isRequired,updateUserPassword:r().func.isRequired,getAuthorizedOAuthApps:r().func.isRequired,deauthorizeOAuthApp:r().func.isRequired}).isRequired});const Lt=(0,a.connect)((function(e,t){const s=(0,c.iE)(e),a="true"===s.EnableUserAccessTokens,i=et.$t(t.user.roles)||et.$O(t.user.roles);return{canUseAccessTokens:a&&i,enableOAuthServiceProvider:"true"===s.EnableOAuthServiceProvider,enableSignUpWithEmail:"true"===s.EnableSignUpWithEmail,enableSignUpWithGitLab:"true"===s.EnableSignUpWithGitLab,enableSignUpWithGoogle:"true"===s.EnableSignUpWithGoogle,enableSignUpWithOpenId:"true"===s.EnableSignUpWithOpenId,enableLdap:"true"===s.EnableLdap,enableSaml:"true"===s.EnableSaml,enableSignUpWithOffice365:"true"===s.EnableSignUpWithOffice365,experimentalEnableAuthenticationTransfer:"true"===s.ExperimentalEnableAuthenticationTransfer,passwordConfig:(0,f.lD)(s),militaryTime:(0,d.o4)(e,p.uP.CATEGORY_DISPLAY_SETTINGS,p.uP.USE_MILITARY_TIME,!1)}}),(function(e){return{actions:(0,l.bindActionCreators)({getMe:m.jo,updateUserPassword:m.Zy,getAuthorizedOAuthApps:Qe.eg,deauthorizeOAuthApp:Qe.VZ},e)}}))(Dt);function Ut(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class xt extends o.PureComponent{constructor(e){super(e),Ut(this,"handleChange",(e=>{this.setState({checked:"true"===e.target.value})})),Ut(this,"handleSubmit",(async()=>{this.setState({isSaving:!0}),await this.props.savePreferences(this.props.currentUserId,[{user_id:this.props.currentUserId,category:_.uP.CATEGORY_SIDEBAR_SETTINGS,name:_.uP.SHOW_UNREAD_SECTION,value:this.state.checked.toString()}]),this.setState({isSaving:!1}),this.props.updateSection("")})),Ut(this,"renderDescription",(()=>this.props.showUnreadsCategory?o.createElement(h.Z,{id:"user.settings.sidebar.on",defaultMessage:"On"}):o.createElement(h.Z,{id:"user.settings.sidebar.off",defaultMessage:"Off"}))),this.state={active:!1,checked:!1,isSaving:!1}}static getDerivedStateFromProps(e,t){return e.active!==t.active?e.active&&!t.active?{checked:e.showUnreadsCategory,active:e.active}:{active:e.active}:null}render(){const e=o.createElement(h.Z,{id:"user.settings.sidebar.showUnreadsCategoryTitle",defaultMessage:"Group unread channels separately"});return this.props.active?o.createElement(v.Z,{title:e,inputs:o.createElement("fieldset",null,o.createElement("legend",{className:"form-legend hidden-label"},e),o.createElement("div",{className:"radio"},o.createElement("label",null,o.createElement("input",{"data-testid":"showUnreadsCategoryOn",type:"radio",name:"showUnreadsCategory",checked:this.state.checked,onChange:()=>this.setState({checked:!0})}),o.createElement(h.Z,{id:"user.settings.sidebar.on",defaultMessage:"On"})),o.createElement("br",null)),o.createElement("div",{className:"radio"},o.createElement("label",null,o.createElement("input",{"data-testid":"showUnreadsCategoryOff",type:"radio",name:"showUnreadsCategory",checked:!this.state.checked,onChange:()=>this.setState({checked:!1})}),o.createElement(h.Z,{id:"user.settings.sidebar.off",defaultMessage:"Off"})),o.createElement("br",null)),o.createElement("div",{className:"mt-5"},o.createElement(h.Z,{id:"user.settings.sidebar.showUnreadsCategoryDesc",defaultMessage:"When enabled, all unread channels and direct messages will be grouped together in the sidebar."}))),submit:this.handleSubmit,saving:this.state.isSaving,updateSection:this.props.updateSection}):o.createElement(S.Z,{title:e,describe:this.renderDescription(),section:"showUnreadsCategory",updateSection:this.props.updateSection})}}Ut(xt,"propTypes",{active:r().bool.isRequired,currentUserId:r().string.isRequired,savePreferences:r().func.isRequired,showUnreadsCategory:r().bool.isRequired,updateSection:r().func.isRequired});const qt={savePreferences:u.$A},Ft=(0,a.connect)((function(e){return{currentUserId:(0,i.rc)(e),showUnreadsCategory:(0,d.hC)(e)}}),qt)(xt);function Gt(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,a)}return s}function jt(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?Gt(Object(s),!0).forEach((function(t){zt(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):Gt(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}function zt(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}const Bt=[{value:1e4,label:(0,f._u)("user.settings.sidebar.limitVisibleGMsDMs.allDirectMessages","All Direct Messages")},{value:10,label:"10"},{value:15,label:"15"},{value:20,label:"20"},{value:40,label:"40"}];class Vt extends o.PureComponent{constructor(e){super(e),zt(this,"handleChange",(e=>{e&&"value"in e&&this.setState({limit:e})})),zt(this,"handleSubmit",(async()=>{this.setState({isSaving:!0}),await this.props.savePreferences(this.props.currentUserId,[{user_id:this.props.currentUserId,category:_.uP.CATEGORY_SIDEBAR_SETTINGS,name:_.uP.LIMIT_VISIBLE_DMS_GMS,value:this.state.limit.value.toString()}]),this.setState({isSaving:!1}),this.props.updateSection("")})),zt(this,"renderDescription",(()=>o.createElement("span",null,this.state.limit.label))),this.state={active:!1,limit:{value:20,label:"20"},isSaving:!1}}static getDerivedStateFromProps(e,t){return e.active!==t.active?e.active&&!t.active?{limit:Bt.find((t=>t.value===e.dmGmLimit)),active:e.active}:{active:e.active}:e.active?null:{limit:Bt.find((t=>t.value===e.dmGmLimit))}}render(){const e=o.createElement(h.Z,{id:"user.settings.sidebar.limitVisibleGMsDMsTitle",defaultMessage:"Number of direct messages to show"});return this.props.active?o.createElement(v.Z,{title:e,inputs:o.createElement("fieldset",null,o.createElement("legend",{className:"form-legend hidden-label"},e),o.createElement(re.ZP,{className:"react-select",classNamePrefix:"react-select",id:"limitVisibleGMsDMs",options:Bt,clearable:!1,onChange:this.handleChange,value:this.state.limit,isSearchable:!1,menuPortalTarget:document.body,styles:Ht}),o.createElement("div",{className:"mt-5"},o.createElement(h.Z,{id:"user.settings.sidebar.limitVisibleGMsDMsDesc",defaultMessage:"You can also change these settings in the direct messages sidebar menu."}))),submit:this.handleSubmit,saving:this.state.isSaving,updateSection:this.props.updateSection}):o.createElement(S.Z,{title:e,describe:this.renderDescription(),section:"limitVisibleGMsDMs",updateSection:this.props.updateSection})}}zt(Vt,"propTypes",{active:r().bool.isRequired,currentUserId:r().string.isRequired,savePreferences:r().func.isRequired,dmGmLimit:r().number.isRequired,updateSection:r().func.isRequired});const Ht={menuPortal:e=>jt(jt({},e),{},{zIndex:9999})},Yt={savePreferences:u.$A},Kt=(0,a.connect)((function(e){return{currentUserId:(0,i.rc)(e),dmGmLimit:(0,d.wS)(e,_.uP.CATEGORY_SIDEBAR_SETTINGS,_.uP.LIMIT_VISIBLE_DMS_GMS,20)}}),Yt)(Vt);function Wt(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,a)}return s}function Jt(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?Wt(Object(s),!0).forEach((function(t){Xt(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):Wt(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}function Xt(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}var $t;!function(e){e.CloseUnusedDirectMessages="close_unused_direct_messages",e.ChannelSwitcherSection="channel_switcher_section",e.Grouping="grouping",e.UnreadsAtTop="unreadsAtTop",e.FavoriteAtTop="favoriteAtTop",e.Sorting="sorting",e.NewSidebar="newSidebar",e.ChannelGrouping="channel_grouping",e.ChannelSorting="channel_sorting"}($t||($t={}));class Qt extends o.PureComponent{constructor(e){super(e),Xt(this,"getStateFromProps",(()=>{const{closeUnusedDirectMessages:e,channelSwitcherOption:t,sidebarPreference:{grouping:s,sorting:a},unreadsAtTop:i,favoriteAtTop:n}=this.props;return{settings:{close_unused_direct_messages:e,channel_switcher_section:t,grouping:s,unreadsAtTop:i,favoriteAtTop:n,sorting:a},isSaving:!1}})),Xt(this,"handleSubmit",(e=>{const{actions:t,user:s}=this.props,a=[];if(e===$t.ChannelGrouping||e===$t.ChannelSorting){const e={grouping:this.state.settings.grouping,unreads_at_top:this.state.settings.unreadsAtTop,favorite_at_top:this.state.settings.favoriteAtTop,sorting:this.state.settings.sorting};a.push({user_id:s.id,category:p.ZP.Preferences.CATEGORY_SIDEBAR_SETTINGS,name:"",value:JSON.stringify(e)}),this.trackSettingChangeIfNecessary($t.Grouping),this.trackSettingChangeIfNecessary($t.Sorting),this.trackSettingChangeIfNecessary($t.UnreadsAtTop),this.trackSettingChangeIfNecessary($t.FavoriteAtTop),this.trackSettingChangeIfNecessary($t.NewSidebar)}else a.push({user_id:s.id,category:p.ZP.Preferences.CATEGORY_SIDEBAR_SETTINGS,name:e,value:this.state.settings[e]}),(0,ke.L9)("settings","user_settings_update",{field:"sidebar."+e,value:this.state.settings[e]});this.setState({isSaving:!0}),t.savePreferences(s.id,a).then((()=>{this.updateSection("")}))})),Xt(this,"getPreviousSection",(e=>{const{showChannelOrganization:t}=this.props;switch(e){case"autoCloseDM":return"channelSwitcher";case"groupChannels":return"dummySectionName";case"channelSwitcher":return t?"groupChannels":"dummySectionName";default:return null}})),Xt(this,"updateSection",(e=>{this.props.updateSection&&(this.setState(this.getStateFromProps()),this.setState({isSaving:!1}),this.props.updateSection(e))})),Xt(this,"renderAutoCloseDMLabel",(e=>"after_seven_days"===e?o.createElement(h.Z,{id:"user.settings.sidebar.after_seven_days",defaultMessage:"After 7 days with no new messages"}):o.createElement(h.Z,{id:"user.settings.sidebar.never",defaultMessage:"Never"}))),Xt(this,"renderAutoCloseDMSection",(()=>{let e;return e="autoCloseDM"===this.props.activeSection?o.createElement(v.Z,{title:o.createElement(h.Z,{id:"user.settings.sidebar.autoCloseDMTitle",defaultMessage:"Automatically Close Direct Messages"}),inputs:[o.createElement("fieldset",{key:"autoCloseDMSetting"},o.createElement("div",{className:"radio"},o.createElement("label",null,o.createElement("input",{id:"autoCloseDMAfterSevenDays",type:"radio",name:"autoCloseDM",checked:"after_seven_days"===this.state.settings.close_unused_direct_messages,onChange:this.updateSetting.bind(this,$t.CloseUnusedDirectMessages,"after_seven_days")}),o.createElement(h.Z,{id:"user.settings.sidebar.after_seven_days",defaultMessage:"After 7 days with no new messages"}))),o.createElement("div",{className:"radio"},o.createElement("label",null,o.createElement("input",{id:"autoCloseDMNever",type:"radio",name:"autoCloseDM",checked:"never"===this.state.settings.close_unused_direct_messages,onChange:this.updateSetting.bind(this,$t.CloseUnusedDirectMessages,"never")}),o.createElement(h.Z,{id:"user.settings.sidebar.never",defaultMessage:"Never"}))),o.createElement("div",{className:"mt-5"},o.createElement(h.Z,{id:"user.settings.sidebar.autoCloseDMDesc",defaultMessage:"Direct Message conversations can be reopened with the “+” button in the sidebar or using the Channel Switcher (CTRL+K)."})))],setting:"close_unused_direct_messages",submit:this.handleSubmit,saving:this.state.isSaving,server_error:this.state.serverError,updateSection:this.updateSection}):o.createElement(S.Z,{title:o.createElement(h.Z,{id:"user.settings.sidebar.autoCloseDMTitle",defaultMessage:"Automatically Close Direct Messages"}),describe:this.renderAutoCloseDMLabel(this.state.settings.close_unused_direct_messages),section:"autoCloseDM",updateSection:this.updateSection}),o.createElement(o.Fragment,null,e,o.createElement("div",{className:"divider-dark"}))})),Xt(this,"renderOrganizationLabel",(()=>{const{sidebarPreference:{sorting:e,grouping:t},unreadsAtTop:s,favoriteAtTop:a}=this.props,i=[];let n,r;"by_type"===t?i.push(o.createElement(h.Z,{key:"by_type",id:"user.settings.sidebar.groupByTypeShort",defaultMessage:"Group by channel type"})):i.push(o.createElement(h.Z,{key:"none",id:"user.settings.sidebar.groupByNoneShort",defaultMessage:"No grouping"})),"alpha"===e?(n=(0,E.t)("user.settings.sidebar.sortAlphaShort"),r="sorted alphabetically"):(n=(0,E.t)("user.settings.sidebar.sortRecentShort"),r="sorted by recency"),i.push(o.createElement("span",{key:"comma"},", ")),i.push(o.createElement(h.Z,{key:"sorting",id:n,defaultMessage:r}));let l=null,c=null;return"true"===s&&"false"===a?(l=(0,E.t)("user.settings.sidebar.unreadsShort"),c="Unreads grouped separately"):"false"===s&&"true"===a?(l=(0,E.t)("user.settings.sidebar.favoritesShort"),c="Favorites grouped separately"):"true"===s&&"true"===a&&(l=(0,E.t)("user.settings.sidebar.unreadsFavoritesShort"),c="Unreads and favorites grouped separately"),l&&(i.push(o.createElement("br",{key:"break"})),i.push(o.createElement(h.Z,{key:"atTop",id:l,defaultMessage:c}))),i})),Xt(this,"renderChannelSwitcherLabel",(e=>"true"===e?o.createElement(h.Z,{id:"user.settings.sidebar.on",defaultMessage:"On"}):o.createElement(h.Z,{id:"user.settings.sidebar.off",defaultMessage:"Off"}))),Xt(this,"renderChannelOrganizationSection",(()=>{const{grouping:e,sorting:t}=this.state.settings;let s;if("groupChannels"===this.props.activeSection){const a=[];a.push(o.createElement("fieldset",{key:"groupingSectionSetting"},o.createElement("legend",{className:"form-legend"},o.createElement(h.Z,{id:"user.settings.sidebar.groupChannelsTitle",defaultMessage:"Channel grouping"})),o.createElement("div",{className:"radio"},o.createElement("label",null,o.createElement("input",{id:"byTypeOption",type:"radio",name:"groupChannels",checked:"by_type"===e,onChange:this.updateSetting.bind(this,$t.Grouping,"by_type")}),o.createElement(h.Z,{id:"user.settings.sidebar.groupByType",defaultMessage:"Channels grouped by type"}))),o.createElement("div",{className:"radio"},o.createElement("label",null,o.createElement("input",{id:"noneOption",type:"radio",name:"groupChannels",checked:"none"===e,onChange:this.updateSetting.bind(this,$t.Grouping,"none")}),o.createElement(h.Z,{id:"user.settings.sidebar.groupByNone",defaultMessage:"Combine all channel types"}))),o.createElement("div",{className:"mt-5"},o.createElement(h.Z,{id:"user.settings.sidebar.groupDesc",defaultMessage:"Group channels by type, or combine all types into a list."})))),a.push(o.createElement("hr",{key:"sortingDivider"})),a.push(o.createElement("fieldset",{key:"sortingOptions"},o.createElement("legend",{className:"form-legend"},o.createElement(h.Z,{id:"user.settings.sidebar.sortChannelsTitle",defaultMessage:"Channel sorting"})),o.createElement("div",{className:"radio"},o.createElement("label",null,o.createElement("input",{id:"recentSectionEnabled",type:"radio",name:"sortChannels",checked:"recent"===t,onChange:this.updateSetting.bind(this,$t.Sorting,"recent")}),o.createElement(h.Z,{id:"user.settings.sidebar.sortRecent",defaultMessage:"Recency"}))),o.createElement("div",{className:"radio"},o.createElement("label",null,o.createElement("input",{id:"alphaSectionEnabled",type:"radio",name:"sortChannels",checked:"alpha"===t,onChange:this.updateSetting.bind(this,$t.Sorting,"alpha")}),o.createElement(h.Z,{id:"user.settings.sidebar.sortAlpha",defaultMessage:"Alphabetically"}))),o.createElement("div",{className:"mt-5"},o.createElement(h.Z,{id:"user.settings.sidebar.sortDesc",defaultMessage:"Sort channels alphabetically, or by most recent post."})))),a.push(o.createElement("hr",{key:"divider"})),a.push(o.createElement("fieldset",{key:"unreadOption"},o.createElement("div",{className:"checkbox"},o.createElement("label",null,o.createElement("input",{id:"unreadAtTopOption",type:"checkbox",checked:"true"===this.state.settings.unreadsAtTop,onChange:e=>this.updateSetting($t.UnreadsAtTop,e.target.checked.toString())}),o.createElement(h.Z,{id:"user.settings.sidebar.unreads",defaultMessage:"Unreads grouped separately"}))),o.createElement("div",{className:"mt-5"},o.createElement(h.Z,{id:"user.settings.sidebar.unreadsDesc",defaultMessage:"Group unread channels separately until read."})))),a.push(o.createElement("hr",{key:"groupingDivider"})),a.push(o.createElement("fieldset",{key:"favoriteOption"},o.createElement("div",{className:"checkbox"},o.createElement("label",null,o.createElement("input",{id:"favoriteAtTopOption",type:"checkbox",checked:"true"===this.state.settings.favoriteAtTop,onChange:e=>this.updateSetting($t.FavoriteAtTop,e.target.checked.toString())}),o.createElement(h.Z,{id:"user.settings.sidebar.favorites",defaultMessage:"Favorites grouped separately"}))),o.createElement("div",null,o.createElement("br",null),o.createElement(h.Z,{id:"user.settings.sidebar.favoritesDesc",defaultMessage:"Channels marked as favorites will be grouped separately."})))),s=o.createElement(v.Z,{title:o.createElement(h.Z,{id:"user.settings.sidebar.groupAndSortChannelsTitle",defaultMessage:"Channel Grouping and Sorting"}),inputs:a,setting:"channel_grouping",submit:this.handleSubmit,saving:this.state.isSaving,server_error:this.state.serverError,updateSection:this.updateSection})}else s=o.createElement(S.Z,{title:o.createElement(h.Z,{id:"user.settings.sidebar.groupAndSortChannelsTitle",defaultMessage:"Channel Grouping and Sorting"}),describe:this.renderOrganizationLabel(),section:"groupChannels",updateSection:this.updateSection});return o.createElement(o.Fragment,null,s,o.createElement("div",{className:"divider-light"}))})),Xt(this,"renderChannelSwitcherSection",(()=>{let e=(0,E.t)("user.settings.sidebar.channelSwitcherSectionDesc.windows"),t="The channel switcher is shown at the bottom of the sidebar and is used to jump between channels quickly. It can also be accessed using CTRL + K.";(0,f.V5)()&&(e=(0,E.t)("user.settings.sidebar.channelSwitcherSectionDesc.mac"),t="The channel switcher is shown at the bottom of the sidebar and is used to jump between channels quickly. It can also be accessed using CMD + K.");const s=o.createElement(h.Z,{id:e,defaultMessage:t});return"channelSwitcher"===this.props.activeSection?o.createElement(v.Z,{title:o.createElement(h.Z,{id:"user.settings.sidebar.channelSwitcherSectionTitle",defaultMessage:"Channel Switcher"}),inputs:[o.createElement("fieldset",{key:"channelSwitcherSectionSetting"},o.createElement("legend",{className:"form-legend hidden-label"},o.createElement(h.Z,{id:"user.settings.sidebar.channelSwitcherSectionTitle",defaultMessage:"Channel Switcher"})),o.createElement("div",{id:"channelSwitcherRadioOn",className:"radio"},o.createElement("label",null,o.createElement("input",{id:"channelSwitcherSectionEnabled",type:"radio",name:"channelSwitcher",checked:"true"===this.state.settings.channel_switcher_section,onChange:this.updateSetting.bind(this,$t.ChannelSwitcherSection,"true")}),o.createElement(h.Z,{id:"user.settings.sidebar.on",defaultMessage:"On"})),o.createElement("br",null)),o.createElement("div",{id:"channelSwitcherRadioOff",className:"radio"},o.createElement("label",null,o.createElement("input",{id:"channelSwitcherSectionOff",type:"radio",name:"channelSwitcher",checked:"false"===this.state.settings.channel_switcher_section,onChange:this.updateSetting.bind(this,$t.ChannelSwitcherSection,"false")}),o.createElement(h.Z,{id:"user.settings.sidebar.off",defaultMessage:"Off"})),o.createElement("br",null)),o.createElement("div",{id:"channelSwitcherHelpText"},o.createElement("br",null),s))],setting:"channel_switcher_section",submit:this.handleSubmit,saving:this.state.isSaving,server_error:this.state.serverError,updateSection:this.updateSection}):o.createElement(S.Z,{title:o.createElement(h.Z,{id:"user.settings.sidebar.channelSwitcherSectionTitle",defaultMessage:"Channel Switcher"}),describe:this.renderChannelSwitcherLabel(this.props.channelSwitcherOption),section:"channelSwitcher",updateSection:this.updateSection})})),Xt(this,"renderShowUnreadsCategorySection",(()=>this.props.enableLegacySidebar?null:o.createElement(Ft,{active:"showUnreadsCategory"===this.props.activeSection,updateSection:this.updateSection}))),Xt(this,"renderLimitVisibleGMsDMsSection",(()=>this.props.enableLegacySidebar?null:o.createElement(o.Fragment,null,o.createElement("div",{className:"divider-dark"}),o.createElement(Kt,{active:"limitVisibleGMsDMs"===this.props.activeSection,updateSection:this.updateSection})))),this.state=this.getStateFromProps()}trackSettingChangeIfNecessary(e){this.state.settings[e]!==this.props.sidebarPreference[e]&&(0,ke.L9)("settings","user_settings_update",{field:"sidebar."+e,value:this.state.settings[e]})}updateSetting(e,t){const s=Jt(Jt({},this.state.settings),{},{[e]:t});this.setState(Jt(Jt({},this.state),{},{settings:s}))}render(){const{showUnusedOption:e,showChannelOrganization:t,enableLegacySidebar:s}=this.props,a=t&&s?this.renderChannelOrganizationSection():null,i=e&&s?this.renderAutoCloseDMSection():null,n=s?this.renderChannelSwitcherSection():null;return o.createElement("div",null,o.createElement("div",{className:"modal-header"},o.createElement("button",{id:"closeButton",type:"button",className:"close","data-dismiss":"modal","aria-label":"Close",onClick:this.props.closeModal},o.createElement("span",{"aria-hidden":"true"},"×")),o.createElement("h4",{className:"modal-title"},o.createElement("div",{className:"modal-back",onClick:this.props.collapseModal},o.createElement(z.Z,{className:"fa fa-angle-left",title:{id:(0,E.t)("generic_icons.collapse"),defaultMessage:"Collapse Icon"}})),o.createElement(h.Z,{id:"user.settings.sidebar.title",defaultMessage:"Sidebar Settings"}))),o.createElement("div",{id:"sidebarTitle",className:"user-settings"},o.createElement("h3",{className:"tab-header"},o.createElement(h.Z,{id:"user.settings.sidebar.title",defaultMessage:"Sidebar Settings"})),o.createElement("div",{className:"divider-dark first"}),a,n,this.renderShowUnreadsCategorySection(),this.renderLimitVisibleGMsDMsSection(),e?o.createElement("div",{className:"divider-light"}):o.createElement("div",{className:"divider-dark"}),i))}}Xt(Qt,"propTypes",{actions:r().shape({savePreferences:r().func.isRequired}).isRequired,closeUnusedDirectMessages:r().string.isRequired,showUnusedOption:r().bool.isRequired,showChannelOrganization:r().bool.isRequired,channelSwitcherOption:r().string.isRequired,unreadsAtTop:r().string.isRequired,favoriteAtTop:r().string.isRequired,enableLegacySidebar:r().bool.isRequired,updateSection:r().func,activeSection:r().string,closeModal:r().func.isRequired,collapseModal:r().func.isRequired});const es=(0,a.connect)((function(e){const t=(0,c.iE)(e),s=(0,d.U2)(e,_.uP.CATEGORY_SIDEBAR_SETTINGS,"close_unused_direct_messages","after_seven_days"),a=(0,d.U2)(e,_.uP.CATEGORY_SIDEBAR_SETTINGS,"channel_switcher_section","true"),n=(0,d.su)(e);return{closeUnusedDirectMessages:s,sidebarPreference:n,unreadsAtTop:n.unreads_at_top,favoriteAtTop:n.favorite_at_top,channelSwitcherOption:a,showChannelOrganization:"true"===t.ExperimentalChannelOrganization,showUnusedOption:"true"===t.CloseUnusedDirectMessages,user:(0,i.ts)(e),enableLegacySidebar:"true"===t.EnableLegacySidebar}}),(function(e){return{actions:(0,l.bindActionCreators)({savePreferences:u.$A},e)}}))(Qt);class ts extends o.PureComponent{render(){return"general"===this.props.activeTab?o.createElement("div",null,o.createElement(De,{user:this.props.user,activeSection:this.props.activeSection,updateSection:this.props.updateSection,updateTab:this.props.updateTab,closeModal:this.props.closeModal,collapseModal:this.props.collapseModal})):"security"===this.props.activeTab?o.createElement("div",null,o.createElement(Lt,{user:this.props.user,activeSection:this.props.activeSection,updateSection:this.props.updateSection,closeModal:this.props.closeModal,collapseModal:this.props.collapseModal,setRequireConfirm:this.props.setRequireConfirm})):"notifications"===this.props.activeTab?o.createElement("div",null,o.createElement($e,{user:this.props.user,activeSection:this.props.activeSection,updateSection:this.props.updateSection,closeModal:this.props.closeModal,collapseModal:this.props.collapseModal})):"display"===this.props.activeTab?o.createElement("div",null,o.createElement(Ne,{user:this.props.user,activeSection:this.props.activeSection,updateSection:this.props.updateSection,closeModal:this.props.closeModal,collapseModal:this.props.collapseModal,setEnforceFocus:this.props.setEnforceFocus,setRequireConfirm:this.props.setRequireConfirm})):"sidebar"===this.props.activeTab?o.createElement("div",null,o.createElement(es,{activeSection:this.props.activeSection,updateSection:this.props.updateSection,closeModal:this.props.closeModal,collapseModal:this.props.collapseModal})):"advanced"===this.props.activeTab?o.createElement("div",null,o.createElement(w,{activeSection:this.props.activeSection,updateSection:this.props.updateSection,closeModal:this.props.closeModal,collapseModal:this.props.collapseModal})):o.createElement("div",null)}}var ss,as,is;ss=ts,as="propTypes",is={activeTab:r().string,activeSection:r().string,updateSection:r().func.isRequired,updateTab:r().func.isRequired,closeModal:r().func.isRequired,collapseModal:r().func.isRequired,setEnforceFocus:r().func.isRequired,setRequireConfirm:r().func.isRequired},as in ss?Object.defineProperty(ss,as,{value:is,enumerable:!0,configurable:!0,writable:!0}):ss[as]=is;const ns=(0,a.connect)((function(e){return{user:(0,i.ts)(e)}}))(ts)},88329:(e,t,s)=>{"use strict";s.d(t,{g:()=>c}),s(88674);var a=s(27457),i=s(83175),n=s(17214);function r(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,a)}return s}function o(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?r(Object(s),!0).forEach((function(t){l(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):r(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}function l(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function c(e){return async(t,s)=>{const r=(0,a.ts)(s()),l=(0,i.S)(s(),r.id),c=l.automaticTimezone!==e;if(l.useAutomaticTimezone&&c){const a={useAutomaticTimezone:"true",automaticTimezone:e,manualTimezone:l.manualTimezone},i=o(o({},r),{},{timezone:a});(0,n.DO)(i)(t,s)}}}}}]);
//# sourceMappingURL=228.4899fd415820c5d353c8.js.map